<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.1d07f1255d05a1395a48.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.18.12"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '2374911412821725'); // Insert your pixel ID here.
  fbq('track', 'PageView');
      </script><script>window.dataLayer = window.dataLayer || [];window.dataLayer.push({"platform":"plataforma-reativa"}); (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'GTM-KZH8KWD');</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a4533d42454f73956ac7c2f680393b78"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a4533d42454f73956ac7c2f680393b78"/><title data-react-helmet="true">Apostila de NodeJS 100% Gratuita | Reativa Tecnologia</title><meta data-react-helmet="true" name="description" content="178 páginas para você aprender tudo sobre Node.JS 100% de graça."/><meta data-react-helmet="true" property="og:title" content="Apostila de NodeJS 100% Gratuita"/><meta data-react-helmet="true" property="og:description" content="178 páginas para você aprender tudo sobre Node.JS 100% de graça."/><meta data-react-helmet="true" property="og:image" content="https://buddy.works/guides/covers/test-nodejs-app/cover-nodejs-logo.png"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Reativa"/><meta data-react-helmet="true" name="twitter:title" content="Apostila de NodeJS 100% Gratuita"/><meta data-react-helmet="true" name="twitter:description" content="178 páginas para você aprender tudo sobre Node.JS 100% de graça."/><link as="script" rel="preload" href="/webpack-runtime-b210fad69d5bdcf9f091.js"/><link as="script" rel="preload" href="/styles-989bb08664f2608f37ec.js"/><link as="script" rel="preload" href="/netlify-identity-widget-71f3202b04975b5e224a.js"/><link as="script" rel="preload" href="/app-320a3e4b66b1132d097e.js"/><link as="script" rel="preload" href="/commons-687338892083191c755b.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-d38956d7c90802b9085d.js"/><link as="fetch" rel="preload" href="/page-data/apostila-nodejs-completa/page-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KZH8KWD" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Reativa Tecnologia</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Apostila de NodeJS 100% Gratuita</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">January 12, 2020</p></header><section><p>Esta apostila é o resultado de alguns meses de pesquisa, revisão e edição, foi baseada na documentação oficial (então as informações são confiáveis). </p>
<p>Este conteúdo eu iria colocar no como adicional no <a href="https://bit.ly/guia-dev-autodidata">Guia do Dev Autodidata</a> (que é o meu guia para <strong>iniciantes</strong>). Mas resolvi deixar <strong>gratuito</strong> a toda a comunidade, então aproveite e bons estudos!</p>
<p>Se tiver qualquer dúvida (ou sugestões) me envie no <a href="http://bit.ly/pauloluan-insta">Instagram</a>, faço mentoria coletiva (gratuita) diariamente para programadores iniciantes que se sentem perdidos, você será extremamente bem vindo por lá (é só clicar na imagem).</p>
<p><a href="http://bit.ly/pauloluan-insta"><img src="https://media-exp1.licdn.com/dms/image/C4E12AQF9pxdMEVTSQg/article-inline_image-shrink_1500_2232/0/1614414726929?e=1619654400&#x26;v=beta&#x26;t=ti7w8kAyqaK7PRcB9YGnRNv8ircAgThraVR-O1D4T54" alt="Mentoria Gratuita"></a></p>
<p>Um grande abraço, Paulo Luan.</p>
<h3>Dica: Aperte <code class="language-text">ctrl+p</code> e imprima esse artigo, para que você possa fazer anotações!</h3>
<h2>Introdução ao Node.js</h2>
<p>Node.js é um ambiente de execução JavaScript open source e multiplataforma. É uma ferramenta popular para quase todo tipo de projeto!</p>
<p>Node.js roda na engine (motor) V8, o coração do Google Chrome, fora do navegador. Isso permite que o Node.js seja muito performático.</p>
<p>Uma aplicação Node.js roda em um único processo, sem criar uma nova thread para cada requisição. O Node.js provê uma série de primitivas assíncronas para I/O (input/output) em sua biblioteca nativa que previnem códigos JavaScript bloqueantes, e geralmente, bibliotecas em Node.js são escritas usando como padrão paradigmas não-bloqueantes, fazendo com que o comportamento de bloqueio seja uma exceção à regra.</p>
<p>Quando o Node.js executa operações de I/O, como ler dados da rede, acessar um banco de dados ou o sistema de arquivos, em vez de bloquear a thread em execução e gastar ciclos de CPU esperando, o Node.js vai continuar com as operações quando a resposta retornar.</p>
<p>Isso permite com que o Node.js lide com centenas de conexões paralelas em um único servidor, removendo o fardo de gerenciar concorrências em threads, que podem ser fontes significativas de bugs.</p>
<p>Node.js tem uma vantagem única poque milhões de desenvolvedores frontend que programam JavaScript para o navegador possam agora desenvolver código server-side (backend) além do client-side (frontend), sem a necessidade de aprender uma linguagem completamente diferente.</p>
<p>No Node.js os novos padrões do ECMAScript podem ser utilizados sem problemas, como você não precisa esperar todos os seus usuários atualizarem seus navegadores, você tem a liberdade de decidir qual versão do ECMAScript utilizar, bastando trocar a versão do Node.js, além de poder habilitar especificamente features experimentais, bastando executar o Node.Js com as flags apropriadas.</p>
<h2>Um número imenso de bibliotecas</h2>
<p>O npm (node package manager) com sua simples estrutura ajudou na ploriferação do ecossistema Node.js, hospedando atualmente mais de 1,000,000 de pacotes open source que podem ser utilizados gratuitamente.</p>
<h2>Um exemplo de aplicação Node.js</h2>
<p>O exemplo mais comum de Hello World no Node.js é um servidor web:</p>
<iframe
  title="Hello world web server"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0001-01?path=server.js&previewSize=30&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0001-01 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Para executar esse trecho, salve-o como <code class="language-text">server.js</code> e rode com <code class="language-text">node server.js</code> no seu terminal.</p>
<p>Primeiramente esse código importa o módulo <a href="https://nodejs.org/api/http.html"><code class="language-text">http</code></a>.</p>
<p>O Node.js tem uma <a href="https://nodejs.org/api/">biblioteca padrão</a> fantástica, incluindo suporte de primeira classe para redes.</p>
<p>O método <code class="language-text">createServer()</code> do <code class="language-text">http</code> cria um novo servidor HTTP e o retorna.</p>
<p>É definido para o servidor escutar em uma porta e host name (nome de anfitrião, ao pé da letra) específicos. Quando o servidor está pronto, a função callback é chamada, nesse caso nos informando que o servidor está rodando.</p>
<p>Sempre que uma nova requisição é recebida, o <a href="https://nodejs.org/api/http.html#http_event_request">evento de request</a> é chamado, provendo dois objetos: uma requisição (objeto do tipo <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage"><code class="language-text">http.IncomingMessage</code></a>) e uma resposta (objeto do tipo <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse"><code class="language-text">http.ServerResponse</code></a>).</p>
<p>Esses 2 objetos são essenciais para manusear a chamada HTTP.</p>
<p>O primeiro provê os detalhes da requisição. Nesse simples exemplo, ele não é utilizado, mas com ele você pode acessar os dados da request e as headers.</p>
<p>O segundo é usado para retornar dados para quem o chamou.</p>
<p>Nesse caso com:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>nós definimos a propriedade statusCode como 200, para indicar uma resposta bem sucedida.</p>
<p>Nós definimos a header de Content-Type (tipo de conteúdo):</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e nós fechamos a resposta, adicionando o conteúdo como um argumento do <code class="language-text">end()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Frameworks e ferramentas para Node.js</h2>
<p>Node.js é uma plataforma de baixo nível. Para facilitar e inspirar os desenvolvedores, milhares de bibliotecas são construidas sob o Node.js pela comunidade.</p>
<p>Muitas delas se estabaleceram como opções populares ao decorrer do tempo. Aqui está uma pequena lista com algumas que valem a pena aprender:</p>
<ul>
<li><a href="https://adonisjs.com/"><strong>AdonisJs</strong></a>: Um framework full-stack altamente focado na ergonomia, estabilidade e confiança do desenvolvedor. Adonis é um dos frameworks web Node.js mais rápidos.</li>
<li><a href="https://expressjs.com/"><strong>Express</strong></a>: Provê os meios de se criar servidores web de uma forma muito simples porém poderosa. Têm uma pegada minimalista, não opinada, focada nas funções essenciais de um servidor, que são a chave do sucesso.</li>
<li><a href="https://fastify.io/"><strong>Fastify</strong></a>: Um framework altamente focado em prover a melhor experiência ao desenvolvedor, com o mínimo de gargalos na performance e uma podesora arquitetura de extensões (plugins). Fastify é um dos mais rápidos frameworks Node.js.</li>
<li><a href="https://www.gatsbyjs.com/"><strong>Gatsby</strong></a>: Um gerador de sites estáticos baseado em <a href="https://reactjs.org/">React</a>, gerido com <a href="https://graphql.org/">GraphQL</a> e com um ecossistema de plugins e templates iniciais requíssimo.</li>
<li><a href="https://hapijs.com"><strong>hapi</strong></a>: Um rico framework para construção de aplicações e serviços que habilitam desenvolvedores a focar na escrita das lógicas de aplicação reutilizáveis em vez de perder tempo montando a infraestrutura.</li>
<li><a href="http://koajs.com/"><strong>koa</strong></a>: É mantido pelo time por trás do Express, pretende ser ainda menor e simples, construido sob muitos anos de conhecimento. O novo projeto nasceu da necessidade de criar mudanças incompatíveis sem romper com a comunidade existente.</li>
<li><a href="https://loopback.io/"><strong>Loopback.io</strong></a>: Faz com que seja fácil construir aplicações modernas que requerem integrações complexas.</li>
<li><a href="https://meteor.com"><strong>Meteor</strong></a>: Um framework full-stack incrivelmente poderoso, permite que você crie aplições Javascript com uma abordagem isomórfica, compartilhando código entre cliente e servidor. É uma ferramenta generalista que tenta fornecer tudo, que agora integra com bibliotecas frontend como <a href="https://reactjs.org/">React</a>, <a href="https://vuejs.org/">Vue</a>, e <a href="https://angular.io">Angular</a>. Também pode ser utilizado para criar aplicativos mobile.</li>
<li><a href="https://github.com/zeit/micro"><strong>Micro</strong></a>: Provê um servidor enxuto para criação de microserviços HTTP assíncronos.</li>
<li><a href="https://nestjs.com/"><strong>NestJS</strong></a>: Um framework Node.js progressivo baseado em Typescript para construção de aplicação de nível empresarial eficientes, confiáveis e escaláveis.</li>
<li><a href="https://nextjs.org/"><strong>Next.js</strong></a>: Framework <a href="https://reactjs.org">React</a> que fornce a melhor experiência de desenvolvimento, com todos os recursos que você precisa para produção: renderização híbrida entre servidor (SSR) e estáticos, suporte ao TypeScript, bundle otimizado, rotas pre-fetching, e mais.</li>
<li><a href="https://nx.dev/"><strong>Nx</strong></a>: Um conjunto de ferramentas para desenvolvimento full-stack em monorepo, utilizando NestJS, <a href="https://reactjs.org/">React</a>, <a href="https://angular.io">Angular</a>, e mais! Nx ajuda a escalar seu desenvolvimento de um time construindo uma aplicação para múltiplos times colaborando em múltiplas aplicações!</li>
<li><a href="https://sapper.svelte.dev/"><strong>Sapper</strong></a>: Sapper é um framework para construção de aplicações web de todos os tamanhos, com uma bela experiências de desenvolvimento e roteamento flexível baseado em filesystems. Oferece SSR e muito mais!</li>
<li><a href="https://socket.io/"><strong>Socket.io</strong></a>: Um motor de comunição em tempo real para construir aplicações em rede.</li>
<li><a href="https://strapi.io/"><strong>Strapi</strong></a>: Strapi é um CMS flexível, open-source e independente, que fornece aos desenvolvedores a liberdade de escolher seus frameworks e ferramentas favoritos, enquanto também permite que editores administrem e distribuam seus conteúdos de maneira fácil. Por fazer o painel administrativo uma API extensível através de um sistema de plugins, o Strapi permite que as maiores empresas do mundo acelerem a entrega de conteúdo enquanto constroem belas experiências digitais.</li>
</ul>
<h2>Uma breve história do Node.js</h2>
<p>Acredite ou não, Node.js só tem 11 anos de idade.</p>
<p>Em comparação, <a href="https://en.wikipedia.org/wiki/JavaScript#Beginnings_at_Netscape">o JavaScript tem 24 anos</a> e <a href="https://howoldistheinter.net/">a Web tem 31 anos</a>.</p>
<p>Na tecnologia, 11 anos não é um tempo muito longo, mas o Node.js parece ter existido sempre.</p>
<p>Eu tive o prazer de trabalhar com Node.js desde os primórdios quando ele só tinha 2 anos, e apesar das informações limitadas pela web, você já podia sentir que o crescimento seria enorme.</p>
<p>Nesse post, vamos dissecar a história do Node.js, para colocar as coisas em perspectiva.</p>
<h2>Um pouco de história</h2>
<p>JavaScript é uma linguagem de programação que foi criada no Netscape como uma ferramente de scripts para manipulação de páginas web dentro do browser <a href="https://en.wikipedia.org/wiki/Netscape_Navigator">Netscape Navigator</a>.</p>
<p>Parte do modelo de negócios da Netscape era vender servidores web, o que incluia um ambiente chamado <em>Netscape LiveWire</em>, que podia criar páginas dinâmicas usando JavaScript no server-side.
Infelizmente, o <em>Netscape LiveWire</em> não obteve muito sucesso e JavaScript server-side não era popular até recentemente, com a introdução do Node.js</p>
<p>Um fator chave que levou o Node.js ao topo foi o timing. Apenas alguns poucos anos antes, Javascript começou a ser mais considerado como uma linguagem séria, graças às aplicações “Web 2.0” (como Flickr, Gmail, etc.) que mostraram ao mundo como poderia ser uma experiência moderna na web.</p>
<p>Motores JavaScript (engines) também se tornaram consideravelmente melhores com a competição entre vários browsers para fornecer aos usuários a melhor performance. Times de desenvolvimento por trás dos maiores browsers trabalharam duro para oferecer melhor suporte para o JavaScript e encontrar meios que o fizesse rodar mais rápido. A engine que roda por baixo dos panos do Node.js, V8 (também conhecida como Chrome V8 por ser a engine Javascript open-source do Projeto Chromium), melhorou significamente devido a esta competição.</p>
<p>Aconteceu de o Node.js ser criado no lugar certo e na hora certa, mas sorte não é a única razão do porquê ser tão popular hoje. Ele introduz várias abordagens e estratégias inovadoras para o desenvolvimento sever-side com JavaScript que já ajudaram diversos desenvolvedores.</p>
<h2>2009</h2>
<ul>
<li>Nasce o Node.js</li>
<li>A primeira forma do <a href="https://www.npmjs.com/">npm</a> é criada</li>
</ul>
<h2>2010</h2>
<ul>
<li>Nasce o <a href="https://expressjs.com/">Express</a></li>
<li>Nasce o <a href="https://socket.io">Socket.io</a></li>
</ul>
<h2>2011</h2>
<ul>
<li>npm alcança a versão 1.0</li>
<li>Grandes empresas começam a adotar Node.js: LinkedIn, Uber, etc.</li>
<li>Nasce o <a href="https://hapijs.com">hapi</a></li>
</ul>
<h2>2012</h2>
<ul>
<li>Adoção continua muito rápida</li>
</ul>
<h2>2013</h2>
<ul>
<li>Primeira grande plataforma de blogs usando Node.js: <a href="https://ghost.org/">Ghost</a></li>
<li>Nasce o <a href="https://koajs.com/">Koa</a></li>
</ul>
<h2>2014</h2>
<ul>
<li>O Grande Fork: <a href="https://iojs.org/">io.js</a> é o maior fork do Node.js, com o objetivo de introduzir suporte ao ES6 e crescer rapidamente.</li>
</ul>
<h2>2015</h2>
<ul>
<li>Nasce a <a href="https://foundation.nodejs.org/">Node.js Foundation</a></li>
<li>IO.js é mergeado de volta ao Node.js</li>
<li>npm introduz módulos privados</li>
<li>Node.js 4 (versões 1, 2 e 3 nunca foram lançadas previamente)</li>
</ul>
<h2>2016</h2>
<ul>
<li>O incidente de <a href="https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm">leftpad</a></li>
<li>Nasce o <a href="https://yarnpkg.com/en/">Yarn</a></li>
<li>Node.js 6</li>
</ul>
<h2>2017</h2>
<ul>
<li>npm aumenta o foco em segurança</li>
<li>Node.js 8</li>
<li>HTTP/2</li>
<li>V8 introduz o Node.js em sua suite de testes, fazendo do Node.js oficialmente um alvo da engine, em adição ao Chrome</li>
<li>3 bilhões de downloads no npm toda semana</li>
</ul>
<h2>2018</h2>
<ul>
<li>Node.js 10</li>
<li><a href="https://nodejs.org/api/esm.html">ES modules</a>: suporte experimental ao .mjs</li>
<li>Node.js 11</li>
</ul>
<h2>2019</h2>
<ul>
<li>Node.js 12</li>
<li>Node.js 13</li>
</ul>
<h2>2020</h2>
<ul>
<li>Node.js 14</li>
<li>Node.js 15</li>
</ul>
<h2>Como instalar o Node.js</h2>
<p>Node.js pode ser instalado de diferentes formas. Esse post destaca as mais comuns e convenientes.</p>
<p>Pacotes oficiais para todas as principais plataformas estão disponíveis em <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a>.</p>
<p>Uma maneira muito conveniente de instalar o Node.js é através de um gerenciador de pacotes. Neste caso, cada sistema operacional tem sua abordagem mais adequada.</p>
<p>No macOS, <a href="https://brew.sh/">Homebrew</a> é a alternativa oficial, e - uma vez instalado - permite que a instalação do Node.js seja feita facilmente, rodando esse comando na CLI:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">brew <span class="token function">install</span> node</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Outros gerenciadores de pacote para Linux e Windows estão listados em <a href="https://nodejs.org/en/download/package-manager/">https://nodejs.org/en/download/package-manager/</a>.</p>
<p><code class="language-text">nvm</code> é um maneira muito popular de rodar Node.js. Ele permite que você troque facilmente entre versões, e instale novas versões para testar e troque de volta caso algo pare de funcionar, por exemplo.</p>
<p>Também é muito útil para testar seu código com versões antigas do Node.js</p>
<p>Veja <a href="https://github.com/creationix/nvm">https://github.com/creationix/nvm</a> para mais informações sobre essa opção.</p>
<p>Minha sugestão é utilizar o instalador oficial se você só estiver começando e não utiliza o Homebrew, caso contrário, o Homebew é a minha solução favorita.</p>
<p>Em todo caso, quando o Node.js é instalado você terá acesso ao comando executável <code class="language-text">node</code> na linha de comando.</p>
<h2>O que devo saber de Javascript para usar o Node.JS?</h2>
<p>Como um iniciante, é difícil chegar no ponto onde você é confiante o suficiente nas suas habilidades de programação.</p>
<p>Enquanto aprende a programar, você também pode ficar confuso sobre onde o JavaScript termina, e onde o Node.js começa, e vice versa.</p>
<p>Eu recomendo que você tenha um bom domínio dos principais conceitos do JavaScript antes de mergulhar no Node.js:</p>
<ul>
<li>Estrutura Léxica</li>
<li>Expressões</li>
<li>Tipos</li>
<li>Variáveis</li>
<li>Funções</li>
<li>this</li>
<li>Arrow Functions</li>
<li>Loops</li>
<li>Escopos</li>
<li>Arrays</li>
<li>Template Literals</li>
<li>Semicolons (;)</li>
<li>Strict Mode</li>
<li>ECMAScript 6, 2016, 2017</li>
</ul>
<p>Com esses conceitos em mente, você está no caminho certo para se tornar um desenvolvedor proficiente em JavaScript, tanto Browser como também Node.js.</p>
<p>Os conceitos a seguir também são essenciais para entender programação assíncrona, que é uma parte fundamental do Node.js:</p>
<ul>
<li>Programação Assíncrona e callbacks</li>
<li>Timers</li>
<li>Promises</li>
<li>Async e Await</li>
<li>Closures</li>
<li>Event Loop</li>
</ul>
<h2>Qual a diferença do Node.JS e do Browser?</h2>
<p>Ambos browser e Node.js utilizam JavaScript como sua linguagem de programação.</p>
<p>Construir aplicações que rodem no browser é uma coisa completamente diferente de construir aplicações Node.js</p>
<p>Apesar do fato que é sempre JavaScript, há fatores chave que tornam a experiência radicalmente diferente.</p>
<p>Da perspectiva de um desenvolvedor frontend que usa JavaScript extensivamente, aplicações Node.js trazem consigo uma enorme vantagem: o conforto de programar tudo - o frontend e o backend - em uma única linguagem.</p>
<p>Você tem uma grande oportunidade porque nós sabemos quão difícil é para aprender, completa e profundamente, uma nova linguagem de programação, e por usar a mesma linguagem para fazer todo o trabalho na web - tanto no servidor quanto no cliente, você está em uma posição única de vantagem.</p>
<p>O que muda é o ecossistema.</p>
<p>No browser, na maioria do tempo o que você está fazendo é interagindo com o DOM, ou outras APIs Web como Cookies. Isso não existe no Node.js, é claro. Você não tem o <code class="language-text">document</code>, <code class="language-text">window</code> e todos os outros objetos que são providos pelo browser.</p>
<p>E no browser, nós não temos as APIs legais que o Node.js provê com seus módulos, como a funcionalidade de acesso ao filesystem.</p>
<p>Outra grande diferença é que no Node.js você controla seu ambiente. A não ser que você esteja criando uma aplicação open source que qualquer um pode hospedar em qualquer lugar, você sabe em qual versão do Node.js a aplicação vai rodar. Comparado ao ambiente do browser, onde você não tem o luxo de escolher qual browser seu visitante vai utilizar, isso é muito conveniente.</p>
<p>Isso significa que você pode escrever códigos com os modernos ES6-7-8-9, se atentando ao suporte da sua versão do Node.js.</p>
<p>Visto que o JavaScript se move muito rápido, mas os browsers podem ser um pouco lentos para atualizarem, as vezes na web, você está preso em versões velhas do JavaScript / ECMAScript.</p>
<p>Você pode utilizar o Babel para transformar seu código em um formato compátivel com ES5 antes de enviar para o browser, mas no Node.js, você não precisa disso.</p>
<p>Outra diferença é que o Node.js utiliza o sistema de módulos CommonJS, enquanto que nos browsers ainda estamos vendo o inicio da implementação do padrão ES Modules.</p>
<p>Na prática, isso signifca que por enquanto você utiliza <code class="language-text">require()</code> no Node.js e <code class="language-text">import</code> no browser.</p>
<h2>O motor V8 do JAvascript</h2>
<p>V8 é o nome da engine JavaScript que roda no Google Chrome. É a coisa que pega nosso JavaScript e o executa enquanto navegamos com o Chrome.</p>
<p>V8 provê o ambiente de execução em que o JavaScript executa. O DOM, e outras APIs web são fornecidas pelo browser.</p>
<p>O legal é que a engine JavaScript é independente do browser que ela está hospedada. Essa funcionalidade chave possibilitou a ascensão do Node.js. A V8 foi escolhida como engine por trás do Node.js em 2009, e com a explosão de popularidade do Node.js, a V8 se tornou a engine que agora possibilita uma quantidade incrível de código sever-side escrito em JavaScript.</p>
<p>O ecossistema Node.js é enorme e isso graças à V8 que também possibilitou aplicações desktop, com projetos como o Electron.</p>
<h2>Outras engines JS</h2>
<p>Outros browsers têm suas própias engines:</p>
<ul>
<li>Firefox tem a <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey"><strong>SpiderMonkey</strong></a></li>
<li>Safari tem a <a href="https://developer.apple.com/documentation/javascriptcore"><strong>JavaScriptCore</strong></a> (também chamada de Nitro)</li>
<li>Edge foi originalmente basedo na <a href="https://github.com/Microsoft/ChakraCore"><strong>Chakra</strong></a> mas recentemente <a href="https://support.microsoft.com/en-us/help/4501095/download-the-new-microsoft-edge-based-on-chromium">foi refeito utilizando Chromium</a> e a V8.</li>
</ul>
<p>e existem muitas outras também.</p>
<p>Todas essas engines implementam o <a href="https://www.ecma-international.org/publications/standards/Ecma-262.htm">padrão ECMA ES-262</a>, também chamado de ECMAScript, o padrão utilizado pelo JavaSript.</p>
<h2>A busca por performance</h2>
<p>V8 foi escrita em C++, e é continuamente melhorada. É portável e roda no Mac, Windows, Linux e diversos outros sistemas.</p>
<p>Nessa introdução à V8, vamos ignorar os detalhes de implementação: eles podem ser encontrados em sites mais apropriados (por exemplo, o <a href="https://v8.dev/">site oficial da V8</a>), e eles mudam com o passar do tempo, frequentemente.</p>
<p>V8 está sempre evoluindo, assim como as outras engines JavaScript ao seu redor, para agilizar a Web e o ecossistema Node.js.</p>
<p>Na web, há uma corrida por performance que vem sendo travada por anos, e nós (como usuários e desenvolvedores) nos beneficiamos muito por essa competição, porque nós possuímos máquinas mais rápidas e otimizadas ano a ano.</p>
<h2>Compilação</h2>
<p>JavaScript é geralmente considerado como uma linguagem interpretada, mas engines modernas de JavaScript não o interpretam apenas, elas o compilam.</p>
<p>Isso vem acontecendo desde 2009, quando o compilador JavaScript SpiderMonkey foi adicionado no Firefox 3.5, e todo mundo seguiu essa ideia.</p>
<p>JavaScript é internamente compilado pela v8 com <strong>compilação just-in-time</strong> (JIT) para acelerar a execução.</p>
<p>Isso pode parecer contra-intuitivo, mas desde a introdução do Google Maps em 2004, o JavaScript evoluiu de uma linguagem que geralmente executava poucas dúzias de linhas de código, para aplicações completas com centenas de milhares de linhas de código executando no browser.</p>
<p>Nossas aplicações agora podem rodar por horas dentro do browser, em vez de uma simples validação de regras de formulários ou scripts banais.</p>
<p>Nesse <em>novo mundo</em>, compilar JavaScript faz total sentido porque, embora possa demorar um pouco mais para termos o código JavaScript <em>pronto</em>, uma vez concluída a compilação temos muito mais desempenho do que código puramente interpretado.</p>
<h2>Rode scripts do Node a partir da linha de comando do Linux</h2>
<p>A maneira mais usual de rodar um programa Node.js é executando o comando <code class="language-text">node</code> disponível globalmente (uma vez instalado o Node.js) e passando o nome do arquivo desejado.</p>
<p>Considerando que o arquivo principal da sua aplicação Node.js se chame <code class="language-text">app.js</code>, você pode executá-lo digitando:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Enquanto executa o comando, tenha certeza de estar no mesmo diretório que contêm o arquivo <code class="language-text">app.js</code>.</p>
<h2>Como sair de um programa Node.JS</h2>
<p>Há várias maneiras de finalizar uma aplicação Node.js.</p>
<p>Com o programa rodando no console, você pode fechá-lo com <code class="language-text">ctrl-C</code>, mas o que queremos discutir aqui é a maneira programática de fazer isso.</p>
<p>Vamos começar com a maneira mais drástica, e note porque é melhor você <em>não</em> utilizá-la:</p>
<p>O módulo nativo <code class="language-text">process</code> provê um método prático que permite a você, programaticamente, sair de um programa Node.js: <code class="language-text">process.exit()</code>.</p>
<p>Quando o Node.js executa essa linha, o processo é forçado a terminar imediatamente.</p>
<p>Isso significa que qualquer callback pendente, qualquer request de rede sendo enviada, qualquer acesso ao filesystem, ou processos de escrita no <code class="language-text">stdout</code> ou <code class="language-text">stderr</code> - tudo será finalizado de imediato <em>desgraciadamente</em>.</p>
<p>Se isso está bem para você, basta passar um inteiro que sinalize o código de saída para o sistema operacional:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Por padrão, o código de saída é <code class="language-text">0</code>, que significa sucesso. Códigos de saída diferentes tem significados diferentes, que você pode querer utilizar no seu sistema para se comunicar com outros programas.</p>
<p>Você pode ler mais sobre os códigos de saída em <a href="https://nodejs.org/api/process.html#process_exit_codes">https://nodejs.org/api/process.html#process_exit_codes</a>;</p>
<p>Você também pode definir a propriedade <code class="language-text">process.exitCode</code> como:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e quando o programa for encerrado posteriormente, o Node.js retornará esse código de saída.</p>
<p>Um programa irá sair graciosamente quando todos os processos estiverem completos.</p>
<p>Muitas vezes nós iniciamos servidores Node.js, como esse servidor HTTP:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server ready'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esse programa nunca terá um fim. Se você chamar <code class="language-text">process.exit()</code>, qualquer requisição corrente/pendente será abortada. Isso <em>não é legal</em>.</p>
<p>Nesse caso, você precisa enviar ao comando um sinal de SIGTERM, e lidar com o processo desse sinal:</p>
<blockquote>
<p>Nota: <code class="language-text">process</code> não requer importação, está disponível automaticamente.</p>
</blockquote>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server ready'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Process terminated'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<blockquote>
<p>O que são sinais? Sinais são um sistema de intercomunicação POSIX: uma notificação enviada para um processo com o objetivo de notificar que um evento ocorreu.</p>
</blockquote>
<ul>
<li><code class="language-text">SIGKILL</code> é o sinal que diz ao processo para que finalize imediatamente, e agirá idealmente como o <code class="language-text">process.exit()</code>.</li>
<li><code class="language-text">SIGTERM</code> é o sinal que diz ao processo para que termine graciosamente. É o sinal que é enviado por generenciadores de processo como <code class="language-text">upstart</code> ou <code class="language-text">supervisord</code> e muitos outros.</li>
</ul>
<p>Você pode enviar esse sinal por dentro da aplicação, em outra função:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> <span class="token string">'SIGTERM'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>ou de outro programa Node.js em execução, ou qualquer outra aplicação rodando em seu sistema que saiba o PID do processo que você deseja fianlizar.</p>
<h2>Como ler Variáveis de ambiente a partir do Node.js?</h2>
<p>O módulo nativo <code class="language-text">process</code> do Node.js fornece a propriedade <code class="language-text">env</code> que armazena todas as variáveis de ambiente que foram definidas no momento de início da aplicação.</p>
<p>Aqui vai um exemplo que acessa a variável de ambiente NODE_ENV, que é definida com o valor <code class="language-text">development</code> por padrão.</p>
<blockquote>
<p>Nota: <code class="language-text">process</code> não requer importação, está disponível automaticamente.</p>
</blockquote>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token comment">// "development"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Defini-lá para “production” antes do script executar contará ao Node.js que é um ambiente de produção.</p>
<p>Da mesma forma, você pode acessar/definir qualquer variável de ambiente customizada.</p>
<h2>Como usar o REPL no Node</h2>
<p>Nós usamos o comando <code class="language-text">node</code> para executar scripts Node.js:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node script.js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Se nós omitirmos o nome do arquivo, iniciaremos o modo REPL:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<blockquote>
<p>Nota: REPL (Read Evaluate Print Loop) é um ambiente para linguagem de programação (basicamente uma aba de console) que lê instruções individuais do input do usuário e após a execução, retorna o resultado no console.</p>
</blockquote>
<p>Se você tentar isso agora no seu terminal, isto é o que vai acontecer:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ node
<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>o comando permanece em modo de espera (idle) e aguarda alguma entrada.</p>
<blockquote>
<p>Dica: se você não tem certeza de como abrir seu terminal, pesquise por “How to open terminal on &#x3C;seu SO>“.</p>
</blockquote>
<p>Para ser mais exato, o REPL está aguardando a entrada de código JavaScript.</p>
<p>Vamos começar de forma simples:</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console">&gt; console.log(&#39;test&#39;)
test
undefined
&gt;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>O primeiro valor, <code class="language-text">test</code>, é a saída que esperavamos do log do console, e depois tivemos um undefined, que é o retorno de rodar <code class="language-text">console.log()</code>.</p>
<p>Agora podemos inserir uma nova entrada de JavaScript.</p>
<h2>Use o tab para autocomplete</h2>
<p>O legal do REPL é que ele é interativo.</p>
<p>Conforme você escreve seu código, se você pressionar o tecla <code class="language-text">tab</code> o REPL vai tentar completar o que foi escrito para combinar com variáveis previamente definidas.</p>
<h2>Explorando objetos do JavaScript</h2>
<p>Tente digitar o nome de uma classe do JavaScript, como <code class="language-text">Number</code>, e adicione um ponto e pressione <code class="language-text">tab</code>.</p>
<p>O REPL vai listar todas as propriedades e métodos que você pode acessar naquela classe:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2b60eb9487f93b672da38e391d2e5e56/4a421/tab.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.12979890310786%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACdklEQVQoz21SyW7aYBD2CQiqSlEVpWDCvoTFRKwxS8DYQBzWY+5Rby3Ki/QFeu+ph0RtD0gVEpA8Ql6ghySqmtBaIlKjOL+nM66CWrWWPs0wyz/ffAP37tUby6f3b19+/PzhaD47HU2n09FsNhvN53PTTiaT0cnxyegYQf7p6XxVQxbxGmuPzs7ODsfjsZ179uSpS5Elpu6rUCqVoFKpmFYUxZVPKJfL//iUr1arkMvl4ODg4OfF5UWAe76+zrfbewsqaEiN+2azqScSCd3n8+nk53M5XZIkPZ/P616vV49Go7qiKHqxWDTzOPh+0+MBVVW/3tzcBDme9/DYoFWrFcAC1mq1jLQgGKFQyFBkxSiXSka9XjcymYzh9/uMRDJpyLJs7O7uGrVajeIslUrBcDi8vry6CnIbGy/4nR1RoxUFIYVNfggEAhAOh82VKE7sQ8EgIGvY2oqbayJDiMVigKyZy+WCTqdzvVgsgpzbzfONhqw1JAmSON2D9KkRGQJOh+10GuLxuBkjRKLR3/HtbcD1KcZ4nodut3uNHzHc4AuFokYTS6JoUHMsFjUfRN0gm81AAS35OBAikYj5mw6B+gLqzWgQMTQ13PR6+U6n+wNFBdTkIZvNMkEQGE5n/X6f7asqU/f2GF6WpdNplsLcYDBg7XabYQ8TxZ0Hkgcf/GY+iBvTUZYoMqDYgAcBWoH0kWUF8CCmhkHUMIAglnhlU0eyOARIw16v913TtBBnsVjcWHSBh7hDgZd4lFtc4Rb9FfC6K/8x90fN0u123+G/48v5+XmAw8/qcDgKa2trdavVWiPYbLa/8L/YI+x2O+Ulp9NZQGK2XxcCVXBQQWM0AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Pressionando tab as propriedades do objeto são reveladas"
        title="Pressionando tab as propriedades do objeto são reveladas"
        src="/static/2b60eb9487f93b672da38e391d2e5e56/799d3/tab.png"
        srcset="/static/2b60eb9487f93b672da38e391d2e5e56/00d96/tab.png 148w,
/static/2b60eb9487f93b672da38e391d2e5e56/0b23c/tab.png 295w,
/static/2b60eb9487f93b672da38e391d2e5e56/799d3/tab.png 590w,
/static/2b60eb9487f93b672da38e391d2e5e56/2a3d6/tab.png 885w,
/static/2b60eb9487f93b672da38e391d2e5e56/4a421/tab.png 1094w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>Explore objetos globais</h2>
<p>Você pode inspecionar os objetos globais que você tem acesso digitando <code class="language-text">global.</code> e pressionando <code class="language-text">tab</code>:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c2bef52ca393ecb33846c54af34927a1/4a421/globals.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 91.6819012797075%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAADQklEQVQ4y32UOU8bURSFLSAWSo+CPeBlxmYz4AW8sdoztjE2AhNSUEcpGVHlb+RHpIUuSDEBIpYiBXWK9BSegMFNFInB7+bcF4ZACLF09TRv+d65595n17u1t+79D+/ffP5ysLn3aW+jXq+bBwcH5tHRkXl8fGzu7u6aW1tb5vb2trmzs2Pu7e+Zh4eHcv02NhCbJycnr+v1j89dfS+8nrWXtfbaqzWqVCpUq9VI13XKZDKUTqepUChQqVTCWKSV5WVaXFykqakpuc6RzWZpcnKS1tfXf56dnQVdgWBQ0Q2jyZOGrl9jg61pmu3xeOze3l4b83Y+l7Onp6fthYUFOx6P24qi3EVfX991T08PYa1xeXmlukKhkFIul1usAgrb+Xxe4GYRiUSEr98nMtmMwGZRMAxRKpZEOp0SgUBAqKoqgsEgj22AqVqtnp+fX6guKFGgojUxMUGxWEwMDAwQFBI2ks/no7GxMeI1zmB8fJwAIQDJ7/fL8T7w4qKpurBBgaqWns+zN3yrhEG5PMAg9jSXy1EymaQw5lVcODgwKC/G/ofAUCisIN0W0qKlalUUi0VaWlqi1doqeyqNv7VDgssoCg7TysoKxeMxVvoQqGkhBZAWgwz4lEgkiIPTjI5HCcWQQIbxPIpCExjZmn+mrKqaBPKB2dlZMTY6Sv39/dI/r9dLqVSK+DJunym0iAY7UFkJu7XnL6CmKaheCz6yEsHG394soU4vsiUzUMvzDHKK86RCw9DZdOGkwgcYyAoZxheile5ATwIdD/lQJDIiePERkF+KUZBV5Xa5D30SyMbPzMyIoaEhpx3uUmYPq5WqfGYO0InHwNAfIFd5FEUJh8MPFOIl0fz8vOzN/ymULwVqGHjFxut5/QYetlHlNjcsj1DYxpqMVCrZZgBgcp1HfN8oipeB35vNy99vGf79kM2LpkXr0MjIyJ1fnGYZ/lYWK5wB1IccZTJ4H7cRgK1Go6G5fH6/B5Bv8K+JtBrRaNQaHh62/D6fhVQsvG9rbm7OgkIrm8lYgFlQbsEOGbi0gX+lJi77enp66nfh9wwxhEggYk50dnbGurq6YvfnOjo6Ym63W4687gS+E93d3cMer9f9CwpdL1MX+qFQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Globals"
        title="Globals"
        src="/static/c2bef52ca393ecb33846c54af34927a1/799d3/globals.png"
        srcset="/static/c2bef52ca393ecb33846c54af34927a1/00d96/globals.png 148w,
/static/c2bef52ca393ecb33846c54af34927a1/0b23c/globals.png 295w,
/static/c2bef52ca393ecb33846c54af34927a1/799d3/globals.png 590w,
/static/c2bef52ca393ecb33846c54af34927a1/2a3d6/globals.png 885w,
/static/c2bef52ca393ecb33846c54af34927a1/4a421/globals.png 1094w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>A variável especial _</h2>
<p>Se depois de um código você digitar <code class="language-text">_</code>, isso fará com que seja exibido o resultado da última operação.</p>
<h2>Comandos com ponto (dot commands)</h2>
<p>O REPL tem alguns comandos especiais, todos começando com um <code class="language-text">.</code>. Eles são:</p>
<ul>
<li><code class="language-text">.help</code>: exibe a guia de ajuda dos dot commands.</li>
<li><code class="language-text">.editor</code>: habilita o modo de editor, para escrever múltiplas linhas de código JavaScript com facilidade. Uma vez nesse modo, pressione ctrl-D para executar o código que foi escrito.</li>
<li><code class="language-text">.break</code>: quando estiver inserindo um código com múltiplas linhas, utilizar o comando .break fará com que a entrada seja abortada. Mesma funcionalidade de pressionar ctrl-C.</li>
<li><code class="language-text">.clear</code>: reinicia o contexto do REPL para um objeto vazio e cancela qualquer entrada corrente de múltiplas linhas.</li>
<li><code class="language-text">.load</code>: carrega um arquivo JavaScript, relativo ao diretório atual.</li>
<li><code class="language-text">.save</code>: salva todas suas entradas na sessão REPL em um arquivo (especifique um nome pro arquivo)</li>
<li><code class="language-text">.exit</code>: sai do repl (mesmo funcionamento de pressionar ctrl-C duas vezes)</li>
</ul>
<p>O REPL sabe quando você está inserindo uma entrada com múltiplas linhas sem a necessidade de utilizar o <code class="language-text">.editor</code>.</p>
<p>Por exemplo, se você começar a digitar uma iteração como essa:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">num</span> <span class="token operator">=></span> <span class="token punctuation">{</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e pressionar <code class="language-text">enter</code>, o REPL irá para uma nova linha que começa com 3 pontos, indicando que você pode continuar a trabalhar naquele bloco.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">...</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Se você digitar <code class="language-text">.break</code> no fim de uma linha, o modo múltiplas linhas irá parar e o código não será executado.</p>
<h2>O Node.JS aceita argumentos a partir da linha de comando.</h2>
<p>Você pode passar qualquer quantidade de argumentos quando está invocando uma aplicação Node.js, usando:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Argumentos podem ser com chave e valor ou diretos (sem chave).</p>
<p>Por exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js joe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>ou</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js <span class="token assign-left variable">name</span><span class="token operator">=</span>joe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Isso muda em como você obterá os valores no código Node.js.</p>
<p>A maneira de obtê-los é usando o objeto nativo <code class="language-text">process</code>.</p>
<p>Ele expõe uma propriedade chamada <code class="language-text">argv</code>, que é um array que contêm todos os argumentos passados na invocação.</p>
<p>O primeiro elemento é o caminho absoluto do comando <code class="language-text">node</code>.</p>
<p>O segundo é o caminho absoluto do arquivo em execução.</p>
<p>Todos os argumentos adicionais estão presentes da terceira posição em diante.</p>
<p>Você pode iterar sobre todos os argumentos (incluindo o caminho do node e o do arquivo) usando um loop:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>ou obter apenas os argumentos adicionais, criando um novo array que exclui os 2 primeiros parâmetros:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Se você tem um argumento direto (sem chave), como esse:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js joe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>você pode acessá-lo usando</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Já nesse caso:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js <span class="token assign-left variable">name</span><span class="token operator">=</span>joe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><code class="language-text">args[0]</code> é <code class="language-text">name=joe</code>, e você precisa tratá-lo. A melhor maneira de fazer isso é usando a biblioteca <a href="https://www.npmjs.com/package/minimist"><code class="language-text">minimist</code></a>, que ajuda a lidar com argumentos:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
args<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token comment">//joe</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Desta vez você você precisa usar dois traços antes do nome do argumento:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node app.js --name<span class="token operator">=</span>joe</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Output para a linha de comando usando Node.JS</h2>
<h2>Saída (output) básico usando o módulo console</h2>
<p>O Node.js provê o <a href="https://nodejs.org/api/console.html">módulo <code class="language-text">console</code></a> que possui uma infinidade de maneiras muito úteis para interagir com a linha de comando.</p>
<p>É basicamente o mesmo objeto <code class="language-text">console</code> encontrado no browser.</p>
<p>O método mais básico e mais usado é o <code class="language-text">console.log()</code>, que imprime a string que você passar como parâmetro.</p>
<p>Se você passar um objeto, ele irá renderizá-lo como uma string.</p>
<p>Você pode passar múltiplas variáveis para o <code class="language-text">console.log</code>, por exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token string">'x'</span>
<span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token string">'y'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>o Node.js vai printar ambas.</p>
<p>Nós também podemos formatar mensagens mais sofisticadas passando variáveis e um formato espeficador.</p>
<p>Por exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'My %s has %d years'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<ul>
<li><code class="language-text">%s</code> formata a variável como uma string</li>
<li><code class="language-text">%d</code> formata a variável como um número</li>
<li><code class="language-text">%i</code> formata a variável como um número, porém só a parte inteira</li>
<li><code class="language-text">%o</code> formata a variável como um objeto</li>
</ul>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%o'</span><span class="token punctuation">,</span> Number<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Limpando o console</h2>
<p><code class="language-text">console.clear()</code> limpa o console (o comportamento pode mudar dependendo do console utilizado).</p>
<h2>Contando elementos</h2>
<p><code class="language-text">console.count()</code> é um método muito conveniente.</p>
<p>Dado o código:</p>
<iframe
  title="Output to the command line using Node.js"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0013-02?path=server.js&previewSize=40&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0013-02 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">const</span> z <span class="token operator">=</span> <span class="token number">3</span>
console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>
  <span class="token string">'O valor de x é '</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">' e foi validado .. quantas vezes?'</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>
  <span class="token string">'O valor de x é '</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">' e foi validado .. quantas vezes?'</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>
  <span class="token string">'O valor de y é '</span> <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token string">' e foi validado .. quantas vezes?'</span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>O que acontece é que ele vai contar o número de vezes que uma string foi impressa, e imprime o total:</p>
<p>Você pode contar maçãs e laranjas, por exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> oranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token string">'orange'</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> apples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'just one apple'</span><span class="token punctuation">]</span>
oranges<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fruit</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
apples<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fruit</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Imprimindo a pilha de execução</h2>
<p>Existem casos onde é útil imprimir a pilha de execução da função, talvez para responder a clássica pergunta <em>como você chegou nessa parte do código?</em></p>
<p>Você pode isso fazer usando <code class="language-text">console.trace()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">function2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">function1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">function2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">function1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Isso irá imprimir a pilha de execução. Isso é o que é impresso se tentarmos usá-lo no REPL do Node.js:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Trace
    at function2 <span class="token punctuation">(</span>repl:1:33<span class="token punctuation">)</span>
    at function1 <span class="token punctuation">(</span>repl:1:25<span class="token punctuation">)</span>
    at repl:1:1
    at ContextifyScript.Script.runInThisContext <span class="token punctuation">(</span>vm.js:44:33<span class="token punctuation">)</span>
    at REPLServer.defaultEval <span class="token punctuation">(</span>repl.js:239:29<span class="token punctuation">)</span>
    at bound <span class="token punctuation">(</span>domain.js:301:14<span class="token punctuation">)</span>
    at REPLServer.runBound <span class="token punctuation">[</span>as eval<span class="token punctuation">]</span> <span class="token punctuation">(</span>domain.js:314:12<span class="token punctuation">)</span>
    at REPLServer.onLine <span class="token punctuation">(</span>repl.js:440:10<span class="token punctuation">)</span>
    at emitOne <span class="token punctuation">(</span>events.js:120:20<span class="token punctuation">)</span>
    at REPLServer.emit <span class="token punctuation">(</span>events.js:210:7<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Calculando o tempo gasto</h2>
<p>Você pode calcular facilmente o tempo que uma função gasta para rodar, usando <code class="language-text">time()</code> e <code class="language-text">timeEnd()</code></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">doSomething</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">measureDoingSomething</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'doSomething()'</span><span class="token punctuation">)</span>
  <span class="token comment">//faça algo, e calcule o tempo que isso levou</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'doSomething()'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">measureDoingSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>stdout e stderr</h2>
<p>Como nós vimos o  console.log é ótimo para imprimir mensagens no console. Isso é o que chamamos de saída padrão, ou <code class="language-text">stdout</code>.</p>
<p><code class="language-text">console.error</code> imprime na stream <code class="language-text">stderr</code>.</p>
<p>Isso não vai aparecer no console, mas vai aparecer no log de erro.</p>
<h2>Colorindo o saída</h2>
<p>Você pode colorir a saída do seu texto no console utilizando <a href="https://gist.github.com/iamnewton/8754917">escape sequences</a>, que basicamente são um conjunto de caracteres que indentificam uma cor.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\x1b[33m%s\x1b[0m'</span><span class="token punctuation">,</span> <span class="token string">'hi!'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Você pode testar isso no REPL no Node.js, onde será impresso <code class="language-text">hi!</code> em amarelo.</p>
<p>Entretanto, essa é uma abordagem mais baixo nível. O jeito mais simples de colorir saídas no console é utilizando uma biblioteca. <a href="https://github.com/chalk/chalk">Chalk</a> é uma biblioteca que além de colorir, também ajuda com outras facilidades de estilização, como deixar textos em negrito, ítalico ou sublinhados.</p>
<p>Instale com <code class="language-text">npm install chalk</code>, e então use-o assim:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Usando <code class="language-text">chalk.yellow</code> é muito mais conveniente do que tentar lembrar o código de cor correto, e o código fica muito mais legível.</p>
<p>Confira o link do projeto postado acima para mais exemplos de uso.</p>
<h2>Crie uma barra de progresso</h2>
<p><a href="https://www.npmjs.com/package/progress">Progress</a> é um pacote incrível para criar uma barra de progresso no console. Instale utilizando <code class="language-text">npm install progress</code>.</p>
<p>Esse trecho cria uma barra de progresso com 10 passos, e a cada 100ms um passo é completado. Quando a barra é completada nós finalizamos o contador.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> ProgressBar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressBar</span><span class="token punctuation">(</span><span class="token string">':bar'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> total<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  bar<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Aceite inputs do terminal no Node.js</h2>
<p>Como criar um programa Node.js de CLI interativa?</p>
<p>Desde a versão 7 o Node.js possui o <a href="https://nodejs.org/api/readline.html">módulo <code class="language-text">readline</code></a> para fazer exatamente isso: obter entradas de uma stream de leitura, como a <code class="language-text">process.stdin</code>, via terminal, durante a execução de um programa Node.js, uma linha por vez.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  input<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span>

readline<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">What's your name?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  readline<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esse trecho de código pergunta o nome do usuário, e uma vez que o texto é inserido e o usuário pressiona enter, nós enviamos uma saudação.</p>
<p>O método <code class="language-text">question()</code> exibe o primeiro parâmetro (a pergunta) e aguarda pela entrada do usuário. A função de callback é invocada uma vez que o enter é pressionado.</p>
<p>Nessa função de callback, nós fechamos a interface do readline.</p>
<p><code class="language-text">readline</code> oferece diversos outros métodos, e você pode conferir todos na documentação linkada acima.</p>
<p>Se você precisa solicitar uma senha, o ideal é que os caracteres digitados sejam trocados pelo símbolo de <code class="language-text">*</code>.</p>
<p>A maneira mais simples de fazer isso é utilizar o <a href="https://www.npmjs.com/package/readline-sync">pacote <code class="language-text">readline-sync</code></a>, que é muito similar em termos de API.</p>
<p>Outra solução mais completa e abstrata é fornecida pelo <a href="https://github.com/SBoudrias/Inquirer.js">pacote Inquirer.js</a>.</p>
<p>Instale-o utilizando <code class="language-text">npm install inquirer</code>, e então você poderá replicar o código acima dessa forma:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> questions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">"What's your name?"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Inquirer.js permite com que você faça diversas coisas como perguntas de múltipla escolha, ter radio buttons, confirmações e muito mais.</p>
<p>Vale a pena conhecer todas as alternativas, especialmente as nativas do Node.js, mas se você planeja levar a CLI para outro nível, Inquirer.js é ótima escolha.</p>
<h2>Expondo uma funcionalidade em um arquivo do Node.js usando exports</h2>
<p>O Node.js tem um sistema de módulos nativo.</p>
<p>Um arquivo Node.js pode importar funcionalidades expostas por outros arquivos Node.js.</p>
<p>Quando você quer importar algo você deve utilizar</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> library <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./library'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>para importar a funcionalidade exposta no arquivo <code class="language-text">library.js</code> que reside na pasta atual.</p>
<p>Nesse arquivo, a funcionalidade deve ser exposta antes de poder ser importada por outros arquivos.</p>
<p>Qualquer outra variável ou objeto definido no arquivo é privado por padrão e não exposto ao mundo exterior.</p>
<p>Isso é permitido por meio da API <code class="language-text">module.exports</code>, oferecida pelo <a href="https://nodejs.org/api/modules.html"><code class="language-text">module</code> system</a>.</p>
<p>Quando você atribui um objeto ou uma função como uma nova propriedade do <code class="language-text">exports</code>, isso se torna o que está sendo exposto, e como tal, pode ser importado em outras partes da sua aplicação, ou até em outras aplicações.</p>
<p>Você pode fazer isso de 2 formas.</p>
<p>A primeira é atribuir um objeto ao <code class="language-text">module.exports</code>, que é um objeto provido nativamente pelo sistema de módulos, e ele fará com que o arquivo exporte <em>apenas aquele objeto</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token punctuation">{</span>
  brand<span class="token punctuation">:</span> <span class="token string">'Ford'</span><span class="token punctuation">,</span>
  model<span class="token punctuation">:</span> <span class="token string">'Fiesta'</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> car

<span class="token comment">//..em outro arquivo</span>

<span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./car'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>A segunda é definir o objeto exportado como propriedade do <code class="language-text">exports</code>. Essa abordagem permite que você exporte múltiplos objetos, funções ou dados:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token punctuation">{</span>
  brand<span class="token punctuation">:</span> <span class="token string">'Ford'</span><span class="token punctuation">,</span>
  model<span class="token punctuation">:</span> <span class="token string">'Fiesta'</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>car <span class="token operator">=</span> car</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>ou diretamente</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">exports<span class="token punctuation">.</span>car <span class="token operator">=</span> <span class="token punctuation">{</span>
  brand<span class="token punctuation">:</span> <span class="token string">'Ford'</span><span class="token punctuation">,</span>
  model<span class="token punctuation">:</span> <span class="token string">'Fiesta'</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Em outro arquivo, você irá utilizá-lo referenciando a propriedade da sua importação:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./items'</span><span class="token punctuation">)</span>
items<span class="token punctuation">.</span>car</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>ou</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./items'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>car</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Qual a diferença entre <code class="language-text">module.exports</code> e <code class="language-text">exports</code>?</p>
<p>O primeiro expõe o objeto para qual ele aponta.
O último expõe <em>as propriedades</em> do objeto que ele aponta.</p>
<h2>Uma introdução ao gerenciador de pacotes NPM</h2>
<h2>Introdução ao npm</h2>
<p><code class="language-text">npm</code> é o gerenciador de pacotes padrão do Node.js.</p>
<p>Em janeiro de 2017 mais de 350.000 pacotes foram listados no registro do npm, fazendo dele o maior repositório de código de uma única linguagem na Terra, e você pode ter certeza que existe um pacote para (quase!) tudo.</p>
<p>Ele iniciou como um meio de fazer donwload e gerenciar dependências de pacotes Node.js, mas desde então ele se tornou uma ferramenta utilizada também no frontend.</p>
<p>Há muitas coisas que o <code class="language-text">npm</code> faz.</p>
<blockquote>
<p><a href="https://yarnpkg.com/en/"><strong>Yarn</strong></a> é uma alternativa ao npm. Não deixe de conferír.</p>
</blockquote>
<h2>Downloads</h2>
<p><code class="language-text">npm</code> gerencia downloads de dependências do seu projeto.</p>
<h3>Instalando todas dependências</h3>
<p>Se o projeto tem um arquivo <code class="language-text">package.json</code>, ao rodar</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>ele vai instalar tudo que o projeto precisa, na pasta <code class="language-text">node_modules</code>, criando-a se não existir.</p>
<h3>Instalando um único pacote</h3>
<p>Você também pode instalar um pacote específico ao rodar</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package-name<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Geralmente você verá mais flags adicionadas a esse comando:</p>
<ul>
<li><code class="language-text">--save</code> instala e adiciona uma entrada no campo <em>dependencies</em> do arquivo <code class="language-text">package.json</code></li>
<li><code class="language-text">--save-dev</code> instala e adiciona uma entrada no campo <em>devDependencies</em> do arquivo <code class="language-text">package.json</code></li>
</ul>
<p>A principal diferença é que no devDependencies ficam as ferramentas de desenvolvimento, como uma biblioteca de testes, enquanto no <code class="language-text">dependencies</code> ficam os pacotes necessários à aplicação em ambiente de produção.</p>
<h3>Atualizando pacotes</h3>
<p>Atualizar também é fácil, ao rodar</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console">npm update</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>o <code class="language-text">npm</code> vai buscar em todos os pacotes por uma versão atualizada que satisfaça suas restrições de versionamento.</p>
<p>Você também pode especificar um único pacote para atualizar:</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console">npm update &lt;package-name&gt;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Versionamento</h2>
<p>Em adição aos downloads, o <code class="language-text">npm</code> também gerencia o <strong>versionamento</strong>, assim você pode especificar qualquer versão do pacote, ou uma versão maior ou menor do que você precisa.</p>
<p>Muitas vezes você vai encontrar uma biblioteca que só é compatível com a versão atual de outra biblioteca.</p>
<p>Ou um bug na versão mais atual da biblioteca, ainda não solucionado, causando um problema.</p>
<p>Especificar explicitamente a versão da biblioteca também ajuda a manter todos na exata mesma versão do pacote, assim todos do time rodam a mesma versão até que o arquivo <code class="language-text">package.json</code> seja atualizado.</p>
<p>Em todos os casos, versionar ajuda muito, e o <code class="language-text">npm</code> segue o padrão semântico de versionamento chamado semver.</p>
<h2>Executando tarefas</h2>
<p>O arquivo package.json possui um campo chamado “scripts”, que é usado para especificar tarefas de linha de comando que podem ser rodadas usando</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console">npm run &lt;task-name&gt;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Por exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start-dev"</span><span class="token operator">:</span> <span class="token string">"node lib/server-development"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node lib/server-production"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>É muito comum usar esse recurso para rodar o Webpack:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"watch"</span><span class="token operator">:</span> <span class="token string">"webpack --watch --progress --colors --config webpack.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack --progress --colors --config webpack.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"prod"</span><span class="token operator">:</span> <span class="token string">"NODE_ENV=production webpack -p --config webpack.conf.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Então em vez de digitar esses comandos longos, que são muito fáceis de errar ou esquecer, você pode rodar</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console">npm run watch
npm run dev
npm run prod</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Onde o Node instala os pacotes?</h2>
<p>Quando você instala um pacote utilizando <code class="language-text">npm</code> você pode executar 2 tipos de instalação:</p>
<ul>
<li>local</li>
<li>global</li>
</ul>
<p>Por padrão, quando você digita o comando <code class="language-text">npm install</code>, como por exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> lodash</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>o pacote será instalado na árvore de arquivos atual, em uma subpasta dentro da <code class="language-text">node_modules</code>.</p>
<p>Quando isso ocorre, o <code class="language-text">npm</code> também adiciona uma entrada do <code class="language-text">lodash</code> na propriedade <code class="language-text">dependencies</code> do arquivo <code class="language-text">package.json</code> da pasta atual.</p>
<p>Para executar uma instalação global, basta utilizar a flag <code class="language-text">-g</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g lodash</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Quando isso ocorre, o npm não instalará na pasta local, em vez disso, ele utilizará uma localização global.</p>
<p>Onde, exatamente?</p>
<p>O comando <code class="language-text">npm root -g</code> te dirá a localização exata na sua máquina.</p>
<p>No macOS ou Linux, essa localização costuma ser <code class="language-text">/usr/local/lib/node_modules</code>.
No Windows costuma ser <code class="language-text">C:\Users\YOU\AppData\Roaming\npm\node_modules</code></p>
<p>Todavia, se você utiliza o <code class="language-text">nvm</code> para gerenciar versões do Node.js, a localização pode ser diferente.</p>
<p>Eu por exemplo utilizo <code class="language-text">nvm</code> e a localização dos meus pacotes foi exibida como <code class="language-text">/Users/joe/.nvm/versions/node/v8.9.0/lib/node_modules</code>.</p>
<h2>Como usar ou executar um pacote instalado usando NPM?</h2>
<p>Quando você instala um pacote usando <code class="language-text">npm</code> dentro da sua pasta <code class="language-text">node_modules</code>, ou também globamente, como você o utiliza em seu código Node.js?</p>
<p>Digamos que você instale a famosa biblioteca JavaScript de utilidades chamada <code class="language-text">lodash</code>, usando</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> lodash</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Isso irá instalar o pacote na sua pasta <code class="language-text">node_modules</code> local.</p>
<p>Para utilizá-lo em seu código, você só precisa importá-lo no seu programa utilizando <code class="language-text">require</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Mas e se o seu pacote for um executável?</p>
<p>Nesse caso, ele para a pasta <code class="language-text">node_modules/.bin/</code>.</p>
<p>Um jeito fácil de demonstrar isso é utilizando o <a href="https://www.npmjs.com/package/cowsay">cowsay</a>.</p>
<p>O pacote cowsay fornece um programa de linha de comando que faz com que uma vaca diga algo (e outros animais também 🦊).</p>
<p>Quando você instala o pacote utilizando <code class="language-text">npm install cowsay</code>, ele irá instalar a si mesmo e algumas poucas dependências na sua pasta node_modules local:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b245c50f5080dae16a2525fae0ba2c91/6e914/node_modules-content.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.55758880516685%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACf0lEQVQoz6WSW08aQRTH7S3ti4BGIxFcFOQqLLssl3WvULlItWW5LaVpmzbxwc8gD/1KfTJRnmrq1tSkL7xoAPkedWdOZ5dq20SfOskvZ+ZhfvmfMzMzQ9bFl8/C+aDfGo0nteFwqF1eDrXRaETqhXZ+/l07O/tmYxin2mAw0CaTiTYej2+5urqy7tVPTk7cRPfo8Vu9YXQ/tKHZbEGno0O32wFd16Gjv4ZGowmN+hS91YF6vQ7tdhtardYttVoN9vf34fDwsGsFfFbOq6e8kgJvyHed4+NoZzeN4tEEyrIyyjICKsm7qKLUUCKaRAuLC2jRZhEtLS0ht9uNXC7XNcdx0O/331vCp6qwafAiB8GNsMlvMrhUymCGZvFmWsY5TsCqUMRFuYoVvoDpOINZmsNMIoUDgYCN1+s1JUmCo6Ojd3bCneJzQy3xEKQjpiinoN4QIc1moCBWQMrloZJ/Cc3qGxCzCiRiSeCSWSBiWFtbs8DLy8tIFEU4Pj6eCqtbBUMtToWKmgZNE2yhlCuATNjOvwKt0oEtaRtCwRB4VzxA+ShYXV29W5gXBYOXOFiPhcwcn4RyOQNMggUhqwJpGYSMCmV1B2S+AH6//ybZ/Qm3ZNEQVCKMW0IaV19k7RkSkT1DkgxrZZ3MLo0pagVbEpLO5k5hPEZ/TbM5kor7SS6Z9EbKJHvT2sciGyZFUSZp0fT5fCYRmER0i3UmwmtBEP48CkuzP5gkC8H1EITDEYgQwiGrRiFIZma16fcHftd/Ia8MHo8HFEWxvs1HS/hkdna263A6PjldzgOn09Gb4rQr+WO9ubm5e5mfn+85HI4eSX+wt7cXm/lrPfxPHliSX2DgWdzvML3rAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="O conteúdo da pasta node_modules"
        title="O conteúdo da pasta node_modules"
        src="/static/b245c50f5080dae16a2525fae0ba2c91/799d3/node_modules-content.png"
        srcset="/static/b245c50f5080dae16a2525fae0ba2c91/00d96/node_modules-content.png 148w,
/static/b245c50f5080dae16a2525fae0ba2c91/0b23c/node_modules-content.png 295w,
/static/b245c50f5080dae16a2525fae0ba2c91/799d3/node_modules-content.png 590w,
/static/b245c50f5080dae16a2525fae0ba2c91/2a3d6/node_modules-content.png 885w,
/static/b245c50f5080dae16a2525fae0ba2c91/6e914/node_modules-content.png 929w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Há uma pasta oculta chamada .bin, que contêm links simbólicos para os binários do cowsay:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/99830aefa055e247397de544ad7b7744/6e914/binary-files.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.213132400430574%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQoz6WNv27aUBSHTV6A2EJtl95rG+wkGF8bqJuAMpBITJGwwPyxg8rQZ0iGLCAegXfpECmbpU7EHVCHKAkYnsO69/TaSlUxVB16pE9HP+l3viO8ht/Oop8P3jredeL1xn15WbubTcz3s7t8XGZEy6X7I4rciPP89OSmvfiVE8fudrvt7LY7b7VaOUI6X0ZeOP46gsFwCP61D+NxAEHggz8KoO/1wfM86PX70O12odvr8c41+EEAI94d8pvBYAC+78NisbjPhM6pHX5qmIAMJdGaJ/Tqqk4J0alVdqhDzmi91qD2xSU9tqsUYUzN5jm1Wi2qtSwq1zX64d37pFAowHQ6vQeAnKBremiZNlQMkpgVixGTMNMgjFSqfFvMKJtM03VW1DSmqiorFos8H/FcYqWjUpoTjDHM5/NUKAgNpxk2Pp+DWbYS26wxYlQzmVWpZcLyscFURWWyjJmiKHzLe/AnCULoj1DG+LuiKoDQR0AY7YEzMPBD4LK/kgpns9lDJswfHnqiKN1JknTDud1DlG5FUfwXN/l8/q7dbncmk8mB8DY5zsF/kPst+gUx2eZmkZP0+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Os arquivos binários"
        title="Os arquivos binários"
        src="/static/99830aefa055e247397de544ad7b7744/799d3/binary-files.png"
        srcset="/static/99830aefa055e247397de544ad7b7744/00d96/binary-files.png 148w,
/static/99830aefa055e247397de544ad7b7744/0b23c/binary-files.png 295w,
/static/99830aefa055e247397de544ad7b7744/799d3/binary-files.png 590w,
/static/99830aefa055e247397de544ad7b7744/2a3d6/binary-files.png 885w,
/static/99830aefa055e247397de544ad7b7744/6e914/binary-files.png 929w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Como você executa isso?</p>
<p>É claro que você pode digitar <code class="language-text">./node_modules/.bin/cowsay</code> para executar, e vai funcionar, mas o npx, incluso nas versões recentes do npm (desde a 5.2), é uma opção muito melhor. Você só roda:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">npx cowsay</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e o npx vai encontrar a localização do pacote.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/6e914/cow-say.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.65123789020452%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB5ElEQVQoz6WSz2vacBTA0w3awo5qogjmh+aH05guLmZjp8FOE9FLA1UEHaNHQethUPHkxb+hu/Syf2Lsou1lLBDXYexpf0dJzNv7fmeFQrsNFvjwHu9988nj5cucMsD8+PLp9aX3uekvrw+X/tLxfd9ZrVaO53nOfD6nXF5cOLPZzHFdl/bImQ2HSHOxWLxhyFNkCvuNxlvv6N0RHL8/hm63C51OB9rtNrSaTWi1WlCtVrfUajWo1+t3aDQaMJlMluVyeYc4nyha/ptt22BZVmAYxrpSqaw1TVunUql1Op2m8ZZkMnkHrAWJRAJ6vd736XS6R4WyLLu6roOul0IURphHWIsEQYhEUYwkSXqQbDYb4jkYnJxcjUajXSrMZDIuKZKmXbGJEFAIOCUQ4QZ4gBDfh8FgcDUej38LeT7jkibP86GqqoBTQsko0UmxB+RjREriJv+zUBBEV1U0UGQ1RKJiQSdAXnsKuawcEW6l/zThS+vVV8t8AUbRvHlWeh4cFM0A84DkeuEgyGuFAIX3gsIbIuz3+952h6qiXJOdiaIAkiRuEWmUKLjfe8nlcnTS4XD4E/8yFe7HYrEPLMuecxx3xrHcRwK7jezfOIvH4+d4F09N09xl8CaSy/gY2ftPHiE7vwCdfSn927UbRQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="A vaca dizendo &quot;take me out of here&quot;"
        title="A vaca dizendo &quot;take me out of here&quot;"
        src="/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/799d3/cow-say.png"
        srcset="/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/00d96/cow-say.png 148w,
/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/0b23c/cow-say.png 295w,
/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/799d3/cow-say.png 590w,
/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/2a3d6/cow-say.png 885w,
/static/ad4f3d3a7464bb0f8a2845fe8e6588c2/6e914/cow-say.png 929w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>O Guia do package.json</h2>
<p>Se você trabalha com JavaScript, ou já interagiu com um projeto JavaScript, Node.js ou um projeto frontend, você certamente conheceu o arquivo <code class="language-text">package.json</code>.</p>
<p>Pra que ele serve? O que você deveria saber sobre ele, e o quê de legal pode ser feito com ele?</p>
<p>O <code class="language-text">package.json</code> é uma espécie de manifesto do seu projeto. Ele pode fazer uma variedade de coisas, completamente não relacionadas. É um repositório central de configurações para ferramentas, por exemplo. Também é onde o <code class="language-text">npm</code> e o <code class="language-text">yarn</code> armazenam os nomes e versões de todos os pacotes instalados.</p>
<h2>The file structure</h2>
<p>Aqui temos um exemplo de arquivo package.json:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Está vazio! Não há campos fixos obrigatórios do que pode ser colocado no arquivo <code class="language-text">package.json</code>, de uma aplicação. A única exigência é que respeite o formato JSON, caso contrário programas que tentem acessar as propriedades programaticamente não terão sucesso.</p>
<p>Se você está criando um pacote Node.js que precisa ser distribuido no <code class="language-text">npm</code> as coisas mudam radicalmente, e você necessita preencher algumas propriedades que vão ajudar outras pessoas a utilizar seu pacote. Vamos ver mais sobre isso em breve.</p>
<p>Esse é outro package.json:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"test-project"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Ele define uma propriedade <code class="language-text">name</code>, que diz o nome da aplicação, ou pacote, que está contido na mesma pasta em que o arquivo reside.</p>
<p>Aqui temos outro exemplo muito mais complexo, que foi extraido de uma aplicação Vue.js:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"test-project"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"A Vue.js project"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"src/main.js"</span><span class="token punctuation">,</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --inline --progress --config build/webpack.dev.conf.js"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"npm run dev"</span><span class="token punctuation">,</span>
    <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"jest --config test/unit/jest.conf.js --coverage"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"npm run unit"</span><span class="token punctuation">,</span>
    <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint --ext .js,.vue src test/unit"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node build/build.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vue"</span><span class="token operator">:</span> <span class="token string">"^2.5.2"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"autoprefixer"</span><span class="token operator">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-core"</span><span class="token operator">:</span> <span class="token string">"^6.22.1"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-eslint"</span><span class="token operator">:</span> <span class="token string">"^8.2.1"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-helper-vue-jsx-merge-props"</span><span class="token operator">:</span> <span class="token string">"^2.0.3"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-jest"</span><span class="token operator">:</span> <span class="token string">"^21.0.2"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-loader"</span><span class="token operator">:</span> <span class="token string">"^7.1.1"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-plugin-dynamic-import-node"</span><span class="token operator">:</span> <span class="token string">"^1.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-plugin-syntax-jsx"</span><span class="token operator">:</span> <span class="token string">"^6.18.0"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-plugin-transform-es2015-modules-commonjs"</span><span class="token operator">:</span> <span class="token string">"^6.26.0"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-plugin-transform-runtime"</span><span class="token operator">:</span> <span class="token string">"^6.22.0"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-plugin-transform-vue-jsx"</span><span class="token operator">:</span> <span class="token string">"^3.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-preset-env"</span><span class="token operator">:</span> <span class="token string">"^1.3.2"</span><span class="token punctuation">,</span>
    <span class="token property">"babel-preset-stage-2"</span><span class="token operator">:</span> <span class="token string">"^6.22.0"</span><span class="token punctuation">,</span>
    <span class="token property">"chalk"</span><span class="token operator">:</span> <span class="token string">"^2.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"copy-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^4.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"css-loader"</span><span class="token operator">:</span> <span class="token string">"^0.28.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint"</span><span class="token operator">:</span> <span class="token string">"^4.15.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-config-airbnb-base"</span><span class="token operator">:</span> <span class="token string">"^11.3.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-friendly-formatter"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-import-resolver-webpack"</span><span class="token operator">:</span> <span class="token string">"^0.8.3"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-loader"</span><span class="token operator">:</span> <span class="token string">"^1.7.1"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-plugin-import"</span><span class="token operator">:</span> <span class="token string">"^2.7.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-plugin-vue"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"extract-text-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"file-loader"</span><span class="token operator">:</span> <span class="token string">"^1.1.4"</span><span class="token punctuation">,</span>
    <span class="token property">"friendly-errors-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^1.6.1"</span><span class="token punctuation">,</span>
    <span class="token property">"html-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^2.30.1"</span><span class="token punctuation">,</span>
    <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token string">"^22.0.4"</span><span class="token punctuation">,</span>
    <span class="token property">"jest-serializer-vue"</span><span class="token operator">:</span> <span class="token string">"^0.3.0"</span><span class="token punctuation">,</span>
    <span class="token property">"node-notifier"</span><span class="token operator">:</span> <span class="token string">"^5.1.2"</span><span class="token punctuation">,</span>
    <span class="token property">"optimize-css-assets-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^3.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"ora"</span><span class="token operator">:</span> <span class="token string">"^1.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"portfinder"</span><span class="token operator">:</span> <span class="token string">"^1.0.13"</span><span class="token punctuation">,</span>
    <span class="token property">"postcss-import"</span><span class="token operator">:</span> <span class="token string">"^11.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"postcss-loader"</span><span class="token operator">:</span> <span class="token string">"^2.0.8"</span><span class="token punctuation">,</span>
    <span class="token property">"postcss-url"</span><span class="token operator">:</span> <span class="token string">"^7.2.1"</span><span class="token punctuation">,</span>
    <span class="token property">"rimraf"</span><span class="token operator">:</span> <span class="token string">"^2.6.0"</span><span class="token punctuation">,</span>
    <span class="token property">"semver"</span><span class="token operator">:</span> <span class="token string">"^5.3.0"</span><span class="token punctuation">,</span>
    <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.7.6"</span><span class="token punctuation">,</span>
    <span class="token property">"uglifyjs-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^1.1.1"</span><span class="token punctuation">,</span>
    <span class="token property">"url-loader"</span><span class="token operator">:</span> <span class="token string">"^0.5.8"</span><span class="token punctuation">,</span>
    <span class="token property">"vue-jest"</span><span class="token operator">:</span> <span class="token string">"^1.0.2"</span><span class="token punctuation">,</span>
    <span class="token property">"vue-loader"</span><span class="token operator">:</span> <span class="token string">"^13.3.0"</span><span class="token punctuation">,</span>
    <span class="token property">"vue-style-loader"</span><span class="token operator">:</span> <span class="token string">"^3.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"vue-template-compiler"</span><span class="token operator">:</span> <span class="token string">"^2.5.2"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"^3.6.0"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-bundle-analyzer"</span><span class="token operator">:</span> <span class="token string">"^2.9.0"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-dev-server"</span><span class="token operator">:</span> <span class="token string">"^2.9.1"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-merge"</span><span class="token operator">:</span> <span class="token string">"^4.1.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"engines"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">">= 6.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"npm"</span><span class="token operator">:</span> <span class="token string">">= 3.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"> 1%"</span><span class="token punctuation">,</span> <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span> <span class="token string">"not ie &lt;= 8"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>há <em>muitas</em> coisas rolando aqui:</p>
<ul>
<li><code class="language-text">version</code> indica a versão atual</li>
<li><code class="language-text">name</code> define o nome da aplicação</li>
<li><code class="language-text">description</code> é uma breve descrição da aplicação</li>
<li><code class="language-text">main</code> define o ponto de entrada da aplicação</li>
<li><code class="language-text">private</code> se definido como <code class="language-text">true</code>, previne da aplicação ser publicada acidentalmente no <code class="language-text">npm</code></li>
<li><code class="language-text">scripts</code> define alguns scripts node que você pode rodar na linha de comando</li>
<li><code class="language-text">dependencies</code> define uma lista de pacotes <code class="language-text">npm</code> instalados como dependências</li>
<li><code class="language-text">devDependencies</code> define uma lista de pacotes <code class="language-text">npm</code> instalados como dependências de desenvolvimento</li>
<li><code class="language-text">engines</code> define em quais versões do Node.js essa aplicação funciona</li>
<li><code class="language-text">browserslist</code> é usado para definir quais browsers (e suas versões) você quer dar suporte</li>
</ul>
<p>Todas essas propriedades são usadas tanto pelo <code class="language-text">npm</code> quando outras ferramentas.</p>
<h2>Separação de propriedades</h2>
<p>Essa seção descreve as propriedades que você pode usar em detalhes. Nós nos referimos como “pacote” mas o mesmo se aplica à aplicações locais que você não utiliza como pacotes.</p>
<p>A maioria dessas propriedades são usadas apenas no <a href="https://www.npmjs.com/">https://www.npmjs.com/</a>, outras por scripts que interagem com seu código, como o <code class="language-text">npm</code> ou outros.</p>
<h3>name</h3>
<p>Define o nome do pacote.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"test-project"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>O nome deve ter menos de 214 caracteres, não pode ter espaços, apenas letras minúsculas, hífens (<code class="language-text">-</code>) ou underlines (<code class="language-text">_</code>).</p>
<p>Isso ocorre porque quando um pacote é publicado no <code class="language-text">npm</code>, ele ganha sua própria URL baseada nessa propriedade.</p>
<p>Se você publicou esse pacote no GitHub, é uma boa definir essa propriedade com o nome do repositório no GitHub.</p>
<h3>author</h3>
<p>Lista o nome do autor do pacote</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Joe &lt;joe@whatever.com> (https://whatever.com)"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Também pode ser usado com esse formato:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Joe"</span><span class="token punctuation">,</span>
    <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"joe@whatever.com"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://whatever.com"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>contributors</h3>
<p>Assim como o autor, o projeto pode ter muitos contribuidores. Essa propriedade é um array que os lista.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"contributors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Joe &lt;joe@whatever.com> (https://whatever.com)"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Também pode ser usado com esse formato:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"contributors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Joe"</span><span class="token punctuation">,</span>
      <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"joe@whatever.com"</span><span class="token punctuation">,</span>
      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://whatever.com"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>bugs</h3>
<p>Link para o rastreador de issues do pacote, geralmente uma página de issues do GitHub</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"bugs"</span><span class="token operator">:</span> <span class="token string">"https://github.com/whatever/package/issues"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3>homepage</h3>
<p>Define a página inicial do site do pacote</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"homepage"</span><span class="token operator">:</span> <span class="token string">"https://whatever.com/package"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3>version</h3>
<p>Indica a versão atual do pacote.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Essa propriedade segue o padrão de notação de versionamento semântico chamado <em>semver</em>, o que significa que é sempre expresso com 3 números: <code class="language-text">x.x.x</code>.</p>
<p>O primeiro número é sempre a versão major, o segundo a versão minor e o terceiro a versão patch.</p>
<p>Há um significado nesses números: uma versão que só corrige bugs é uma versão patch, uma versão que introduz mudanças compatíveis com versões anteriores é uma versão minor, uma versão major pode conter quebra de comportamentos com versões antigas.</p>
<h3>license</h3>
<p>Indica a licença do pacote.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>keywords</h3>
<p>Esse propriedade contêm um array de palavras chave que são associadas a o quê esse projeto faz.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">"email"</span><span class="token punctuation">,</span>
  <span class="token string">"machine learning"</span><span class="token punctuation">,</span>
  <span class="token string">"ai"</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Isso ajuda pessoas a encontrarem seu pacote quando estiverem navegando por pacotes semelhantes, ou quando estiverem navegando no site <a href="https://www.npmjs.com/">https://www.npmjs.com/</a>.</p>
<h3>description</h3>
<p>Essa propriedade contêm uma breve descrição do pacote</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Um pacote para trabalhar com strings"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Isso é útil especialmente se você decide publicar seu pacote no <code class="language-text">npm</code>, assim as pessoas podem encontrar sobre o quê se trata aquele pacote.</p>
<h3>repository</h3>
<p>Essa propriedade especifica onde o repositório desse pacote está localizado.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"repository"</span><span class="token operator">:</span> <span class="token string">"github:whatever/testing"</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Note o prefixo <code class="language-text">github</code>. Também há outros serviços populares:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"repository"</span><span class="token operator">:</span> <span class="token string">"gitlab:whatever/testing"</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"repository"</span><span class="token operator">:</span> <span class="token string">"bitbucket:whatever/testing"</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Você pode explicitar o sistema de controle de versionamento:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/whatever/testing.git"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você pode usar diferentes tipos de controle de versionamento:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"svn"</span><span class="token punctuation">,</span>
  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"..."</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h3>main</h3>
<p>Define o ponto de entrada do pacote.</p>
<p>Quando você importa esse pacote em uma aplicação, é onde a aplicação vai procurar pelo <em>module exports</em>.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"src/main.js"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>private</h3>
<p>Se definido como <code class="language-text">true</code>, previne do pacote ser publicado acidentalmente no <code class="language-text">npm</code></p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>scripts</h3>
<p>Define um conjunto de scripts node que você pode executar</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --inline --progress --config build/webpack.dev.conf.js"</span><span class="token punctuation">,</span>
  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"npm run dev"</span><span class="token punctuation">,</span>
  <span class="token property">"unit"</span><span class="token operator">:</span> <span class="token string">"jest --config test/unit/jest.conf.js --coverage"</span><span class="token punctuation">,</span>
  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"npm run unit"</span><span class="token punctuation">,</span>
  <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint --ext .js,.vue src test/unit"</span><span class="token punctuation">,</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node build/build.js"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esses scripts são aplicações de linha de comando. Você pode rodá-los usando <code class="language-text">npm run XXXX</code> ou <code class="language-text">yarn XXXX</code>, sendo <code class="language-text">XXXX</code> o nome do comando. Exemplo: <code class="language-text">npm run dev</code>.</p>
<p>Você pode usar o nome que quiser para o comando, e os scripts podem fazer qualquer coisa.</p>
<h3>dependencies</h3>
<p>Define uma lista de pacotes <code class="language-text">npm</code> instalados como dependências.</p>
<p>Quando você instala um pacote usando npm ou yarn:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>PACKAGENAME<span class="token operator">></span>
<span class="token function">yarn</span> <span class="token function">add</span> <span class="token operator">&lt;</span>PACKAGENAME<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>esse pacote é inserido automaticamente nessa lista.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"vue"</span><span class="token operator">:</span> <span class="token string">"^2.5.2"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3>devDependencies</h3>
<p>Define uma lista de pacotes <code class="language-text">npm</code> instalados como dependências de desenvolvimento.</p>
<p>Eles se diferem dos pacotes no <code class="language-text">dependencies</code> porque eles são instalados apenas em ambiente de desenvolvimento, não são necessários para rodar o código em produção.</p>
<p>Quando você instala um pacote usando npm ou yarn:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token operator">&lt;</span>PACKAGENAME<span class="token operator">></span>
<span class="token function">yarn</span> <span class="token function">add</span> --dev <span class="token operator">&lt;</span>PACKAGENAME<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>esse pacote é inserido automaticamente nessa lista.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"autoprefixer"</span><span class="token operator">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>
  <span class="token property">"babel-core"</span><span class="token operator">:</span> <span class="token string">"^6.22.1"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h3>engines</h3>
<p>Define em quais versões do Node.js e outros comandos esse pacote opera</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"engines"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">">= 6.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"npm"</span><span class="token operator">:</span> <span class="token string">">= 3.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"yarn"</span><span class="token operator">:</span> <span class="token string">"^0.13.0"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>browserslist</h3>
<p>É usado para definir quais browsers (e suas versões) você deseja dar suporte. É refenciado pelo Babel, Autoprefixer, e outras ferramentas, apenas para adicionar polyfills e fallbacks necessárias para o browser em questão.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">"> 1%"</span><span class="token punctuation">,</span>
  <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span>
  <span class="token string">"not ie &lt;= 8"</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Essa configuração implica que você quer dar suporte paras as 2 últimas versões major de todos os browsers com pelo menos 1% de uso (das estatísticas do <a href="https://caniuse.com">CanIUse.com</a>), exceto IE8 ou anterior.</p>
<p>(<a href="https://www.npmjs.com/package/browserslist">veja mais sobre</a>)</p>
<h3>Propriedades específicas de comandos</h3>
<p>O arquivo <code class="language-text">package.json</code> também pode conter configurações específicas de comandos, como por exemplo Babel, ESLint, e mais.</p>
<p>Cada um tem propriedades específicas, como <code class="language-text">eslintConfig</code>, <code class="language-text">babel</code> e outras. Você pode encontrar como utilizá-las em suas respectivas documentações.</p>
<h2>Versões dos pacotes</h2>
<p>Você viu nos exemplos acima números como esse: <code class="language-text">~3.0.0</code> ou <code class="language-text">^0.13.0</code>. O que eles significam, e quais outros especificadores de versão você pode usar?</p>
<p>O símbolo especifica quais atualizações seu pacote aceita, para aquela dependência.</p>
<p>Dado que ao usar semver (versionamento semântico) todas versões têm 3 dígitos, o primeiro sendo a versão major, o segundo a versão minor e o terceiro a versão patch, você tem essas <a href="https://nodejs.dev/learn/semantic-versioning-using-npm/">regras</a>.</p>
<p>Você pode combinar a maioria das versões em intervalos, como esse: <code class="language-text">1.0.0 || &gt;=1.1.0 &lt;1.2.0</code>, para usar ou 1.0.0 ou uma versão maior ou igual que 1.1.0, mas menor que 1.2.0.</p>
<h2>O arquivo package-lock.json</h2>
<p>Na versão 5, o npm introduziu o arquivo <code class="language-text">package-lock.json</code>.</p>
<p>O que é isso? Você provavelmente conhece sobre o arquivo <code class="language-text">package.json</code>, que é muito mais comum e está por aí a mais tempo.</p>
<p>O objeto do arquivo é manter rastreada a versão exata de cada pacote que está instalado, assim o produto é 100% reproduzível mesmo que pacotes sejam atualizados pelos seus mantenedores.</p>
<p>Isso resolve um problema muito específico que o <code class="language-text">package.json</code> deixou para trás. No package.json você pode definir para quais versões você quer atualizar (patch ou minor), usando a notação <strong>semver</strong>, por exemplo:</p>
<ul>
<li>se você especifica <code class="language-text">~0.13.0</code>, você quer atualizar apenas para versões patch: <code class="language-text">0.13.1</code> está ok, mas <code class="language-text">0.14.0</code> não está.</li>
<li>se você especifica <code class="language-text">^0.13.0</code>, você quer atualizar tanto para versões patch quanto minor: <code class="language-text">0.13.1</code>, <code class="language-text">0.14.0</code> e assim por diante.</li>
<li>se você especifica <code class="language-text">0.13.0</code>, essa é a versão exata que será utilizada, sempre</li>
</ul>
<p>Você não commita a pasta node_modules no seu Git, que geralmente é gigantesca, e quando você tenta replicar o projeto em outra máquina utilizando o comando <code class="language-text">npm install</code>, se você especificou com a sintaxe <code class="language-text">~</code> e uma versão patch do pacote foi lançada, ela que será instalada. O mesmo para <code class="language-text">^</code> e versões inferiores.</p>
<blockquote>
<p>Se você especifica versões exatas, como a <code class="language-text">0.13.0</code> do exemplo, você não será afetado por esse problema.</p>
</blockquote>
<p>Pode ser com você, ou com outra pessoa do outro lado do mundo tentando inicializar o projeto rodando <code class="language-text">npm install</code>.</p>
<p>Então seu projeto original e o novo projeto recém inicializado são na verdade diferentes. Mesmo que uma versão patch ou minor não introduza mudanças que quebrem códigos antigos, nós todos sabemos que bugs podem (e vão) surgir.</p>
<p>O <code class="language-text">package-lock.json</code> grava na pedra a exata versão instalada de cada pacote, e o <code class="language-text">npm</code> vai utilizar essas exatas versões quando rodar <code class="language-text">npm install</code>.</p>
<p>Esse conceito não é novo, e gerenciadores de pacotes de outras linguages (como o Composer no PHP) utilizam desse sistema por anos.</p>
<p>O arquivo <code class="language-text">package-lock.json</code> precisa ser commitado no seu repositório Git, assim ele pode ser encontrado por outras pessoas, se o projeto é público ou você tem colaboradores, ou se você utiliza o GIT como fonte para deploys.</p>
<p>As versões das dependências vão ser atualizadas no arquivo <code class="language-text">package-lock.json</code> quando você rodar <code class="language-text">npm update</code>.</p>
<h2>Um exemplo</h2>
<p>Essa é uma estrutura de exemplo de um arquivo <code class="language-text">package-lock.json</code> que é obtida quando rodamos <code class="language-text">npm install cowsay</code> em uma pasta vazia:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"lockfileVersion"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"ansi-regex"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"3.0.0"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> "https<span class="token operator">:</span><span class="token comment">//registry.npmjs.org/ansi-regex/-/ansi-regex-3.</span>
<span class="token number">0.0</span>.tgz"<span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-7QMXwyIGT3lGbAKWa922Bas32Zg="</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"cowsay"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.3.1"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/cowsay/-/cowsay-1.3.1.tgz"</span>
<span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> "sha<span class="token number">512</span><span class="token number">-3</span>PVFe<span class="token number">6</span>FePVtPj<span class="token number">1</span>HTeLin<span class="token number">9</span>v<span class="token number">8</span>WyLl+VmM<span class="token number">1</span>l<span class="token number">1</span>H/<span class="token number">5</span>P+BTTDkM
Ajufp+<span class="token number">0</span>F<span class="token number">9</span>eLjzRnOHzVAYeIYFF<span class="token number">5</span>po<span class="token number">5</span>NjRrgefnRMQ=="<span class="token punctuation">,</span>
      <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"get-stdin"</span><span class="token operator">:</span> <span class="token string">"^5.0.1"</span><span class="token punctuation">,</span>
        <span class="token property">"optimist"</span><span class="token operator">:</span> <span class="token string">"~0.6.1"</span><span class="token punctuation">,</span>
        <span class="token property">"string-width"</span><span class="token operator">:</span> <span class="token string">"~2.1.1"</span><span class="token punctuation">,</span>
        <span class="token property">"strip-eof"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"get-stdin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"5.0.1"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> "https<span class="token operator">:</span><span class="token comment">//registry.npmjs.org/get-stdin/-/get-stdin-5.0.</span>
<span class="token number">1.</span>tgz"<span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-Ei4WFZHiH/TFJTAwVpPyDmOTo5g="</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"is-fullwidth-code-point"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> "https<span class="token operator">:</span><span class="token comment">//registry.npmjs.org/is-fullwidth-code-point/-/</span>
is-fullwidth-code-point<span class="token number">-2.0</span>.<span class="token number">0.</span>tgz"<span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-o7MKXE8ZkYMWeqq5O+764937ZU8="</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.10"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> "https<span class="token operator">:</span><span class="token comment">//registry.npmjs.org/minimist/-/minimist-0.0.10</span>
.tgz"<span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-3j+YVD2/lggr5IrRoMfNqDYwHc8="</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"optimist"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.6.1"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/optimist/-/optimist-0.6.1.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-2j6nRob6IaGaERwybpDrFaAZZoY="</span><span class="token punctuation">,</span>

      <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"~0.0.1"</span><span class="token punctuation">,</span>
        <span class="token property">"wordwrap"</span><span class="token operator">:</span> <span class="token string">"~0.0.2"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"string-width"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.1.1"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/string-width/-/string-width-2.1.1.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha512-nOqH59deCq9SRHlxq1Aw85Jnt4w6KvLKqWVik6oA9ZklXLNIOlqg4F2yrT1MVaTjAqvVwdfeZ7w7aCvJD7ugkw=="</span><span class="token punctuation">,</span>
      <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"is-fullwidth-code-point"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>
        <span class="token property">"strip-ansi"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"strip-ansi"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"4.0.0"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/strip-ansi/-/strip-ansi-4.0.0.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-qEeQIusaw2iocTibY1JixQXuNo8="</span><span class="token punctuation">,</span>
      <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"ansi-regex"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"strip-eof"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/strip-eof/-/strip-eof-1.0.0.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-u0P/VZim6wXYm1n80SnJgzE2Br8="</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"wordwrap"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.3"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/wordwrap/-/wordwrap-0.0.3.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha1-o9XabNXAvAAI03I0u68b7WMFkQc="</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Nós instalamos o <code class="language-text">cowsay</code>, que depende de:</p>
<ul>
<li><code class="language-text">get-stdin</code></li>
<li><code class="language-text">optimist</code></li>
<li><code class="language-text">string-width</code></li>
<li><code class="language-text">strip-eof</code></li>
</ul>
<p>Por sua vez, esses pacotes dependem de outros pacotes, como podemos ver nos <code class="language-text">requires</code> de alguns deles:</p>
<ul>
<li><code class="language-text">ansi-regex</code></li>
<li><code class="language-text">is-fullwidth-code-point</code></li>
<li><code class="language-text">minimist</code></li>
<li><code class="language-text">wordwrap</code></li>
<li><code class="language-text">strip-eof</code></li>
</ul>
<p>Eles são adicionados ao arquivo em ordem alfabética, e cada um têm um campo <code class="language-text">version</code>, um <code class="language-text">resolver</code>, que aponta para a localização do pacote, e um <code class="language-text">integrity</code>, que é uma string para validação do pacote.</p>
<h2>Veja as versões instaladas de um pacote NPM</h2>
<p>Para ver a última versão de todos os pacotes npm instalados, incluindo suas dependências:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> list</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Por exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> list
/Users/joe/dev/node/cowsay
└─┬ cowsay@1.3.1
  ├── get-stdin@5.0.1
  ├─┬ optimist@0.6.1
  │ ├── minimist@0.0.10
  │ └── wordwrap@0.0.3
  ├─┬ string-width@2.1.1
  │ ├── is-fullwidth-code-point@2.0.0
  │ └─┬ strip-ansi@4.0.0
  │   └── ansi-regex@3.0.0
  └── strip-eof@1.0.0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você também pode abrir o arquivo <code class="language-text">package-lock.json</code>, mas você terá que ler muita informação desnecessária.</p>
<p><code class="language-text">npm list -g</code> tem o mesmo funcionamento, porém para pacotes instalados globalmente.</p>
<p>Para obter obter apenas os pacotes top-level (basicamente aqueles que você pediu para o npm instalar e estão listados no <code class="language-text">package.json</code>), execute <code class="language-text">npm list --depth=0</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> list --depth<span class="token operator">=</span><span class="token number">0</span>
/Users/joe/dev/node/cowsay
└── cowsay@1.3.1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Você pode obter a versão de um pacote em específico fornecendo o nome dele:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> list cowsay
/Users/joe/dev/node/cowsay
└── cowsay@1.3.1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Isso também funciona para dependências dos pacotes instalados:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> list minimist
/Users/joe/dev/node/cowsay
└─┬ cowsay@1.3.1
  └─┬ optimist@0.6.1
    └── minimist@0.0.10</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Se você quer ver qual é a última versão disponível de um pacote no repositório npm, execute <code class="language-text">npm view [package_name] version</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> view cowsay version

<span class="token number">1.3</span>.1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Instale uma versão mais antiga de um pacote NPM</h2>
<p>Você pode instalar uma versão antiga de um pacote npm usando a sintaxe <code class="language-text">@</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">></span>@<span class="token operator">&lt;</span>version<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> cowsay</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>instala a versão 1.3.1 (no momento de escrita).</p>
<p>Instale a versão 1.2.0 assim:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> cowsay@1.2.0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>O mesmo pode ser feito com pacotes globais:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g webpack@4.16.4</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Você também pode estar interessado em listar todas as versões anteriores de um pacote. Você pode fazer isso executando <code class="language-text">npm view &lt;package&gt; versions</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">❯ <span class="token function">npm</span> view cowsay versions

<span class="token punctuation">[</span> <span class="token string">'1.0.0'</span>,
  <span class="token string">'1.0.1'</span>,
  <span class="token string">'1.0.2'</span>,
  <span class="token string">'1.0.3'</span>,
  <span class="token string">'1.1.0'</span>,
  <span class="token string">'1.1.1'</span>,
  <span class="token string">'1.1.2'</span>,
  <span class="token string">'1.1.3'</span>,
  <span class="token string">'1.1.4'</span>,
  <span class="token string">'1.1.5'</span>,
  <span class="token string">'1.1.6'</span>,
  <span class="token string">'1.1.7'</span>,
  <span class="token string">'1.1.8'</span>,
  <span class="token string">'1.1.9'</span>,
  <span class="token string">'1.2.0'</span>,
  <span class="token string">'1.2.1'</span>,
  <span class="token string">'1.3.0'</span>,
  <span class="token string">'1.3.1'</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Atualize todas as versões do Node.js para a última versão.</h2>
<p>Quando você instala um pacote utilizando <code class="language-text">npm install &lt;packagename&gt;</code>, a última versão disponível do pacote é baixada e colocada na pasta <code class="language-text">node_modules</code>, e uma entrada correspondente é adicionada nos arquivos <code class="language-text">package.json</code> e <code class="language-text">package-lock.json</code> presentes na pasta atual.</p>
<p>o npm calcula as dependências e também instala a última versão delas.</p>
<p>Digamos que você instale o <a href="https://www.npmjs.com/package/cowsay"><code class="language-text">cowsay</code></a>, uma ferramenta de linha de comando bem legal que te permite fazer uma vaca falar <em>coisas</em>.</p>
<p>Quando você roda <code class="language-text">npm install cowsay</code>, essa entrada é adicionada no arquivo <code class="language-text">package.json</code>:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"cowsay"</span><span class="token operator">:</span> <span class="token string">"^1.3.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>e esse é um trecho do <code class="language-text">package-lock.json</code>, onde removemos as subdependências para facilitar a leitura:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"lockfileVersion"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"cowsay"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.3.1"</span><span class="token punctuation">,</span>
      <span class="token property">"resolved"</span><span class="token operator">:</span> <span class="token string">"https://registry.npmjs.org/cowsay/-/cowsay-1.3.1.tgz"</span><span class="token punctuation">,</span>
      <span class="token property">"integrity"</span><span class="token operator">:</span> <span class="token string">"sha512-3PVFe6FePVtPj1HTeLin9v8WyLl+VmM1l1H/5P+BTTDkMAjufp+0F9eLjzRnOHzVAYeIYFF5po5NjRrgefnRMQ=="</span><span class="token punctuation">,</span>
      <span class="token property">"requires"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"get-stdin"</span><span class="token operator">:</span> <span class="token string">"^5.0.1"</span><span class="token punctuation">,</span>
        <span class="token property">"optimist"</span><span class="token operator">:</span> <span class="token string">"~0.6.1"</span><span class="token punctuation">,</span>
        <span class="token property">"string-width"</span><span class="token operator">:</span> <span class="token string">"~2.1.1"</span><span class="token punctuation">,</span>
        <span class="token property">"strip-eof"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Agora esses 2 arquivos nos dizem que instalamos a versão <code class="language-text">1.3.1</code> do cowsay, e nossa regra para atualizações é <code class="language-text">^1.3.1</code>, o que o npm pode atualizar para versões patch e minor: <code class="language-text">1.3.2</code>, <code class="language-text">1.4.0</code> e assim por diante.</p>
<p>Se há uma nova versão minor ou patch e nós digitamos <code class="language-text">npm update</code>, a versão instalada é atualizada, e o arquivo <code class="language-text">package-lock.json</code> rapidamente se atualiza com a nova versão.</p>
<p>o <code class="language-text">package.json</code> permanece sem alterações.</p>
<p>Para descobrir novas atualizações dos pacotes, rode <code class="language-text">npm outdated</code>.</p>
<p>Aqui está uma lista de alguns pacotes desatualizados em um repositório que não recebe atualizações há um bom tempo:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e967736f8d105e64c22d80ce7a42f52a/5333d/outdated-packages.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.28041714947857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACyUlEQVQ4y6WT204TURSGMUa90bsWSsS20+4edmf2nHZnplSglIMdDJB4gUjLQXkAE4kSHkIeAb3xIZTGQ0yMd95oCyHxBtQAvoFM9u+eIZ7CpSv58u9kJl/WXmump0fW9w/vzM7nN9P7h98a375+8b9I9g/2/U6343/qfPR3d3f8brfr73R3/U5nxz84+OofHx/7R0dH/uHhYUPm9N7ent3zqxZmZ58vr8xjcWkZd1fu4d5dicxWcxHNOy3M374jmcfc3BwWFuaxtLSIVquFZrMZsbq6is3Nxy8BnAt956mqbXvVETh25USlTCjJrMhni6JA6Cm5osgoGZEnRJQoEYViRvT394uBgQERi8VO5Blra2uvpfBCJByvV7dvzU7A4ewklU6LZCoVkUolRSaTEbVaTbiuK9yxquCuI0Yqw2J8fELMzswI0zRPCCHY2Nj4Ixx0tHZjtAxDLQRFmgOl+Qgpg6IoqHgVWGUbpKqC6iV4ahljY+OY8n14nheE7/0jHHL19tSoC5drgWFSMFYE04uRLJlMwuYcpm6AcArNYvCYg3q9jptTU3Ad56xweMRs+40KhobMwJRCw6AIk3PZESWR0DYtEKcEzdZR1b2/hO5ZYXVQb0/UHQx6emBaJbgeQ6l0euV0Og3LtqEzHcSmKOkqHNVGbaSGyclJlDk/K7zOtfbkdY7BMguUjCIXoYi0kpZLSUU4jiNM2xKyQyGFosIcUR+ti8aNG+Gzs0KLFl5UDB35fP5HNkOCEEJyp2Rzgc6MQGVakGX5oEALgUGZHI0VcNsOKKU/stlsKHz1W8hN/tZzqmAlA5bOYWimzDK46cBkHCrV5CwpciQXLeoX4ThCZCNYX19//1t47erV+4lE3zP5kW7F47Enkqexv4jH4xG9vb3/0NfX90TmViKReDY9M/Pg4aP1Cz0knQx/l4uSy5Ir/8Elybmf9WKE+vPUqtIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="lista exibindo as versões mais atualizadas de alguns pacotes"
        title="lista exibindo as versões mais atualizadas de alguns pacotes"
        src="/static/e967736f8d105e64c22d80ce7a42f52a/799d3/outdated-packages.png"
        srcset="/static/e967736f8d105e64c22d80ce7a42f52a/00d96/outdated-packages.png 148w,
/static/e967736f8d105e64c22d80ce7a42f52a/0b23c/outdated-packages.png 295w,
/static/e967736f8d105e64c22d80ce7a42f52a/799d3/outdated-packages.png 590w,
/static/e967736f8d105e64c22d80ce7a42f52a/5333d/outdated-packages.png 863w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Algumas dessas atualizações são para versões major. Executando <code class="language-text">npm update</code> elas não serão atualizadas. Versões major nunca são atualizadas desse jeito porque elas (por definição) introduzem mudanças sujeitas a quebras em versões antigas, e o <code class="language-text">npm</code> quer nos poupar desse problema.</p>
<p>Para atualizar para uma versão major desses pacotes, instale o pacote <code class="language-text">npm-check-updates</code> globalmente:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g npm-check-updates</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e então rode:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">ncu -u</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>isso irá atualizar as versões no <code class="language-text">package.json</code>, tanto <code class="language-text">dependencies</code> quanto <code class="language-text">devDependencies</code>, assim o npm poderá instalar as versões major.</p>
<p>Agora você está pronto para executar as atualizações:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> update</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Se você só baixou o projeto sem as dependências do <code class="language-text">node_modules</code> e quer instalar as novas versões, basta rodar</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Usando Semantic Versioning no NPM</h2>
<p>Se há uma coisa incrível nos pacotes Node.js, é que todos eles permitem utilizar Versionamento Semântico em suas numerações de versão.</p>
<p>O Versionamento Semântico é um conceito simples: todas versões têm 3 digitos: <code class="language-text">x.y.z</code>.</p>
<ul>
<li>o primeiro digito é a versão major</li>
<li>o segundo digito é a versão minor</li>
<li>o terceiro digito é a versão patch</li>
</ul>
<p>Quando você cria uma nova versão, você não aumenta um número como bem entender, existem algumas regras:</p>
<ul>
<li>você aumenta a versão major quando você cria mudanças de API incompatíveis</li>
<li>você aumenta a versão minor quando você adiciona uma funcionalidade compatível com versões anteriores</li>
<li>você aumenta a versão patch quando você arruma bugs sem quebrar versões anteriores</li>
</ul>
<p>Essa convenção é adotada em todas linguagens de programação, e é muito importante que todo pacote <code class="language-text">npm</code> a siga, pois o sistema como um todo depende disso.</p>
<p>Por que isso é tão importante?</p>
<p>Porque o <code class="language-text">npm</code> define algumas regras que podemos usar no <code class="language-text">package.json</code> para escolher quais versões podem ser atualizadas ao rodar <code class="language-text">npm update</code>.</p>
<p>As regras utilizam esses símbolos:</p>
<ul>
<li><code class="language-text">^</code></li>
<li><code class="language-text">~</code></li>
<li><code class="language-text">&gt;</code></li>
<li><code class="language-text">&gt;=</code></li>
<li><code class="language-text">&lt;</code></li>
<li><code class="language-text">&lt;=</code></li>
<li><code class="language-text">=</code></li>
<li><code class="language-text">-</code></li>
<li><code class="language-text">||</code></li>
</ul>
<p>Vamos ver essas regras em detalhes:</p>
<ul>
<li><code class="language-text">^</code>:  Só vai fazer atualizações que não alterem o número mais a esquerda diferente de zero. Se você definir <code class="language-text">^0.13.0</code>, ao rodar <code class="language-text">npm update</code>, ele pode atualizar para <code class="language-text">0.13.1</code>, <code class="language-text">0.13.2</code>, e assim por diante, mas não para <code class="language-text">0.14.0</code> ou posteriores. Se você definir <code class="language-text">^1.13.0</code>, ao rodar <code class="language-text">npm update</code>, ele pode atualizar para <code class="language-text">1.13.1</code>, <code class="language-text">1.14.0</code> e assim por diante, mas não para <code class="language-text">2.0.0</code> ou posterior.</li>
<li><code class="language-text">~</code>: se você definir <code class="language-text">~0.13.0</code>, ao rodar <code class="language-text">npm update</code> ele pode atualizar para versões patch: <code class="language-text">0.13.1</code> está ok, mas <code class="language-text">0.14.0</code> não está.</li>
<li><code class="language-text">&gt;</code>: aceita qualquer versão maior que a especificada</li>
<li><code class="language-text">&gt;=</code>: aceita qualquer versão maior ou igual a especificada</li>
<li><code class="language-text">&lt;=</code>: aceita qualquer versão menor ou igual a especificada</li>
<li><code class="language-text">&lt;</code>: aceita qualquer versão menor que a especificada</li>
<li><code class="language-text">=</code>: aceita aquela exata versão</li>
<li><code class="language-text">-</code>: aceita qualquer versão dentro de um intervalo. Exemplo: <code class="language-text">2.1.0 - 2.6.2</code></li>
<li><code class="language-text">||</code>: combina restrições. Exemplo: <code class="language-text">&lt; 2.1 || &gt; 2.6</code></li>
</ul>
<p>Você pode combinar algumas dessas notações, por exemplo, utilize <code class="language-text">1.0.0 || &gt;=1.1.0 &lt;1.2.0</code> para usar 1.0.0 ou uma versão maior ou igual a 1.1.0, porém menor que 1.2.0.</p>
<p>Também há outras regras:</p>
<ul>
<li>sem símbolo: aceita apenas a versão especificada (<code class="language-text">1.2.1</code>)</li>
<li><code class="language-text">latest</code>: usa a versão mais recente disponível</li>
</ul>
<h2>Desinstalando pacotes NPM</h2>
<p>Para desinstalar um pacote que você tenha instalado previamente de forma <strong>local</strong> (usando <code class="language-text">npm install &lt;package-name&gt;</code> na pasta <code class="language-text">node_modules</code>), execute</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> uninstall <span class="token operator">&lt;</span>package-name<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>a partir da pasta raiz do projeto (a pasta que contêm a pasta node_modules).</p>
<p>Usando a flag <code class="language-text">-S</code>, ou <code class="language-text">--save</code>, essa operação também irá remover a referência no arquivo <code class="language-text">package.json</code>.</p>
<p>Se o pacote era uma dependência de desenvolvimento, listada no devDependencies do arquivo <code class="language-text">package.json</code>, você deve utilizar a flag <code class="language-text">-D</code> / <code class="language-text">--save-dev</code>para removê-la do arquivo.</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> uninstall -S <span class="token operator">&lt;</span>package-name<span class="token operator">></span>
<span class="token function">npm</span> uninstall -D <span class="token operator">&lt;</span>package-name<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Se o pacote está instalado <strong>globalmente</strong>, você precisa adicionar a flag <code class="language-text">-g</code> / <code class="language-text">--global</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> uninstall -g <span class="token operator">&lt;</span>package-name<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>por exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> uninstall -g webpack</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e você pode rodar esse comando em qualquer lugar do seu sistema pois a pasta que você está não importa.
and you can run this command from anywhere you want on your system because the folder where you currently are does not matter.</p>
<h2>NPM: pacotes globais ou locais</h2>
<p>A principal diferença entre pacotes locais e globais é:</p>
<ul>
<li><strong>pacotes locais</strong> são instalados no diretório em que você executa <code class="language-text">npm install &lt;package-name&gt;</code>, e eles são inseridos na pasta <code class="language-text">node_modules</code> desse diretório.</li>
<li><strong>pacotes globais</strong> são todos colocados em único lugar do seu sistema (dependendo da sua configuração), independentemente de onde você execute <code class="language-text">npm install -g &lt;package-name&gt;</code></li>
</ul>
<p>No seu código você só pode importar pacotes locais:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'package-name'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>então quando instalar um ou outro?</p>
<p>No geral, <strong>todos os pacotes devem ser instalados localmente</strong>.</p>
<p>Isso garante que você possa ter dúzias de aplicações no seu computador, todas rodando com uma versão diferente de cada pacote se necessário.</p>
<p>Atualizar um pacote global fará com que todos seus projetos usem a nova versão, e como você pode imaginar isso pode causar pesadelos em termos de manutenção, pois alguns pacotes podem quebrar.</p>
<p>Todos projetos tem sua própria versão local de um pacote, mesmo que isso possa parecer um desperdício de recursos, é algo pequeno comparado as possíveis consequências.</p>
<p>Um pacote <strong>deve ser instalado globalmente</strong> quando ele fornece um comando executável que possa ser rodado pelo terminal (CLI), e é reutilizado entre projetos.</p>
<p>Você também pode instalar comandos executáveis localmente e rodá-los usando o npx, porém alguns pacotes funcionam melhor instalados de forma global.</p>
<p>Alguns otimos exemplos de pacotes globais populares que você pode conhecer:</p>
<ul>
<li><code class="language-text">npm</code></li>
<li><code class="language-text">create-react-app</code></li>
<li><code class="language-text">vue-cli</code></li>
<li><code class="language-text">grunt-cli</code></li>
<li><code class="language-text">mocha</code></li>
<li><code class="language-text">react-native-cli</code></li>
<li><code class="language-text">gatsby-cli</code></li>
<li><code class="language-text">forever</code></li>
<li><code class="language-text">nodemon</code></li>
</ul>
<p>Você provavelmente já tem alguns deles instalados globalmente no seu sistema. Você pode conferir executando</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> list -g --depth <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>no seu terminal.</p>
<h2>npm: diferença entre dependencies e devDependencies</h2>
<p>Quando você instala um pacote usando <code class="language-text">npm install &lt;package-name&gt;</code>, ele está sendo instalado como uma <strong>dependência</strong>.</p>
<p>O pacote é listado automaticamente no arquivo package.json, na lista de <code class="language-text">dependencies</code> (a partir do npm 5: antes você tinha que especificar manualmente com <code class="language-text">--save</code>).</p>
<p>Quandi você adiciona a flag <code class="language-text">-D</code>, ou <code class="language-text">--save-dev</code>, você está instalado como uma dependência de desenvolvimento, que é adicionada na lista de <code class="language-text">devDependencies</code>.</p>
<p>Dependências de desenvolvimento são entendidas como pacotes apenas para desenvolver, não são necessárias em produção. Por exemplo pacotes de teste, webpack ou Babel.</p>
<p>Quando você vai para produção, se digitar <code class="language-text">npm install</code> e a pasta conter um arquivo <code class="language-text">package.json</code>, elas são instaladas, pois o npm assume que é um deploy de desenvolvimento.</p>
<p>Você precisa passar a flag <code class="language-text">--production</code> (<code class="language-text">npm install --production</code>) para evitar instalar essas dependências de desenvolvimento.</p>
<h2>Conhecendo o NPX</h2>
<p><code class="language-text">npx</code> é um comando poderoso que está disponível no <strong>npm</strong> a partir da versão 5.2, lançada em Julho de 2017.</p>
<blockquote>
<p>Se você não quer instalar o npm, você pode <a href="https://www.npmjs.com/package/npx">instalar o npx como um pacote standalone</a></p>
</blockquote>
<p>O <code class="language-text">npx</code> permite rodar seu código feito com Node.js e publicado nos registros do npm.</p>
<h2>Rode comandos locais facilmente</h2>
<p>Desenvolvedores Node.js costumam publicar a maioria dos comandos executáveis como pacotes globais, pois assim é garantido que eles estejam salvos no <code class="language-text">path</code> e executados imediatamente.</p>
<p>Isso é bem chato poque você não pode instalar versões diferentes do mesmo comando.</p>
<p>Ao rodar <code class="language-text">npx nomedocomando</code> a referência correta do comando dentro da pasta <code class="language-text">node_modules</code> do projeto é encontrada automaticamente, e sem a necessidade de saber o caminho exato, e sem a necessidade de ter o pacote instalado globalmente e no <code class="language-text">path</code> do usuário.</p>
<h2>Execução de comandos sem instalação</h2>
<p>Outro excelente recurso do <code class="language-text">npx</code> é permitir rodar comandos sem tê-los instalados.</p>
<p>Isso é extremamente útil, porque:</p>
<ol>
<li>você não precisa instalar nada</li>
<li>você pode rodar diferentes versões do mesmo comando, usando a sintaxe <code class="language-text">@version</code></li>
</ol>
<p>Uma demonstração típica do uso do <code class="language-text">npx</code> é através do comando <code class="language-text">cowsay</code>. O <code class="language-text">cowsay</code> vai imprimir uma vaca na tela dizendo o que você digitou no comando. Por exemplo:</p>
<p><code class="language-text">cowsay &quot;Salve pra firma&quot;</code> vai resultar em</p>
<div class="gatsby-highlight" data-language="console"><pre style="counter-reset: linenumber NaN" class="language-console line-numbers"><code class="language-console"> _________________
&lt; Salve pra firma &gt;
 -----------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Isso só funciona se você tiver o comando <code class="language-text">cowsay</code> previamente instalado pelo npm. Caso contrário você receberá um erro ao tentar rodar o comando.</p>
<p>O <code class="language-text">npx</code> permite que você rode o comando sem tê-lo instalado localmente:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">npx cowsay <span class="token string">"Salve pra firma"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Outros cenários de exemplo:</p>
<ul>
<li>rodar a CLI do <code class="language-text">vue</code> para criar novas aplicações: <code class="language-text">npx @vue/cli create my-vue-app</code></li>
<li>criar uma aplicação React usando <code class="language-text">create-react-app</code>: <code class="language-text">npx create-react-app my-react-app</code></li>
</ul>
<p>Uma vez executado, o código baixado será apagado.</p>
<h2>Rodando um código em uma versão difente do Node.js</h2>
<p>Utilize o <code class="language-text">@</code> para especificar a versão, e combine-o com uma <a href="https://www.npmjs.com/package/node">versão empacotada do <code class="language-text">node</code></a>:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">npx node@10 -v <span class="token comment">#v10.18.1</span>
npx node@12 -v <span class="token comment">#v12.14.1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Isso ajuda a evitar ferramentas como o <code class="language-text">nvm</code> ou outros gerenciadores de versão para Node.js.</p>
<h2>Rodando códigos diretamente de uma URL</h2>
<p>O <code class="language-text">npx</code> não te limita aos pacotes publicados nos registros do npm.</p>
<p>Você pode rodar códigos de um gist no GitHub, por exemplo:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">npx https://gist.github.com/zkat/4bc19503fe9e9309e2bfaa2c58074d32</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Mas é claro que você precisa ter cuidado ao rodar códigos que estão fora do seu controle, com grandes poderes vem grandes responsabilidades.</p>
<h2>O Event Loop do Node.js</h2>
<h2>Introdução</h2>
<p>O <strong>Evnet Loop</strong> é um dos aspectos do Node.js mais importantes de se entender.</p>
<p>Por que ele é tão importante? Porque ele explica como o Node.js pode ser assíncrono e ter I/O não bloqueante, e também explica o diferencial do Node.js, o quê fez dele bem-sucedido.</p>
<p>O código JavaScript Node.js roda em uma única thread. Há apenas uma coisa acontecendo por vez.</p>
<p>Essa é uma limitação que na verdade é bem útil, pois ela simplifica muito como você programa sem se preocupar com problemas de concorrência.</p>
<p>Você só precisa prestar atenção em como escrever seu código e evitar qualquer coisa que possa bloquear a thread, como chamadas de rede síncronas ou loops infinitos.</p>
<p>No geral, na maioria dos browsers existe um event loop para cada aba aberta, para tratar cada processo de forma isolada e evitar que uma página web com loops infinitos ou processamento pesado bloqueie o browser por completo.</p>
<p>O ambiente de execução gerencia múltiplos event loops concorrentes, para fazer chamadas à APIs por exemplo. Web Workers rodam em seus próprios event loops também.</p>
<p>Você precisa se preocupar principalmente com que seu código rode um único event loop, e escrever o código com isso em mente a fim de evitar bloquear a thread.</p>
<h2>Bloqueando o event loop</h2>
<p>Qualquer código JavaScript que demore muito para retornar ao controle do event loop irá bloquear a execução de algum código JavaScript na página, até mesmo bloquear a thread de UI, impossibilitando o usuário de clicar, rolar, e etc.</p>
<p>Quase todas primitivas de I/O no JavaScript são não bloqueantes. Requisições de rede, operações no filesystem, e etc. Ser bloqueante é a exceção, e esse é o porquê do JavaScript ser extremamente baseado em callbacks, e mais recentemente em promises e async/await.</p>
<h2>A call stack</h2>
<p>A call stack (pilha de chamadas) é uma fila do tipo LIFO (Last In, First Out, que em português significa último a entrar, primeiro a sair).</p>
<p>O event loop checa continuamente a <strong>call stack</strong> para ver se há qualquer função que precise rodar.</p>
<p>Enquanto faz isso, ele adiciona na call stack qualquer chamada de função que encontrar e executa cada uma em ordem.</p>
<p>Sabe quando ocorre um erro e no debugger ou no console do browser aparece uma sequência hierárquica de nomes de funções? Basicamente o browser procura os nomes das funções na call stack para te informar qual função originou a chamada corrente:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e4594b6135efd353b44770f748fdccd5/ed9ca/exception-call-stack.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 103.88513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y51U2XKbMBTl/7+ofctTJq2dOIFM7NiAt2AkZCEBQgsgqZfETdPJ1vTOkQCJc3cp6PpOU8lCovZVuhXZQ9NJjsmxJgdGiTGd995a65zzrySA1b7rm5RXETnel3ROWYzD+fx6dh0nySpJd/tsv8+UUvD3qMK5Z0UBDCFb0O3duAmzsyfFb1r7yzKMQfYKib7StDSM66FXrVS9ElrJknPGOa9qALwbSrui0I9enMh9bcSm6kqFsCqKttdCSGka1jZ1liOE8JHSIy33Wa6Budtp+ZLcmHZX90yVpTkSOXSyEdIIDuRhsJ+47YzFKU4X6eJ+EyfZdgvzWm1Svlg0QjwF/yT+lLAX2YbHere7Xdwf8tzaQWptjPGDtV1nP8zZY8IG+/BwiJO0rhv/FRnJrZRjqfyfCp08+5dSSakgpbyq/BdlJFPG4/W2VWpsk68g8HVdFwVEDA74phkBLhDiIP66HmdIuNZvIujPL6q7+RBFfjr1Z2c+DP1k4r59t5PpcH7hLn646NZz7hl7jQDs9JQuZzcaYfh2sMoZSjaTy3xyhaIQS1z6io/8Vwhg2LLMFkuJC98IBz5XFU7WwJxc4dkNatBIdu+RYQPFcQlNS4jE2BCCkvRyhqYzFEaYHT6yzBxn+Sre383T6DYJo3y5Oizj6Sz/eYmub9BmRd4MeIzZCN0y7uCUdd0IaMwndPoEo9/Nth7gMlDu9w3w3FPPxfykSf5bfgHv0LfdsnYvBwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Exception na call stack"
        title="Exception na call stack"
        src="/static/e4594b6135efd353b44770f748fdccd5/799d3/exception-call-stack.png"
        srcset="/static/e4594b6135efd353b44770f748fdccd5/00d96/exception-call-stack.png 148w,
/static/e4594b6135efd353b44770f748fdccd5/0b23c/exception-call-stack.png 295w,
/static/e4594b6135efd353b44770f748fdccd5/799d3/exception-call-stack.png 590w,
/static/e4594b6135efd353b44770f748fdccd5/ed9ca/exception-call-stack.png 592w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>Uma explicação simples sobre o event loop</h2>
<p>Dado esse exemplo:</p>
<iframe
  title="A simple event loop explanation"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0029-01?path=server.js&previewSize=20&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0029-01 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const bar = () => console.log('bar')

const baz = () => console.log('baz')

const foo = () => {
  console.log('foo')
  bar()
  baz()
}

foo()
```

Esse código imprime

```txt
foo
bar
baz
```

como esperado.-->
<p>Quando esse código roda, primeiro é chamada <code class="language-text">foo()</code>. Dentro de <code class="language-text">foo()</code> nós chamamos <code class="language-text">bar()</code>, e então nós chamamos <code class="language-text">baz()</code>.</p>
<p>Nesse ponto a call stack se parece com isso:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/270ebeb6dbfa7d613152b71257c72a9e/4c6ed/call-stack-first-example.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 104.48113207547169%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsSAAALEgHS3X78AAADk0lEQVQ4y41U3YsbVRTP/6RvPvgkCooPPghFEBRRUFBUEFqxFLdIacVWS2uUGowW6lorC36262Y33e2uwSVpkkncutnJ52TzMXM/Zu7HzNw7s56ZaZe1T15uJufMPb879/x+59ycUsr3fcGF63lSSsYYuIxxz/NSg/nSZ57H0wFvIMZ1XSFEEAQ5+EVRdJAOMCDi4MHQWh91wYY3mR3HcQIOwzADg/8AHGdTa8W5yJYysNIaLNhAPwRON4xGc5xv2l8Z9uWm/XMHwYkPwYz7uF8W7XO69Z40PvDwGMDB1BM9Kk3qW66cYlow5nnDudBwlrsY0utT2aW+SaVN+XjUaLeut41rreYiQrNcGPjnq9NnS/ajt+irG7blkFOV6bF1/PgfpLiDGsP5sdXZEyX8yO9kzZz9arLnysFjawdPrqru3M0pFXouuT8pgcTcdFAX6Gcc6AYjnSxxPeZilkaCHDmIln7IeECBfxlmqgCUEiI495jHGQc7AYOAQsB2BGPGEl1zHmPaR4pbWlgBn0IA0BbHOiU7zKQ6wraKDmIVw59O2Iaz2PeujWuXrHphYhR4Su//1RlOODdv2q3PkXHW3vkWO1M0WHV7PzLzG2JteUwmxZN+WjJen5vf71fyk7WCdXvu4pzvB6SzJIwzYfM428lTZ4JbX4rmQnD3Xbq3xESYHDNKsgi5LI1rH3YW3zGLJ3avjtAk0bnQxq9ssWc2ouNVPkbu6Sp+qRI+tRFf7Yi/x/abW84Ld9yny95m3y736Vt/ui9uqtc2xdABqcLQ2Me3B6jUR3+NHOJ62yO0PkQrPeefGZlhemdI1kd0pU8th/YdWh7glSFZHSCH0BywrySPhaeZqyWQwrRgCmxGQ8lBrShxacRdnzPovkh4yiPwhMbKgdY6UFL60AOBDMGVYQi9B50p/QDcQCnhw0qy5APFSkNhyCCE9swJxr8bb17o/XZ5sHxlUIIiOioVbH/ogv2wVJTQpWHl0t7Ni3u3it01G6MWHVVpr0LNPboPJZb0YBRD30G5QgtmyPtguBqu98snzOLL3c/O9X6w0OTMvcW3O1ee3z1bHCxrHsSHFcYYXDv/+TKwfWN3fLJmvbE9/6Q5mWI3b1gL9enr2/ZPXdSf4S9a+CODvV9n1REClFIasgV8Bg5+6Tjn6+j0XfJ125khUmw5nzbwqSop9XB34lys2x838EIN14Z2HAZCSkg+u8z+BeyJcwoLolhEAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Primeiro exemplo de Call stack"
        title="Primeiro exemplo de Call stack"
        src="/static/270ebeb6dbfa7d613152b71257c72a9e/799d3/call-stack-first-example.png"
        srcset="/static/270ebeb6dbfa7d613152b71257c72a9e/00d96/call-stack-first-example.png 148w,
/static/270ebeb6dbfa7d613152b71257c72a9e/0b23c/call-stack-first-example.png 295w,
/static/270ebeb6dbfa7d613152b71257c72a9e/799d3/call-stack-first-example.png 590w,
/static/270ebeb6dbfa7d613152b71257c72a9e/2a3d6/call-stack-first-example.png 885w,
/static/270ebeb6dbfa7d613152b71257c72a9e/ae92f/call-stack-first-example.png 1180w,
/static/270ebeb6dbfa7d613152b71257c72a9e/4c6ed/call-stack-first-example.png 1272w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>O event loop olha em toda iteração se há algo na call stack, e o executa:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 466px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ca404c319c6fc595497d5dc097d469ff/c5652/execution-order-first-example.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 165.0214592274678%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAIAAABWXBxEAAAACXBIWXMAAAsSAAALEgHS3X78AAAEzElEQVQ4y42VW2zbZBTHI/GKhEBMQvAGDzygcZngAcZGH5B4RMAD07Z2INiExrbCiqpR6FC7rd2GxANja5uqHQzBuNNt7F6ta3pLr1HbtLZzdWwnju34El9iJ7Zrju30wmgRRz8dndg53/m+v4+PA47jLP3THM/MZSrrYXv/CTjrmWWZtq46xoZU9BJUCZhmJZlM4XiGIEiGYRRVheSiJLVMcfvC8v6wVD8ufjyxSsOE+EFY6kNoKB+wbVuW5Vw2i+M4RVEMy2ZJkiBzNQNay2Dy6zD+1HX5gSvGpr/0hz0euarf12ecjvBu8j0b9s8siOLOkWJtWH0/LL86qG0d0LYtU3NXe6a/FJxjq8lQ/B7ByoZBMHycEQGcFTMuQqYaiDgjMry4vmCQD8s5uuLoRQ/Zo+gYq94q61AkAMLCUWk6zzCswAuqpkE+qNC9KBxfMNoX9BPR0vF5rW2h1DqnnIjqJ+eVk1F1IOlt27YslmXT6XQsFs/gGRqWoWkyS79yRz18J/V5P9o8mGodJZsHEu0TdMsAtn9MCPxpnJoprArmn9aCbZgWHJgr8K8PKe+OSgfGhA/Hiwcn5X1DXP20digs7glrj10vn5nloBtWBVurtl4qoVlmkuKBCRIoeIHrZygumuUIBiovrS8YmGnYZtmxyo5dXgIsz/uBaSxZFbdG9cw8z8OzBZ1KJR2uKopSSN9WM7/KqV8k/IqIX13DNTF9iSVnbT+ZpKh4IoGhMZAtn8/DOkyeVsbeIoYb8tPH5dD2cuhpI7TFCD3nMvR8eeBxPnrWXnnOpmmWy6CUYeh6sSgXWEYd35UPNwhzx7TR14zhF43hl43hrS4j28uDm/mFrmryilorsaaqPBlWqVsycaNIDUnUiEiNSFVGJTLE5TD3rdpAMEfVHVl3FMNRfO8HunsdvOELBs9WlCRVVRVF1XUdNu9XLhBjMnlTJqH4zaJP5ibEUqZfJAa5HOq3p5VKpVAUA0AwUF7TSgWO1SZ3C9OH2ckmbrqJjzRzU0389Kfs1FF55qAZ2swvBq0VwUApza3ubgBGAp3LquE3iaFPkqEviHBrbrItNdTMzrSlx9qU2Ubj9qP8/JkNBVNkmY31yfFeOfFtMdYrxXqL8fMSBr5XwL7jse/z+ITtbCyYbTm26WIBlueXY/eW7XeYbcOeTcuqmKZtW5WK6fc2RicjDBrJo4v5BJJPIlXvskDHSTbrwKOyzAqGYQgYiuHpdKFQsC2bF/g30DM7Fzv2oj0vIW3Poq1b0GM+L6AnnkA+O5e8sTpJoJlFMEGQJClLUmSW2oa0N06d/wrpezLadH/00EPRjx702BQ9HJjbdzJ5ydlIMFiiHfnjAHahHr3QiP54BL14pOovNqE/1SMXriRGnX93GOSuXeu/LVAdd5Dm/fZjeEdyBQbncyuklwOCp+EWJ/JuMnwxoLniriVIguA4GBGOKIl1WPBt7FwdGqyNBevi3bVY1260sxbt2oF1gGY9qf7qmaFDYRiwDAu9BUGWoAiKrIl9eXr+987I5c7otR709jeRS72xW92Ra0fTvwWie0+lLq8zt1cEa0R+2IV0vIME9yBdPl4cfA/t3rF49ud4aMOvJMxQq1R2dNPD8jDXUtGNpXUH4P+3vwFH2sU1I/61QgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Ordem de execução do primeiro exemplo"
        title="Ordem de execução do primeiro exemplo"
        src="/static/ca404c319c6fc595497d5dc097d469ff/c5652/execution-order-first-example.png"
        srcset="/static/ca404c319c6fc595497d5dc097d469ff/00d96/execution-order-first-example.png 148w,
/static/ca404c319c6fc595497d5dc097d469ff/0b23c/execution-order-first-example.png 295w,
/static/ca404c319c6fc595497d5dc097d469ff/c5652/execution-order-first-example.png 466w"
        sizes="(max-width: 466px) 100vw, 466px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>até que a call stack esteja vazia.</p>
<h2>Enfileirando a execução de funções</h2>
<p>O exemplo acima parece normal, não há nada de especial sobre ele: o JavaScript encontra coisas para executar, e as executa em ordem.</p>
<p>Vamos ver como adiar uma função até que a stack esteja vazia.</p>
<p>O caso de uso do <code class="language-text">setTimeout(() =&gt; {}, 0)</code> é chamar uma função, mas só executá-la assim que todas outras funções no código tenham executado.</p>
<p>Veja esse exemplo:</p>
<iframe
  title="Queuing function execution"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0029-02?path=server.js&previewSize=20&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0029-02 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const bar = () => console.log('bar')

const baz = () => console.log('baz')

const foo = () => {
  console.log('foo')
  setTimeout(bar, 0)
  baz()
}

foo()
```-->
<p>Para nossa surpresa, esse código imprime:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">foo
baz
bar</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Quando esse código roda, primeiro foo() é chamada. Dentro de foo() nós chamamos setTimeout, passando <code class="language-text">bar</code> como um argumento, e nós instruimos a rodá-la imediatamente, o mais rápido possível, passando 0 como o tempo de contagem. E então nós chamamos baz().</p>
<p>Nesse ponto a call stack se parece com isso:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/be55515b9343074d00b43de88c495331/962ce/call-stack-second-example.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 95.33898305084745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAADIUlEQVQ4y11TWW8cRRDen5kn/gBSXpCIkFAQIIcHAiLCiBciEluxYh5QlAdCpPhIAk7YXcdJbG/W3vEetjM79s7R9z3dVO+uzdFqjarqq6976qvqhnPOGCOlklJqrZXS4Aou4AvuFIrLGqtV9IXgEAdWCKEBAedqWN57rQznAqLe1/DlLB7hpwvSBJcRCR6SwY1kA+Q65voQIISpIC5U2lMbKAWyu4QYFc4Eq73R7h8y3Bpmy5rtUXl7v1rt5CtddDwhoa5niLbmvFfkrQK1UbFFKOJz8qM+/b7DF3blxjHbO6m+eoU+aeEbO+TknDxIyK2OuLErmil/MyxvNquFJllsoQqxec3PB8XKAfphn/wxQqMz9DCpbnfp/R7JcrJ+lN/tosU9vP0eJxlaPax+OmD3exhhBuU3lNShhlJkcKJ22hlwVTA8eGWN9t4FpyDinLVGRRugWsH/gnQNSrixThkrjRVSU8qhDxSaYwzYE4YzjlJeIc4YE9AxqlTslZoKxiiPrZipou20H2EWoITdHTxdHj5bGj7dHHfg+lkaCDxXGzLqC0lrU+9ng5Vsc3H86M7Zxun52fJw7fPR6seD5Y307f7Z4M74yY/Z46V0A1M2V3uIzV5lX1c2BSM9XeztfHa49U3SPp3kv/a7N5P29cOtrfTk1fuTbw/aX/ZefHfYrhCdqq3Mvd3JtZflB8/JL++qznH19Tb96KX+oi1HGV5+W37aEh/+qdaPSHOAoE/XmnqhxYsKyL4BA1hrGbQIRjgttZJec6+oNxwGvdbCawbbamkUpPFaMYCkUKBLFMxEnRUXILGCedbGMi5AErDlNB4hpWHs4dUABLbRc7WFv5hO81+1BVfWujkEFwgV/qc2wfSiUwHqh7MuyQQzNBY00zQzeMKFkLM0QDnj8HjjhLmLl2Hir8p/k0c7xfF0ZwlWSl2SoWZ40lHtn3eLqy/QlWd06R0q+0WyWR79TgfrZJKi/l+T/hpJfiPjLk57efKk7D+myVolWDyoAVVliA9K3s3FGAtOOCk4mQiaC8EkLhnJBTkXHEtGOM4jBCWABED+G7d4H8pTaA2MAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Segundo exemplo de Call stack"
        title="Segundo exemplo de Call stack"
        src="/static/be55515b9343074d00b43de88c495331/799d3/call-stack-second-example.png"
        srcset="/static/be55515b9343074d00b43de88c495331/00d96/call-stack-second-example.png 148w,
/static/be55515b9343074d00b43de88c495331/0b23c/call-stack-second-example.png 295w,
/static/be55515b9343074d00b43de88c495331/799d3/call-stack-second-example.png 590w,
/static/be55515b9343074d00b43de88c495331/2a3d6/call-stack-second-example.png 885w,
/static/be55515b9343074d00b43de88c495331/962ce/call-stack-second-example.png 944w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Aqui temos a ordem de execução de todas as funções no nosso programa:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 470px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/585ff3207d814911a7e44d55fbde483b/15e5b/execution-order-second-example.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 181.06382978723403%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsSAAALEgHS3X78AAAFNUlEQVRIx3WVW2wUZRTH+66PhvhivERNRPTZ8OCLSfEJfDTBoD74qEYERC1eUoHQtASRcCsGEJIKhCD0tqX3i6VuW7btzmW3nZ3rXmbnPrtz3Z2Z9czstmnp9uSX0/N153zzff853/laatssqJtfrflOhLudwHPhkRZ4WlXVXC5XFARBFA3DqHpereZPEvzPC3LbgvLbonw2IXUlpM6ECB7ijoR8LZF3LCtMNspllmHJDJkhSJ7nBUl2JL4zqX80KnXP0wcnlRf73VcGnZcjXh20dw1UWkdVzzFbNpZaicx1XcOy/ZJyfkXeN146Msvvn9DejJlvD5m7I/YMma/F7P2jUtWOkut73Lpvn8iLsYzURygjpDxDSdOUNEWJ041AniN513Famgrm+z78jfAjgk3DjbgWJpdKJVEQVVUDM02zLlic4v9Yln5flmH955ak88uhD4dLUndSvJfMOnYkmK7pBEFgGA6wLJvniyDY2RX1wKR2cpb5YZprnxfaZrj2BfHEv9wv88Lux/a+MdWzzZZnPi8s2HYrvi51LqutY3rbbO7wTP74f+LX42zbonp8Tvgurrwx5HwwrHhNBQsiwVbY4i1UuoHKN1E59JhyPSndQOSbiHQPl2J43rHtnQSrS+Jtxd9KJJhlWVBkUFumadm243uQ6hfYIofJHKZkMTWLqxyqsLjEpUUgm5boVN6uv1lRlLXVtQ3BRCgxTWTmFfSBjD7OLfWzy/0sPlJI92mpHit110j12NhD2bI3VZgbmeM4pmHKmsDFNfyRsjZbQMe4lWF6dbaQGSqnbjnpHjt9u5J6oNmO1bzC/MDLZXg6LtFzMhNXAQjIuEgvCgCzKGae5qz6d965wjZ/gWD7k2EyrBYKC3z9bPiBDxNkxfyiQDwppp7yBFak0M0IFJanXMcNk0VRxEEtFAPBOI4TFdnX7Qvk4N5E+xfJq63JjreQH99BTuyJeBf56XXk+wMrZyvW+sHwPM+IDJag6prD66eZ3tbEmT+xoY9TF55HvtqFfvsCehiA4Dn0y/eR055dabbnULHaFLfSTv/zK/XgFPmoi+rvDOkDD/EZurebGHatbUey0cBghmpQc0CP5gRhC4t6GKwZdALvRxblBpIq00qBUoE8GVIglYbn1GJW4iFlXTA8lU6vguXzObWk1cxqNzXyId71OXLlk+TFT7Erh5DLn+FXDyGXwO/FTx1ELlbM9WXDNJqqQYXD2RYlyczKJ+mHB5Bzl5d7O5buX0wPdjy9d2kt1pW4f4EYeAk99l6yPdhRMK82xC5+Q/UcY+4eo+8cof4+GnkYHqXuAF2rva5l7yhY1a74ZScw3KDs1gy3Fvl6DP+sGg6o09LktdEUmq7JqhKiqbKmRMjrgSIpUkOwYrGIotjq6hpBZODqMMpmxXe5JTkzYJKj5UzMoAbsTVh0v0sMK9ZGG4J+IIT3jSDLMgRsjuLmSvHbNDKXwfsk5JqNXrca3LDQaw56V2kcye3mBdUsKmanbW7WZKYMerK8GWbCzMyI1vbuua5XAL/phloyNaBs6UDJigIzwtCbCLZh5XJZ06J7QNcapje8HgZqtVoNk2GTKTxFkhRJktDPqpWqX/O4pMSM2uyUxYwb9HiZmTSp8RIzYVBjZXrYIibWexhUNdw4hXwBgFIVeIHJkuwTfeU+vzCSnI9h+DQTH0TTs9nFx9jaHI/+ZaJ3VNvdUbBKNimxYw43bXJTFigH72QnLW7KhiEz4hATyhbBnrFSSVcUWQlNDoFqqQdQOJqiqDLs+X/0RXuIZwmBQgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Ordem de execução do segundo exemplo"
        title="Ordem de execução do segundo exemplo"
        src="/static/585ff3207d814911a7e44d55fbde483b/15e5b/execution-order-second-example.png"
        srcset="/static/585ff3207d814911a7e44d55fbde483b/00d96/execution-order-second-example.png 148w,
/static/585ff3207d814911a7e44d55fbde483b/0b23c/execution-order-second-example.png 295w,
/static/585ff3207d814911a7e44d55fbde483b/15e5b/execution-order-second-example.png 470w"
        sizes="(max-width: 470px) 100vw, 470px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Por que isso está acontecendo?</p>
<h2>A Message Queue</h2>
<p>Quando setTimeout() é chamado, o Browser ou o Node.js começa a contagem. Uma vez que ela encerre, nesse caso imediatamente pois definimos 0 como parâmetro, a função callback é colocada na <strong>Message Queue</strong> (fila de mensagens).</p>
<p>A Message Queue também é onde estão eventos iniciados pelo usuário, como clicks ou pressionamento de teclas, ou respostas de requisições enfileiradas. antes do seu código ter a oportunidade de reagir à elas. Ou também eventos do DOM, como <code class="language-text">onLoad</code>.</p>
<p><strong>O loop dá prioridade à call stack, primeiro ele processa tudo que encontrar na call stack, e só depois que não há nada lá, ele começa a pegar coisas na message queue.</strong></p>
<p>Nós não temos que esperar por funções como <code class="language-text">setTimeout</code>, fetch ou outras finalizarem, porque elas são providas pelo browser, elas vivem em suas próprias threads. Por exemplo, se você definir o tempo do <code class="language-text">setTimeout</code> como 2 segundos, você não precisa esperar por 2 segundos - a espera ocorre em outro lugar.</p>
<h2>ES6 Job Queue</h2>
<p>O ECMAScript 2015 introduziu o conceito de Job Queue (fila de trabalhos), que é usada por Promises (também introduzidas no ES6/ES2015). É uma maneira de executar o resultado de uma função assíncrona o mais rápido possível, invés de colocar no fim da call stack.</p>
<p>Promises que são resolvidas antes da função corrente encerrar serão executadas logo após a função corrente.</p>
<p>Eu acho legal a analogia de uma montanha russa em um parque de diversões: a message queue te coloca no final da fila, antes de todas outras pessoas, onde você terá que esperar pela sua vez, enquanto que a job queue é um ticket corta filas que deixa você ir de novo após a primeira ida.</p>
<p>Exemplo:</p>
<iframe
  title="ECMAScript 2015 Job Queue"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0029-03?path=server.js&previewSize=35&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0029-03 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const bar = () => console.log('bar')

const baz = () => console.log('baz')

const foo = () => {
  console.log('foo')
  setTimeout(bar, 0)
  new Promise((resolve, reject) =>
    resolve('should be right after baz, before bar')
  ).then(resolve => console.log(resolve))
  baz()
}

foo()
```

Isso imprime

```txt
foo
baz
should be right after baz, before bar
bar
```-->
<p>Há uma grande diferença entre Promises (e Async/await, que é feito com promises) e funções assíncronas antigas como <code class="language-text">setTimeout()</code> ou outras APIs de plataforma.</p>
<h2>Entendendo o process.nextTick()</h2>
<p>Uma parte importante do event loop é o <code class="language-text">process.nextTick()</code>.</p>
<p>Toda vez que o event loop termina um ciclo, nós chamamos isso de <em>tick</em>.</p>
<p>Quando nós passamos uma função pro <code class="language-text">process.nextTick()</code>, nós instruimos a engine a invocar essa função no fim da operação atual, antes que o próximo tick do event loop tenha início.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">//faça algo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>O event loop está ocupando processando o código da função atual.</p>
<p>Quando a operação finaliza, a engine JS executa todas as funções passadas por chamadas do <code class="language-text">nextTick</code> durante aquela operação.</p>
<p>Esse é o jeito que nós podemos dizer à engine JS para processar uma função assíncronamente (depois da função atual), mas o mais breve possível, sem enfileirar.</p>
<p>Chamando <code class="language-text">setTimeout(() =&gt; {}, 0)</code> vai executar a função no fim do próximo tick, muito mais tarde do que quando usando <code class="language-text">nextTick()</code>, que prioriza a chamada e a executa antes do próximo tick.</p>
<p>Use <code class="language-text">nextTick()</code> quando você quer garantir que na próxima iteração do event loop o código já tenha sido executado.</p>
<h2>Entendendo setImmediate()</h2>
<p>Quando você quer executar um trecho de código assíncronamente, mas o mais rápido possível, uma opção é utilizar a função <code class="language-text">setImmediate()</code> provida pelo Node.js:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">//faça algo</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Qualquer função passada como argumento ao setImmediate() será executada na próxima iteração do event loop.</p>
<p>Qual a diferença entre <code class="language-text">setImmediate()</code>, <code class="language-text">setTimeout(() =&gt; {}, 0)</code> (passando 0ms como delay), e <code class="language-text">process.nextTick()</code>?</p>
<p>A função passada para o <code class="language-text">process.nextTick()</code> será executada na iteração atual do event loop, depois que a operação corrente finalizar. Isso significa que ela sempre executa antes do <code class="language-text">setTimeout</code> e do <code class="language-text">setImmediate</code>.</p>
<p>Uma callback <code class="language-text">setTimeout()</code> com delay de 0ms é muito similar ao  <code class="language-text">setImmediate()</code>. A ordem de execução vai depender de vários fatores, mas ambas irão rodar na próxima iteração do event loop.</p>
<h2>Timers do JavaScript</h2>
<h2><code class="language-text">setTimeout()</code></h2>
<p>Quando estiver escrevendo código JavaScript, você pode querer aplicar um delay na execução de uma função.</p>
<p>Esse é o trabalho da função <code class="language-text">setTimeout</code>. Você especifica uma função de callback para ser executada mais tarde, e um valor em milisegundos especificando o quão mais tarde ela deve rodar:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// roda após 2 segundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// roda após 50 milisegundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Essa sintaxe define uma nova função. Você pode chamar qualquer outra função que quiser, ou passar o nome de uma função existente, e definir os parâmetros:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">firstParam<span class="token punctuation">,</span> secondParam</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// faz algo</span>
<span class="token punctuation">}</span>

<span class="token comment">// roda após 2 segundos</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>myFunction<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> firstParam<span class="token punctuation">,</span> secondParam<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">setTimeout</code> retorna o código de identificação do timer. Geralmente esse código não é usado, mas você pode guardá-lo, e “limpar” o timer se você quiser desagendar a execução daquela função:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// deve rodar daqui 2 segundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

<span class="token comment">// mudei de ideia :v</span>
<span class="token function">clearTimeout</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Delay de zero</h3>
<p>Se você espeficiar o delay do timeout como <code class="language-text">0</code>, a função de callback será executada assim que possível, mas só depois da execução das funções correntes:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'depois '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' antes '</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>imprime <code class="language-text">antes depois</code>.</p>
<p>Isso é especialmente útil para evitar bloqueio da CPU em tarefas intensas e deixar outras funções serem executadas enquanto são feitos cálculos pesados, enfileirando funções no fluxo.</p>
<blockquote>
<p>Alguns browsers (IE e Edge) implementam um método chamado <code class="language-text">setImmediate()</code> que tem a exata mesma funcionalidade, mas não é padronizado e <a href="https://caniuse.com/#feat=setimmediate">indisponível em outros navegadores</a>. Porém é um método padrão no Node.js.</p>
</blockquote>
<h2><code class="language-text">setInterval()</code></h2>
<p><code class="language-text">setInterval</code> é uma função similar ao <code class="language-text">setTimeout</code>, mas com uma diferença: em vez de rodar a função de callback uma vez, ela será rodada pra sempre, a cada intervalo de tempo especificado (em milisegundos):</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// roda a cada 2 segundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>A função abaixo roda a cada 2 segundos até que você a diga pra parar, usando <code class="language-text">clearInterval</code>, passando o identificador retornado por aquele <code class="language-text">setInterval</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// roda a cada 2 segundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

<span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>É comum chamar o <code class="language-text">clearInterval</code> dentro da função de callback do setInterval, para auto-determinar se ele deve rodar de novo ou parar. Por exemplo, esse código roda algo a não ser que o valor de App.somethingIWait seja <code class="language-text">arrived</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>App<span class="token punctuation">.</span>somethingIWait <span class="token operator">===</span> <span class="token string">'arrived'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// caso contrário, executa o conteúdo restante</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>setTimeout recursivo</h2>
<p>O <code class="language-text">setInterval</code> inicia uma função a cada n milisegundos, sem levar em consideração quando uma função finalizou sua execução.</p>
<p>Se uma função gasta sempre o mesmo espaço de tempo, show de bola:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fa9e9fec1aea517d98b47b11c5fec296/ca682/setinterval-ok.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.560669456066943%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAh0lEQVQI102MuQrCQBCG8/4PIdjYWoiNIAiCdgmIKILgupDGybG498ws0SiE/br/LIaMGAJ5lzvGamaeZGIOxk+yyKsu4ra2K2lvXfg7unVwN62wGMaLlNK+ua6bqlSPcYwR4w9CVNouLjA7w0H2wzdgAqlE+ZIneHeGiZz3y+dxLnabukLEDzLVqiZANHp3AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="setInterval funcionando belezinha"
        title="setInterval funcionando belezinha"
        src="/static/fa9e9fec1aea517d98b47b11c5fec296/799d3/setinterval-ok.png"
        srcset="/static/fa9e9fec1aea517d98b47b11c5fec296/00d96/setinterval-ok.png 148w,
/static/fa9e9fec1aea517d98b47b11c5fec296/0b23c/setinterval-ok.png 295w,
/static/fa9e9fec1aea517d98b47b11c5fec296/799d3/setinterval-ok.png 590w,
/static/fa9e9fec1aea517d98b47b11c5fec296/2a3d6/setinterval-ok.png 885w,
/static/fa9e9fec1aea517d98b47b11c5fec296/ae92f/setinterval-ok.png 1180w,
/static/fa9e9fec1aea517d98b47b11c5fec296/ca682/setinterval-ok.png 1195w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Talvez a função gaste tempos diferentes de execução, dependendo das condições da internet por exemplo:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f2ae544ad5038515ba1d44b29322bec9/6d707/setinterval-varying-duration.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.357682619647354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAlUlEQVQI102IvQ6CMBgAeXoHZ42Ju4tPoIkmqIMsGjBRpxaJikZoq9AfPgqtPzGEyy13jm1RaQ0ybx8uOJTQpLFWZcLW/3Sa+wF0PTvzZSzcr8pYIzOgqCCRZBdBT/KJYXNHLj246T7IIgd+FABVCYyrzpYMg8dgl3Z9pgrJbjmev0IvifwEr8l1kY+Oq1446aPpOPbejmulxpnqolgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="setInterval variando de duração"
        title="setInterval variando de duração"
        src="/static/f2ae544ad5038515ba1d44b29322bec9/799d3/setinterval-varying-duration.png"
        srcset="/static/f2ae544ad5038515ba1d44b29322bec9/00d96/setinterval-varying-duration.png 148w,
/static/f2ae544ad5038515ba1d44b29322bec9/0b23c/setinterval-varying-duration.png 295w,
/static/f2ae544ad5038515ba1d44b29322bec9/799d3/setinterval-varying-duration.png 590w,
/static/f2ae544ad5038515ba1d44b29322bec9/2a3d6/setinterval-varying-duration.png 885w,
/static/f2ae544ad5038515ba1d44b29322bec9/ae92f/setinterval-varying-duration.png 1180w,
/static/f2ae544ad5038515ba1d44b29322bec9/6d707/setinterval-varying-duration.png 1191w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>E talvez uma longa execução sobreponha a próxima:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4e64c07dfb9f7be0e819fe3eb7def66a/cb5f6/setinterval-overlapping.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.201680672268907%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAqElEQVQI102NQQ7BQBiFeypHcAAnkDiChdhbiDs4ikRogqRBa6VESmi1UzNm/umM+atFNBLf5r3ke8mzXn8gYkxSZZBpvGnMTB5Tlkj4qPK3ASmeRV51q4rKqbxoTKE2Uk2btRe0PobWRDiOSLea7DNykOlOXX2gZ/m5KcrSMl8exiAaULrv8s4Sei4feLy7EsP1PZmJwBaBQ46b+DRnvheFlzCMIgr8DaD2ooqPp9kcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="setInterval sobrepondo execuções"
        title="setInterval sobrepondo execuções"
        src="/static/4e64c07dfb9f7be0e819fe3eb7def66a/799d3/setinterval-overlapping.png"
        srcset="/static/4e64c07dfb9f7be0e819fe3eb7def66a/00d96/setinterval-overlapping.png 148w,
/static/4e64c07dfb9f7be0e819fe3eb7def66a/0b23c/setinterval-overlapping.png 295w,
/static/4e64c07dfb9f7be0e819fe3eb7def66a/799d3/setinterval-overlapping.png 590w,
/static/4e64c07dfb9f7be0e819fe3eb7def66a/2a3d6/setinterval-overlapping.png 885w,
/static/4e64c07dfb9f7be0e819fe3eb7def66a/ae92f/setinterval-overlapping.png 1180w,
/static/4e64c07dfb9f7be0e819fe3eb7def66a/cb5f6/setinterval-overlapping.png 1190w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Para evitar isso, você pode agendar um setTimout recursivo para ser chamado quando a função de callback finaliza:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// faz algo</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span>myFunction<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>myFunction<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pra chegar nesse cenário:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4bde07363650160e953f899734adc29e/46247/recursive-settimeout.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 14.297729184188393%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAhUlEQVQI102MSw7CMAxEc/9LsOAOiAVXAKmCJVBAXbRKFIXGTp0vOM2mb+PxeDzityGGQGhZlFKaAwBEtM18jUkpNS3aaFmK6fSeDx/spKsFpfBnzrm2aJIPUE8A43hlk6/Cr5D3MXiDy/467m7yeJcOKlprO1tccOxVf55eFzkNCh3alT9xxqv3UrGNyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="setTimeout recursivo"
        title="setTimeout recursivo"
        src="/static/4bde07363650160e953f899734adc29e/799d3/recursive-settimeout.png"
        srcset="/static/4bde07363650160e953f899734adc29e/00d96/recursive-settimeout.png 148w,
/static/4bde07363650160e953f899734adc29e/0b23c/recursive-settimeout.png 295w,
/static/4bde07363650160e953f899734adc29e/799d3/recursive-settimeout.png 590w,
/static/4bde07363650160e953f899734adc29e/2a3d6/recursive-settimeout.png 885w,
/static/4bde07363650160e953f899734adc29e/ae92f/recursive-settimeout.png 1180w,
/static/4bde07363650160e953f899734adc29e/46247/recursive-settimeout.png 1189w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p><code class="language-text">setTimeout</code> e <code class="language-text">setInterval</code> estão disponívels no Node.js, através do <a href="https://nodejs.org/api/timers.html">módulo Timers</a>.</p>
<p>O Node.js também disponibiliza o <code class="language-text">setImmediate()</code>, que é o equivalente de usar <code class="language-text">setTimeout(() =&gt; {}, 0)</code>, normalmente utilizado para trabalhar com o Event Loop do Node.js.</p>
<h2>Programação Assincrona e Callbacks</h2>
<h2>Assincronicidade em Linguagens de Programação</h2>
<p>Computadores são assíncronos por definição.</p>
<p>Assíncrono significa que as coisas podem acontecer independemente do fluxo principal do programa.</p>
<p>Nos computadores de uso doméstico  atuais, cada programa roda por um intervalo de tempo específico e, em seguida, interrompe sua execução para permitir que outro programa continue sua execução. Isso roda em um ciclo tão rápido que é impossível de notar. Nós pensamos que nossos computadores rodam diversos programass simultaneamente, mas isso é uma ilusão (exceto em máquinas multiprocessadas).</p>
<p>Programas usam internamente <em>sinais de interrupção (interrupts)</em>, que são emitidos ao processador para ganharem a atenção do sistema.</p>
<p>Não irei muito a fundo no conceito, mas só tenha em mente que é normal para programas serem assíncronos e pararem a execução até que precisem de atenção, permitindo ao computador executar outras coisas nesse meio tempo. Quando um programa está esperando por uma resposta da rede, ele não pode parar o processador até que a requisição finalize.</p>
<p>Normalmente, linguagens de programação são síncronas e algumas fornecem maneiras de gerenciar assincronicidade na própria linguagem ou por meio de bibliotecas. C, Java, C#, PHP, Go, Ruby, Swift, e Python são todas síncronas por padrão. Algumas delas gerenciam assíncronismo usando threads, gerando um novo processo.</p>
<h2>JavaScript</h2>
<p>JavaScript é <strong>síncrono</strong> por padrão e roda em uma única thread. Isso significa que o código não pode criar novas threads e rodar em paralelo.</p>
<p>Linhas de código são executadas em séries, uma após a outra, por exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> a <span class="token operator">*</span> b
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Mas o JavaScript nasceu dentro dos browsers, sua função principal, desde o começo, era responder às interações do usuário, como <code class="language-text">onClick</code>, <code class="language-text">onMouseOver</code>, <code class="language-text">onChange</code>, <code class="language-text">onSubmit</code> e etc. Como isso pode ser feito com um modelo programático síncrono?</p>
<p>A resposta era o ambiente. O <strong>browser</strong> dá um jeito nisso fornecendo um conjunto de APIs que podem lidar com esses tipos de funcionalidades.</p>
<p>Mais recentemente, o Node.js introduziu um ambiente de I/O não bloqueante para estender esse conceito a acesso de arquivos, chamadas de rede e etc.</p>
<h2>Callbacks</h2>
<p>Não tem como você saber quando um usuário vai clicar em um botão. Então, você <strong>define uma função para lidar com o evento de click</strong>. Essa função será chamada quando o evento for acionado:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// item clicado</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Isso também é chamado de <strong>callback</strong>.</p>
<p>Uma callback é uma simples função que é passada como valor para outra função, e só será executada quando o evento ocorrer. Nós podemos fazer isso por que o JavaScript têm funções de “primeira classe”, que podem ser atribuidas à variáveis e passadas para outras funções chamadas de <strong>higher-order functions (funções de ordem superior)</strong>.</p>
<p>É comum envolver todo código do cliente em um event listener do tipo <code class="language-text">load</code> no objeto <code class="language-text">window</code>, que roda só roda a função callback quando a página está pronta:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// window carregou</span>
  <span class="token comment">// faça o que quiser</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Callbacks são usadas em todo lugar, não só em eventos do DOM.</p>
<p>Um exemplo comum é utilizando temporizadores:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// roda após 2 segundos</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Requisições XHR também aceitam uma callback, nesse exemplo ao passar uma função para uma propriedade que será chamada quando um evento em particular ocorrer (nesse caso, o estado da requisição mudar):</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span> <span class="token punctuation">:</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://yoursite.com'</span><span class="token punctuation">)</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Tratando erros em callbacks</h2>
<p>Como você trata erros em callbacks? Uma estratégia muito comum é usar o que o Node.js adotou: o primeiro parâmetro em qualquer função callback é o objeto de erro: <strong>error-first callbacks</strong></p>
<p>Se não há erro, o objeto é nulo (<code class="language-text">null</code>). Se há um erro, ele contêm alguma descrição do erro e outras informações.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// tratando erro</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// sem erros, processe o data</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>O problema com callbacks</h2>
<p>Callbacks são ótimas para casos simples!</p>
<p>Entretanto, toda callback adiciona um nível de aninhamento, e quando você têm muitas callbacks, o código começa a se complicar rapidamente:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// seu código aqui</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esse é só um exemplo simples com 4 níveis de aninhamento, mas eu já vi códigos com muito mais níveis e não é nem um pouco divertido.</p>
<p>Como resolver isso?</p>
<h2>Alternativas à callbacks</h2>
<p>A partir do ES6, o JavaScript introduziu várias funcionalidades que nos ajudam a lidar com código assíncrono sem o uso de callbacks: Promises (ES6) e Async/Await (ES2017).</p>
<h2>Promises no JavaScript</h2>
<h2>Introdução a Promises</h2>
<iframe
  title="Introduction to promises"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0034-01?path=server.js&previewSize=35&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0034-01 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<p>Uma promise (promessa) é comumente definida como <strong>um proxy para um valor que eventualmente ficará disponível</strong>.</p>
<p>Promises são um jeito de lidar com código assíncrono, sem ficar preso em <a href="http://callbackhell.com/">“inferno de callbacks” (callback hell)</a>.</p>
<p>Promises são parte da linguagem por anos (introduzidas e padronizadas no ES2015), e se tornaram mais integradas recentemente, com <strong>async</strong> e <strong>await</strong> no ES2017.</p>
<p><strong>Funções async</strong> usam promises por baixo dos panos, então entender como promises funcionam é fundamental para entender como <strong>async</strong> e <strong>await</strong> funcionam.</p>
<h3>Como promises funcionam, resumidamente</h3>
<p>Uma vez que a promise tenha sido chamada, ela inicia em um <strong>estado pendente (pending)</strong>. Isso significa que a função que a chamou continua executando, enquanto a promise estiver pendente até que se resolva, retornando à função que a invocou os dados que foram requisitados.</p>
<p>A promise criada vai eventualmente se encerrar em um <strong>estado resolvido (resolved)</strong>, ou em um <strong>estado rejeitado (rejected)</strong>, chamando as respectivas funções callback (<code class="language-text">then</code> e <code class="language-text">catch</code>) ao terminar.</p>
<h3>Quais APIs JS usam promises?</h3>
<p>Em adição ao seu código e o de bibliotecas, promises são usadas por padrão em APIs web modernas, como:</p>
<ul>
<li>Battery API</li>
<li>Fetch API</li>
<li>Service Workers</li>
</ul>
<p>É improvável que você mesmo <em>não</em> esteja utilizando promises no JavaScript moderno, então vamos começar a mergulhar nelas.</p>
<hr>
<h2>Criando uma promise</h2>
<p>A Promise API expõe um contrutor Promise, por onde você inicializa usando <code class="language-text">new Promise()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token keyword">const</span> isItDoneYet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> workDone <span class="token operator">=</span> <span class="token string">'Here is the thing I built'</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>workDone<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> why <span class="token operator">=</span> <span class="token string">'Still working on something else'</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>why<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Como você pode ver, a promise checa a constante global <code class="language-text">done</code>, e se for true, a promise vai para o estado <strong>resolved</strong> (uma vez que a callback <code class="language-text">resolve</code> tenha sido chamada); caso contrário, a callback <code class="language-text">reject</code> é executada, colocando a promise em um estado <strong>rejected</strong>. (Se nenhuma dessas funções é chamada, a promise permanece no estado <strong>pending</strong>).</p>
<p>Usando <code class="language-text">resolve</code> e <code class="language-text">reject</code>, podemos nos comunicar com a função invocadora dizendo qual estado a promise estava, e o que fazer com isso. No caso acima nós só retornamos uma string, mas poderia ser um objeto, ou mesmo <code class="language-text">null</code>. Só de termos criado a promise no trecho acima, ela já começou a executar. É importante entender o que está acontecendo na seção <a href="#consumindo-uma-promise">Consumindo uma promise</a> logo abaixo.</p>
<p>Um exemplo mais comum que você pode encontrar por aí é uma técnica chamada <strong>Promisifying (promissificar)</strong>. Essa técnica é um jeito de poder usar uma função JavaScript clássica que recebe uma callback, e retornar uma promise:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">getFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token comment">// chamar `reject` vai fazer com  que a promise falhe com ou sem o erro passado como argumento</span>
        <span class="token keyword">return</span>        <span class="token comment">// e não queremos ir mais longe</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getFile</span><span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<blockquote>
<p>Em versões recentes do Node.js, você não precisa fazer essa conversão manual para grande parte da API. Há uma função promisifying disponível no <a href="https://nodejs.org/docs/latest-v11.x/api/util.html#util_util_promisify_original">módulo util</a> que fará isso por você, dado que a função que você esteja “promissificando” siga a assinatura correta.</p>
</blockquote>
<hr>
<h2>Consumindo uma promise</h2>
<p>Na última seção, nós introduzimos como uma promise é criada.</p>
<p>Agora vamos ver como uma promise pode ser <em>consumida</em> ou usada.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> isItDoneYet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token comment">/* ... como acima ... */</span><span class="token punctuation">)</span>
<span class="token comment">//...</span>

<span class="token keyword">const</span> <span class="token function-variable function">checkIfItsDone</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  isItDoneYet
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">ok</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Rodar <code class="language-text">checkIfItsDone()</code> vai especificar funções para executar quando a promise <code class="language-text">isItDoneYet</code> resolver (na chamada <code class="language-text">then</code>) ou rejeitar (na chamada <code class="language-text">catch</code>).</p>
<hr>
<h2>Encadeando promises</h2>
<p>Uma promise pode ser retornada para outra promise, criando uma cadeia de promises.</p>
<p>Um ótimo exemplo de encadeamento de promises é a Fetch API, que podemos usar para obter um recurso e enfileirar uma cadeia de promises para executar quando o recurso for obtido.</p>
<p>A Fetch API um mecanismo baseado em promise, e chamar <code class="language-text">fetch()</code> é equivalente a definir suas próprias promises usando <code class="language-text">new Promise()</code>.</p>
<h3>Exemplo de encadeamento de promises</h3>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">status</span> <span class="token operator">=</span> <span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">json</span> <span class="token operator">=</span> <span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/todos.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>    <span class="token comment">// note que a função `status` é na verdade **chamada** aqui, e ela **retorna uma promise**</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>      <span class="token comment">// da mesma forma, a única diferença aqui é que a função `json` retorna uma promise que é resolvida com `data`</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span>  <span class="token comment">// ... por isso que `data` aparece aqui como primeiro parâmetro da função anônima</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request succeeded with JSON response'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request failed'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Nesse exemplo, nós chamamos <code class="language-text">fetch()</code> para obter uma lita de items TODO do arquivo <code class="language-text">todos.json</code> localizado na raiz do domínio, e nós criamos uma cadeia de promises.</p>
<p>Rodanr <code class="language-text">fetch()</code> retorna uma <a href="https://fetch.spec.whatwg.org/#concept-response">response (resposta)</a>, que contém várias propriedades, e dentre elas as que usamos no exemplo:</p>
<ul>
<li><code class="language-text">status</code>, um valor numérico representando o código de status HTTP</li>
<li><code class="language-text">statusText</code>, uma mensagem de status, que será <code class="language-text">OK</code> se a requisição for bem-sucedida.</li>
</ul>
<p><code class="language-text">response</code> também tem um método <code class="language-text">json()</code>, que retorna uma promise que vai resolver com o conteúdo do body processado e transformado em JSON.</p>
<p>Então dadas essas promises, isso é o que acontece: a primeira promise na cadeia é a função que nós definimos, chamada <code class="language-text">status()</code>, que checa o status da response e se não for uma resposta bem-sucedida (entre 200 e 299), a promise é rejeitada.</p>
<p>Essa operação fará com que a cadeia de promises pule todas promises encadeadas e pule diretamente para o <code class="language-text">catch()</code> no final, logando o texto <code class="language-text">Request failed</code> e a mensagem de erro.</p>
<p>Se em vez disso obter suceddo, é chamada a função <code class="language-text">json()</code> que definimos. Desde que a promise anterior, quando bem-sucedida, tenha retornado o objeto <code class="language-text">response</code>, nós o obtemos como um input para a segunda promise.</p>
<p>Nesse caso, nós retornamos os dados processados em JSON, assim a terceira promise recebe o JSON diretamente:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request succeeded with JSON response'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>e nós simplesmente o logamos no console.</p>
<hr>
<h2>Tratando erros</h2>
<p>No exemplo da seção anterior, nós tinhamos um <code class="language-text">catch</code> que foi adicionado na cadeia de promises.</p>
<p>Quando qualquer coisa na cadeia de promises falha e dispara um erro ou rejeita uma promise, o controle vai para o <code class="language-text">catch()</code> mais próximo na cadeia.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// or</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Cascateando erros</h3>
<p>Se dentro do <code class="language-text">catch()</code> você lançar um erro, você pode adicionar um segundo <code class="language-text">catch()</code> para tratá-lo, e assim por diante.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<hr>
<h2>Orquestrando promises</h2>
<h3><code class="language-text">Promise.all()</code></h3>
<p>Se você precisa sincronizar promises diferentes, <code class="language-text">Promise.all()</code> te ajuda a definir uma lista de promises, e executa algo quando elas todas são resolvidas.</p>
<p>Examplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/something.json'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> f2 <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/something2.json'</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Array of results'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>A sintaxe de atribuição por desestruturação do ES2015 permite que você também faça isso:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>res1<span class="token punctuation">,</span> res2<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Results'</span><span class="token punctuation">,</span> res1<span class="token punctuation">,</span> res2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>É claro que você não está limitado a só usar o <code class="language-text">fetch</code>, <strong>qualquer promise pode ser usada dessa forma</strong>.</p>
<h3><code class="language-text">Promise.race()</code></h3>
<p><code class="language-text">Promise.race()</code> roda quando a primeira das promises que você passar for resolvida, e roda a callback anexada apenas uma vez, com o resultado da primeira promise resolvida.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'first'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> second <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// second</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Erros comuns</h2>
<h3>Uncaught TypeError: undefined is not a promise</h3>
<p>Se você obter um erro <code class="language-text">Uncaught TypeError: undefined is not a promise</code> no console, certifique-se de usar <code class="language-text">new Promise()</code> em vez de apenas <code class="language-text">Promise()</code>.</p>
<h3>UnhandledPromiseRejectionWarning</h3>
<p>Isso significa que a promise que você chamou foi rejeitada, mas não tinha nenhum <code class="language-text">catch</code> preparado para tratar o erro. Adicione um <code class="language-text">catch</code> depois do <code class="language-text">then</code> causador do erro para tratá-lo propriamente.</p>
<h2>Programação assincrona moderna com Async Await no Javascript</h2>
<h2>Introdução</h2>
<p>O JavaScript evoluiu de callbacks para promises (ES2015) em um curto período de tempo, e desde o ES2017, JavaScript assíncrono está ainda mais simples com a sintaxe async/await.</p>
<p>Funções async são uma combinação de promises e generators, e basicamente, elas são uma abstração de alto nível das promises. Permita-me repetir: <strong>async/await é feito com promises</strong>.</p>
<h2>Por que a sintaxe async/await foi criada?</h2>
<p>Ela reduz o amontoado de código em torno das prommises e a limitação de “não quebre a corrente” das promises encadeadas.</p>
<p>Quando as Promises foram introduzidas no ES2016, elas foram feitas para resolver um problema com código assíncrono, e elas fizeram isso, mas ao longos dos 2 anos que separaram o ES2015 do ES2017, ficou claro que <em>promises poderiam não ser a solução definitiva</em>.</p>
<p>Promises foram introduzidas para resolver o famoso problema de <em>callback hell</em>, mas elas introduziram complexidade por si só, e complexidade sintática.</p>
<p>Elas foram boas primitivas enquanto uma sintaxe melhor não surgia, então, quando chegou a hora certa, obtivemos as <strong>funções async</strong>.</p>
<p>Elas fazem o código parecer síncrono, mas por baixo dos panos ele é assíncrono e não bloqueante.</p>
<h2>Como isso funciona</h2>
<p>Uma função async retorna uma promise, como nesse exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">doSomethingAsync</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'I did something'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Quando você quer <strong>chamar</strong> essa função você prexifa um <code class="language-text">await</code>, e <strong>o código corrente vai parar até que a promise seja resolvida ou rejeitada</strong>. Uma ressalva: a função deve ser definida como <code class="language-text">async</code>. Segue um exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">doSomething</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">doSomethingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Um exemplo rápido</h2>
<p>Esse é um exemplo bem simples de async/await sendo usado para rodar uma função assíncronamente:</p>
<iframe
  title="Modern Asynchronous JavaScript with Async and Await"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0035-01?path=server.js&previewSize=25&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0035-01 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const doSomethingAsync = () => {
  return new Promise(resolve => {
    setTimeout(() => resolve('I did something'), 3000)
  })
}

const doSomething = async () => {
  console.log(await doSomethingAsync())
}

console.log('Before')
doSomething()
console.log('After')
```

O código acima imrprimirá o seguinte no console do browser:

```
Before
After
I did something // depois de 3s
```-->
<h2>“Promissifique” tudo</h2>
<p>Prefixar o termo <code class="language-text">async</code> em qualquer função implica que a função vai retornar uma promise.</p>
<p>Mesmo que isso não seja feito tão explicitamente, internamente fará com que retorne uma promise.</p>
<p>Por isso que esse código é válido:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">aFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span>

<span class="token function">aFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span> <span class="token comment">// Isso vai invocar um alert com o texto 'test'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>e o mesmo aqui:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">aFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">aFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span> <span class="token comment">// Isso vai invocar um alert com o texto 'test'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>O código é muito mais simples de ler</h2>
<p>Como você pôde ver no exemplo acima, nosso código parece muito simples. Compare-o com os códigos usando promises simples, encadeamento e funções callback.</p>
<p>E esse é um exemplo bem simples, os maiores benefícios vão aparecer quando o código for mais complexo.</p>
<p>Por exemplo, aqui temos um código de como obter um recurso JSON e “parsear”, usando promises:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getFirstUserData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/users.json'</span><span class="token punctuation">)</span> <span class="token comment">// pega a lista de users</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// parse JSON</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">users</span> <span class="token operator">=></span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// pega o primeiro usuário</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// pega os dados desse usuário</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">userResponse</span> <span class="token operator">=></span> userResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// parse JSON</span>
<span class="token punctuation">}</span>

<span class="token function">getFirstUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>E aqui temos a mesma funcionalidade usando async/await:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getFirstUserData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/users.json'</span><span class="token punctuation">)</span> <span class="token comment">// pega a lista de users</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// parse JSON</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// pega o primeiro usuário</span>
  <span class="token keyword">const</span> userResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// pega os dados desse usuário</span>
  <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token keyword">await</span> userResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// parse JSON</span>
  <span class="token keyword">return</span> userData
<span class="token punctuation">}</span>

<span class="token function">getFirstUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Múltiplas funções async em série</h2>
<p>Funções async podem ser encadeadas facilmente, e a sintaxe é muito mais legível do que usando promises simples:</p>
<iframe
  title="Multiple async functions in series"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0035-02?path=server.js&previewSize=30&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0035-02 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const promiseToDoSomething = () => {
  return new Promise(resolve => {
    setTimeout(() => resolve('I did something'), 10000)
  })
}

const watchOverSomeoneDoingSomething = async () => {
  const something = await promiseToDoSomething()
  return something + ' and I watched'
}

const watchOverSomeoneWatchingSomeoneDoingSomething = async () => {
  const something = await watchOverSomeoneDoingSomething()
  return something + ' and I watched as well'
}

watchOverSomeoneWatchingSomeoneDoingSomething().then(res => {
  console.log(res)
})
```

Vai imprimir:

```
I did something and I watched and I watched as well
```-->
<h2>Mais fácil de debugar</h2>
<p>É difícil debugar promises porque o debugger não passa por cima de código assíncrono.</p>
<p>Já Async/await facilita muito isso porque para o compilador é como se fosse apenas código síncrono.</p>
<h2>O Event emitter</h2>
<p>Se você já trabalhou com JavaScript no browser, já sabe o quão grande é a quantidade de ações do usuário que são tratadas por eventos: clicks do mouse, teclas sendo pressionadas, movimentos do mouse, e muito mais.</p>
<p>No lado do backend, o Node.js nos oferece a opção de trabalhar com um sitema similar usando o <a href="https://nodejs.org/api/events.html">módulo <code class="language-text">events</code></a>.</p>
<p>Esse módulo, em particular, fornece a classe <code class="language-text">EventEmitter</code>, que nós utilizaremos para lidar com nossos eventos.</p>
<p>Você a inicializa usando</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> eventEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Esse objeto expõe, entre muitos outros, os métodos <code class="language-text">on</code> e <code class="language-text">emit</code>.</p>
<ul>
<li><code class="language-text">emit</code> é usado para acionar um evento</li>
<li><code class="language-text">on</code> é usado para adicionar uma função callback que será executada quando o evento for acionado</li>
</ul>
<p>Por exemplo, vamos criar um evento <code class="language-text">start</code>, e para dar uma amostra grátis, vamos reagir a ele logando no console:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">eventEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'started'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Quando rodamos</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">eventEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>a função que lida com o evento é acionada, e obtemos o log.</p>
<p>Você pode passar argumentos à função passando-os como argumentos adicionais do <code class="language-text">emit()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">eventEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token parameter">number</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">started </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>number<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

eventEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Múltipos argumentos:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">eventEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">started from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

eventEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>O objeto EventEmitter também expõe diversos outros métodos que interagem com eventos, como</p>
<ul>
<li><code class="language-text">once()</code>: escuta o evento apenas uma vez</li>
<li><code class="language-text">removeListener()</code> / <code class="language-text">off()</code>: remove um escutador (listener) de um evento</li>
<li><code class="language-text">removeAllListeners()</code>: remove todos escutadores (listeners) de um evento</li>
</ul>
<p>Você pode ler o detalhe de todos eles na página do módulo <code class="language-text">events</code> em <a href="https://nodejs.org/api/events.html">https://nodejs.org/api/events.html</a></p>
<h2>Construa um HTTP Server</h2>
<p>Aqui temos um simples web server HTTP de Hello World:</p>
<iframe
  title="Build an HTTP Server"
  src="https://glitch.com/embed/#!/embed/nodejs-dev-0037-01?path=server.js&previewSize=33&attributionHidden=true&sidebarCollapsed=true"
  alt="nodejs-dev-0037-01 on Glitch"
  style="height: 400px; width: 100%; border: 0;">
</iframe>
<!--```js
const http = require('http')

const port = 3000

const server = http.createServer((req, res) => {
  res.statusCode = 200
  res.setHeader('Content-Type', 'text/plain')
  res.end('Hello World\n')
})

server.listen(port, () => {
  console.log(`Server running at http://${hostname}:${port}/`)
})
```-->
<p>Vamos analisar esse código brevemente. Nós incluimos o <a href="https://nodejs.org/api/http.html">módulo <code class="language-text">http</code></a>.</p>
<p>Nós usamos o módulo para criar um servidor HTTP.</p>
<p>É definido para o servidor escutar na porta especificada, <code class="language-text">3000</code>. Quando o servidor está pronto, a função callback <code class="language-text">listen</code> é chamada.</p>
<p>A função callback que passamos é a que será executada em toda requisição. Sempre que uma nova requisição é recebida, o <a href="https://nodejs.org/api/http.html#http_event_request">evento <code class="language-text">request</code></a> é chamado, fornecendo dois objetos: request (instância de <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage"><code class="language-text">http.IncomingMessage</code></a>) e response (instância de <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse"><code class="language-text">http.ServerResponse</code></a>).</p>
<p><code class="language-text">request</code> contém os detalhes da requisição. Através dele, nós acessamos os cabeçalhos (headers) e os dados da requisição.</p>
<p><code class="language-text">response</code> é usado para popular os dados que vamos retornar ao cliente.</p>
<p>No seguinte caso</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>nós definimos a propriedade statusCode para 200, para indicar uma resposta bem sucedida.</p>
<p>Nós também definimos a header Content-Type:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e fechamos a resposta, adicionando o conteúdo como um argumento do <code class="language-text">end()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Fazendo requisições HTTP com o Node.js</h2>
<h2>Realizando uma requisição do tipo GET</h2>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  hostname<span class="token punctuation">:</span> <span class="token string">'whatever.com'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/todos'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'GET'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">statusCode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>statusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Realizando uma requisição do tipo POST</h2>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todo<span class="token punctuation">:</span> <span class="token string">'Buy the milk'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  hostname<span class="token punctuation">:</span> <span class="token string">'whatever.com'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/todos'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> data<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">statusCode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>statusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Requisições do tipos PUT e DELETE</h2>
<p>Requisições PUT e DELETE usam o mesmo formato da requisição POST, mudando apenas o valor do <code class="language-text">options.method</code>.</p>
<h2>Faça um HTTP POST request com Node.js</h2>
<p>Existem diversas maneiras de realizar uma requisição do tipo POST no Node.js, dependendo do nível de abstração que você quer utilizar.</p>
<p>O jeito mais simples de fazer uma requisição HTTP usando Node.js é usar a <a href="https://github.com/axios/axios">biblioteca Axios</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

axios
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'https://whatever.com/todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    todo<span class="token punctuation">:</span> <span class="token string">'Buy the milk'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">statusCode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>statusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Utilizar o Axios requer o uso de uma biblioteca de terceiros.</p>
<p>É possível fazer uma requisição POST usando apenas os módulos nativos do Node.js, porém é mais verboso que as duas opções anteriores:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todo<span class="token punctuation">:</span> <span class="token string">'Buy the milk'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  hostname<span class="token punctuation">:</span> <span class="token string">'whatever.com'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/todos'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> data<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">statusCode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>statusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Faça uma requisição GET de HTTP com body usando Node.js</h2>
<p>Aqui temos como você pode extrair dados que foram enviados como JSON no corpo da requisição:</p>
<p>Se você está usando Express, é bem simples: utilize o módulo <code class="language-text">body-parser</code>.</p>
<p>Por exemplo, para obter o corpo dessa requisição:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'https://whatever.com/todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  todo<span class="token punctuation">:</span> <span class="token string">'Buy the milk'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esse é o código do servidor que vai receber a requisição:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    extended<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/todos'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>todo<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Se você não está usando Express, e você quer fazer isso em Node.js raiz, terá um pouco mais de trabalho, é claro, pois o Express abstrai muitas coisas pra você.</p>
<p>O ponto chave pra se entender é que quando você inicializa um servidor HTTP usando <code class="language-text">http.createServer()</code>, a callback é chamada quando o servidor obtêm todos os cabeçalhos HTTP, mas não o body (corpo da requisição).</p>
<p>O objeto <code class="language-text">request</code> passado na conexão de callback é uma stream.</p>
<p>Então, nós devemos escutar pelo conteúdo do body a ser processado, e ele é processado em chunks(pedaços).</p>
<p>Primeiro nós obtemos os dados escutando os eventos de <code class="language-text">data</code> da stream, e quando eles finalizam, a stream emite o evento <code class="language-text">end</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// nós podemos acessar os cabeçalhos HTTP</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Data chunk available: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// fim dos eventos data</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Então para acessar os dados, assumindo que esperamos receber uma string, nós devemos colocá-los em um array:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>todo <span class="token comment">// 'Buy the milk'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Trabalhando com file descriptors node Node.js</h2>
<p>Antes que você seja capaz de interagir com um arquivo presente no seu filesystem, você deve obter um file descriptor (descritor de arquivo).</p>
<p>Um file descriptor é o que é retornado ao abrir um arquivo utilizando o método <code class="language-text">open()</code> do módulo <code class="language-text">fs</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// fd é o nosso file descriptor</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Note o <code class="language-text">r</code> que usamos como segundo parâmetro da chamada <code class="language-text">fs.open()</code>.</p>
<p>Essa flag significa que nós abrimos o arquivo para leitura.</p>
<p>Outras flags que você normalmente utilizará são:</p>
<ul>
<li><code class="language-text">r+</code> abre o arquivo para leitura e escrita</li>
<li><code class="language-text">w+</code> abre o arquivo para leitura e escrita, posicionando a stream no início do arquivo. O arquivo é criado se não existir.</li>
<li><code class="language-text">a</code> abre o arquivo para escrita, posicionando a stream no fim do arquivo. O arquivo é criado se não existir.</li>
<li><code class="language-text">a+</code> abre o arquivo para leitura e escrita, posicionando a stream no fim do arquivo. O arquivo é criado se não existir.</li>
</ul>
<p>Você também pode abrir o arquivo utilizando o método <code class="language-text">fs.openSync</code>, que retorna o file descriptor, em vez de fornecê-lo dentro de uma callback:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fd <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">openSync</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Uma vez que você obtenha o file descriptor, independentemente do método escolhido, você pode fazer todas operações que o requerem, como chamar <code class="language-text">fs.open()</code> e muitas outras operações que interagem com o filesystem.</p>
<h2>Node.js file stats</h2>
<p>Todo arquivo vem com um conjunto de detalhes que nós podemos inspecionar usando Node.js.</p>
<p>Em particular, usando o método <code class="language-text">stat()</code> do módulo <code class="language-text">fs</code>.</p>
<p>Você o chama passando o caminho do arquivo, e uma vez que o Node.js obtenha os detalhes do arquivo ele chamará a função callback que você passar, com 2 parâmetros: uma mensagem de erro, e os detalhes do arquivo.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// nós temos acesso aos detalhes do arquivo no `stats`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>O Node.js também fornece um método síncrono, que bloqueia a thread até que os detalhes do arquivo estejam prontos:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stats <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>As informações do arquivo estão inclusas na variável stats. Que tipos de informações nós podemos extrair usando o stats?</p>
<p>Muitas, incluindo:</p>
<ul>
<li>se o arquivo é um diretório ou um arquivo, usando <code class="language-text">stats.isFile()</code> e <code class="language-text">stats.isDirectory()</code></li>
<li>se o arquivo é um link simbólico, usando <code class="language-text">stats.isSymbolicLink()</code></li>
<li>o tamanho do arquivo, usando <code class="language-text">stats.size</code>.</li>
</ul>
<p>Há outros métodos avançados, mas a maior parte do que você vai usar na programação do dia a dia são esses.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
  stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
  stats<span class="token punctuation">.</span><span class="token function">isSymbolicLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
  stats<span class="token punctuation">.</span>size <span class="token comment">// 1024000 //= 1MB</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Node.js File Paths</h2>
<p>Todo arquivo no sistema tem um caminho.</p>
<p>No Linux e no macOS, um caminho tem essa cara:</p>
<p><code class="language-text">/users/joe/file.txt</code></p>
<p>enquanto que em computadores Windows é bem diferente, a estrutura é algo assim:</p>
<p><code class="language-text">C:\users\joe\file.txt</code></p>
<p>Você precisa prestar atenção quando está utilizando caminhos na sua aplicação, as diferenças devem ser levadas em consideração.</p>
<p>Para trabalhar com caminhos, inclua esse módulo em seus arquivos:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Obtendo informações de um caminho</h2>
<p>Dado um caminho, você pode extrair informações dele usando esses métodos:</p>
<ul>
<li><code class="language-text">dirname</code>: obtêm a pasta pai do arquivo</li>
<li><code class="language-text">basename</code>: obtêm a parte do nome do arquivo</li>
<li><code class="language-text">extname</code>: obtêm a parte da extensão do arquivo</li>
</ul>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token string">'/users/joe/notes.txt'</span>

path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span> <span class="token comment">// /users/joe</span>
path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span> <span class="token comment">// notes.txt</span>
path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span> <span class="token comment">// .txt</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você pode obter o nome do arquivo sem a extensão ao especificar um segundo argumento no <code class="language-text">basename</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>notes<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// notes</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Trabalhando com caminhos</h2>
<p>Você pode unir duas ou mais partes de um caminho ao utilizar <code class="language-text">path.join()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'joe'</span>
path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'notes.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/users/joe/notes.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Você pode obter o cálculo do caminho absoluto de um caminho relativo utilizando <code class="language-text">path.resolve()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/Users/joe/joe.txt' se rodar a partir da minha pasta home</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Nesse caso o Nodejs vai simplesmente adicionar <code class="language-text">/joe.txt</code> na pasta atual. Se você especificar uma pasta como segundo parâmetro, o <code class="language-text">resolve</code> vai usar o primeiro como base pro segundo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'tmp'</span><span class="token punctuation">,</span> <span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/Users/joe/tmp/joe.txt' se rodar a partir da minha pasta home</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Se o primeiro parâmetro começa com uma barra, isso implica que é um caminho absoluto:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/etc'</span><span class="token punctuation">,</span> <span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/etc/joe.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><code class="language-text">path.normalize()</code> é outra função bem útil, que tentará calcular o caminho real, quando ele contêm especificadores relativos como <code class="language-text">.</code> ou <code class="language-text">..</code>, ou barras duplas:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">'/users/joe/..//test.txt'</span><span class="token punctuation">)</span> <span class="token comment">// /users/test.txt</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><strong>Ambos resolve e normalize não irão validar se o caminho existe</strong>. Eles só calculam um caminho baseado nas informações fornecidas.</p>
<h2>Lendo arquivos com Node.js</h2>
<p>O jeito mais fácil de ler um arquivo no Node.js é utilizar o método <code class="language-text">fs.readFile()</code>, passando o caminho do arquivo, a codificação e uma função callback que será invocada com os dados do arquivo (e o erro):</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Alternativamente, você pode usar a versão síncrona, <code class="language-text">fs.readFileSync()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Ambos <code class="language-text">fs.readFile()</code> e <code class="language-text">fs.readFileSync()</code> lêem todo conteúdo do arquivo em memória antes de retornar os dados.</p>
<p>Isso significa que arquivos grandes vão causar grandes impactos no consumo de memória e na velocidade de execução do programa.</p>
<p>Nesse caso, uma opção melhor é ler o conteúdo do arquivo usando streams.</p>
<h2>Escrevendo arquivos com Node.js</h2>
<p>O jeito mais fácil de escrever em arquivos com Node.js é utilizando a API <code class="language-text">fs.writeFile()</code>.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Some content!'</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// arquivo escrito com sucesso</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Alternativamente, você pode usar a versão síncrona, <code class="language-text">fs.writeFileSync()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Some content!'</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
  <span class="token comment">// arquivo escrito com sucesso</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Por padrão, essa API vai <strong>apagar o conteúdo do arquivo</strong> se ele existir.
By default, this API will <strong>replace the contents of the file</strong> if it does already exist.</p>
<p>Você pode modificar o comportamento padrão especificando uma flag:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">{</span> flag<span class="token punctuation">:</span> <span class="token string">'a+'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>As flags que você normalmente utilizará são</p>
<ul>
<li><code class="language-text">r+</code> abre o arquivo para leitura e escrita</li>
<li><code class="language-text">w+</code> abre o arquivo para leitura e escrita, posicionando a stream no início do arquivo. O arquivo é criado se não existir</li>
<li><code class="language-text">a</code> abre o arquivo para escrita, posicionando a stream no fim do arquivo. O arquivo é criado se não existir</li>
<li><code class="language-text">a+</code> abre o arquivo para leitura e escrita, posicionando a stream no fim do arquivo. O arquivo é criado se não existir</li>
</ul>
<p>(você pode encontrar mais flags em <a href="https://nodejs.org/api/fs.html#fs_file_system_flags">https://nodejs.org/api/fs.html#fs_file_system_flags</a>)</p>
<h2>Acrescentar conteúdo em um arquivo</h2>
<p>Um método muito útil acrescentar conteúdo no fim de um arquivo é o <code class="language-text">fs.appendFile()</code> (e sua contraparte <code class="language-text">fs.appendFileSync()</code>):</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Some content!'</span>

fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'file.log'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// feito!</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Usando streams</h2>
<p>Todos esses métodos escrevem o conteúdo completo no arquivo antes de retornarem o controle de volta ao programa (na versão assíncrona, isso significa executar a callback)</p>
<p>Nesse caso, uma opção melhor é escrever o conteúdo do arquivo usando streams.</p>
<h2>Trabalhando com folders no Node.js</h2>
<p>O módulo nativo <code class="language-text">fs</code> do Node.js fornece diversos métodos versáteis para trabalhar com pastas.</p>
<h2>Valide se uma pasta existe</h2>
<p>Utilize <code class="language-text">fs.access()</code> para validar se a pasta existe e o Node.js pode acessá-la com suas permissões.</p>
<h2>Crie uma nova pasta</h2>
<p>Utilize <code class="language-text">fs.mkdir()</code> ou <code class="language-text">fs.mkdirSync()</code> para criar uma nova pasta.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> folderName <span class="token operator">=</span> <span class="token string">'/Users/joe/test'</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>folderName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>folderName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Leia o conteúdo de um diretório</h2>
<p>Utilize <code class="language-text">fs.readdir()</code> ou <code class="language-text">fs.readdirSync()</code> para ler os conteúdos de um diretório.</p>
<p>Esse trecho de código lê o conteúdo de uma pasta, ambos arquivos e subpastas, e retorna o caminho relativo deles:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> folderPath <span class="token operator">=</span> <span class="token string">'/Users/joe'</span>

fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você pode obter o caminho inteiro:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Você também pode filtrar os resultados para retornar apenas os arquivos, excluindo as pastas:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">isFile</span> <span class="token operator">=</span> <span class="token parameter">fileName</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">lstatSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isFile<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Renomeie uma pasta</h2>
<p>Utilize <code class="language-text">fs.rename()</code> ou <code class="language-text">fs.renameSync()</code> para renomear uma pasta. O primeiro parâmetro é o caminho atual, o segundo o novo caminho:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'/Users/joe'</span><span class="token punctuation">,</span> <span class="token string">'/Users/roger'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// feito</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">fs.renameSync()</code> é a versão síncrona:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span><span class="token string">'/Users/joe'</span><span class="token punctuation">,</span> <span class="token string">'/Users/roger'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Delete uma pasta</h2>
<p>Utilize <code class="language-text">fs.rmdir()</code> ou <code class="language-text">fs.rmdirSync()</code> para deletar uma pasta.</p>
<p>Deletar uma pasta que tem conteúdo pode ser mais complicado do que o esperado.</p>
<p>Nesse caso é melhor instalar o módulo <a href="https://www.npmjs.com/package/fs-extra"><code class="language-text">fs-extra</code></a>, que é bem popular e atualizado. É uma substituição do módulo <code class="language-text">fs</code>, que possui mais funcionalidades.</p>
<p>Nesse caso o método que você quer é o <code class="language-text">remove()</code>.</p>
<p>Instale usando</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> fs-extra</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>e use-o assim:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> folder <span class="token operator">=</span> <span class="token string">'/Users/joe'</span>

fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Também pode ser utilizado com promises:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//done</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>ou com async/await:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">removeFolder</span><span class="token punctuation">(</span><span class="token parameter">folder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span>
    <span class="token comment">//done</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> folder <span class="token operator">=</span> <span class="token string">'/Users/joe'</span>
<span class="token function">removeFolder</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>O módulo fs</h2>
<p>O módulo <code class="language-text">fs</code> disponibiliza diversas funcionalidades úteis para acessar e interagir com o file system.</p>
<p>Não há necessidade de intalá-lo. Sendo parte do núcleo do Node.js, basta importar para poder usá-lo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Feito isso, você tem acesso a todos os métodos dele, o que inclui:</p>
<ul>
<li><code class="language-text">fs.access()</code>: checa se o arquivo existe e se o Node.js pode acessá-lo com suas permissões atuais</li>
<li><code class="language-text">fs.appendFile()</code>: acrescenta dados em um arquivo. Se o arquivo não existir, ele é criado.</li>
<li><code class="language-text">fs.chmod()</code>: muda as permissões de um arquivo especificado pelo nome que foi passado. Relacionado: <code class="language-text">fs.lchmod()</code>, <code class="language-text">fs.fchmod()</code></li>
<li><code class="language-text">fs.chown()</code>: muda o proprietário e o grupo do arquivo especificado pelo nome que foi passado. Relacionado: <code class="language-text">fs.fchown()</code>, <code class="language-text">fs.lchown()</code></li>
<li><code class="language-text">fs.close()</code>: fecha um descriptor de arquivo</li>
<li><code class="language-text">fs.copyFile()</code>: copia um arquivo</li>
<li><code class="language-text">fs.createReadStream()</code>: cria uma stream de arquivo para leitura</li>
<li><code class="language-text">fs.createWriteStream()</code>: cria uma stream de arquivo para escrita</li>
<li><code class="language-text">fs.link()</code>: cria um novo hard link para um arquivo</li>
<li><code class="language-text">fs.mkdir()</code>: cria um novo diretório</li>
<li><code class="language-text">fs.mkdtemp()</code>: cria um novo diretório temporário</li>
<li><code class="language-text">fs.open()</code>: define o file mode</li>
<li><code class="language-text">fs.readdir()</code>: lê os conteúdos de um diretório</li>
<li><code class="language-text">fs.readFile()</code>: lê os conteúdos de um arquivo. Relacionado: <code class="language-text">fs.read()</code></li>
<li><code class="language-text">fs.readlink()</code>: lê o valor de um link simbólico</li>
<li><code class="language-text">fs.realpath()</code>: resolve caminhos relativos de arquivo com ponteiros (<code class="language-text">.</code>, <code class="language-text">..</code>) para o caminho completo</li>
<li><code class="language-text">fs.rename()</code>: renomeia um arquivo ou pasta</li>
<li><code class="language-text">fs.rmdir()</code>: deleta um diretório</li>
<li><code class="language-text">fs.stat()</code>: retorna o status do arquivo identificado pelo nome que foi passado. Relacionado: <code class="language-text">fs.fstat()</code>, <code class="language-text">fs.lstat()</code></li>
<li><code class="language-text">fs.symlink()</code>: cria um novo link simbólico para um arquivo</li>
<li><code class="language-text">fs.truncate()</code>: trunca o arquivo identificado pelo nome que foi passado para o tamanho especificado. Relacionado: <code class="language-text">fs.ftruncate()</code></li>
<li><code class="language-text">fs.unlink()</code>: remove um arquivo ou um link simbólico</li>
<li><code class="language-text">fs.unwatchFile()</code>: para de observar mudanças em um arquivo</li>
<li><code class="language-text">fs.utimes()</code>: muda a timestamp do arquivo identificado pelo nome que foi passado. Relacionado: <code class="language-text">fs.futimes()</code></li>
<li><code class="language-text">fs.watchFile()</code>: começa a observar mudanças em um arquivo. Relacionado: <code class="language-text">fs.watch()</code></li>
<li><code class="language-text">fs.writeFile()</code>: escreve dados em um arquivo. Relacionado: <code class="language-text">fs.write()</code></li>
</ul>
<p>Uma coisa peculiar sobre o módulo <code class="language-text">fs</code> é que todos os métodos são assíncronos por padrão, mas eles também podem rodar de forma síncrona adicionando <code class="language-text">Sync</code> no nome.</p>
<p>Por exemplo:</p>
<ul>
<li><code class="language-text">fs.rename()</code></li>
<li><code class="language-text">fs.renameSync()</code></li>
<li><code class="language-text">fs.write()</code></li>
<li><code class="language-text">fs.writeSync()</code></li>
</ul>
<p>Isso faz uma enorme diferença no fluxo da sua aplicação.</p>
<blockquote>
<p>O Node.js 10 inclui <a href="https://nodejs.org/api/fs.html#fs_fs_promises_api">suporte experimental</a> para uma API baseada em promises</p>
</blockquote>
<p>Por exemplo, vamos analisar o método <code class="language-text">fs.rename()</code>. A API assíncrona é usada com uma callback:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'before.json'</span><span class="token punctuation">,</span> <span class="token string">'after.json'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// feito</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Uma API síncrona pode ser usada com um bloco de try/catch para tratar erros:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span><span class="token string">'before.json'</span><span class="token punctuation">,</span> <span class="token string">'after.json'</span><span class="token punctuation">)</span>
  <span class="token comment">// feito</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>A principal diferença aqui é que a execução do seu script no segundo exemplo vai bloquear a thread, até que a operação no arquivo seja bem-sucedida.</p>
<h2>O módulo path</h2>
<p>O módulo <code class="language-text">path</code> disponibiliza diversas funcionalidades úteis para acessar e interagir com o file system.</p>
<p>Não há necessidade de intalá-lo. Sendo parte do núcleo do Node.js, basta importar para poder usá-lo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Esse módulo possui o <code class="language-text">path.sep</code> que provê o caracter separador de segmento de caminho (<code class="language-text">\</code> no Windows, e <code class="language-text">/</code> no Linux / macOS), e o <code class="language-text">path.delimiter</code> que provê o caracter delimitador de caminho (<code class="language-text">;</code> no Windows, e <code class="language-text">:</code> no Linux / macOS).</p>
<p>Esses são os métodos do <code class="language-text">path</code>:</p>
<h3><code class="language-text">path.basename()</code></h3>
<p>Retorna a última parte de um caminho. Um segundo parâmetro pode filtrar a extensão do arquivo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'/test/something'</span><span class="token punctuation">)</span> <span class="token comment">// something</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'/test/something.txt'</span><span class="token punctuation">)</span> <span class="token comment">// something.txt</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'/test/something.txt'</span><span class="token punctuation">,</span> <span class="token string">'.txt'</span><span class="token punctuation">)</span> <span class="token comment">// something</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.dirname()</code></h3>
<p>Retorna a parte do diretório de um caminho:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token string">'/test/something'</span><span class="token punctuation">)</span> <span class="token comment">// /test</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token string">'/test/something/file.txt'</span><span class="token punctuation">)</span> <span class="token comment">// /test/something</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.extname()</code></h3>
<p>Retorna a parte da extensão de um caminho</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'/test/something'</span><span class="token punctuation">)</span> <span class="token comment">// ''</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'/test/something/file.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.isAbsolute()</code></h3>
<p>Retorna true se o caminho for absoluto</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">'/test/something'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">'./test/something'</span><span class="token punctuation">)</span> <span class="token comment">// false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.join()</code></h3>
<p>Junta duas ou mais partes de um caminho:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'joe'</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'notes.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/users/joe/notes.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.normalize()</code></h3>
<p>Tenta calcular o caminho correto quando ele contêm especificadores relativos como <code class="language-text">.</code> ou <code class="language-text">..</code>, ou barras duplas:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">'/users/joe/..//test.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/users/test.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3><code class="language-text">path.parse()</code></h3>
<p>Cria um objeto contendo os segmentos que compões o caminho fornecido:</p>
<ul>
<li><code class="language-text">root</code>: a raiz</li>
<li><code class="language-text">dir</code>: o caminho da pasta a partir da raiz</li>
<li><code class="language-text">base</code>: o nome do arquivo + extensão</li>
<li><code class="language-text">name</code>: o nome do arquivo</li>
<li><code class="language-text">ext</code>: a extensão do arquivo</li>
</ul>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'/users/test.txt'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>resulta em</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>
  root<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  dir<span class="token punctuation">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span>
  base<span class="token punctuation">:</span> <span class="token string">'test.txt'</span><span class="token punctuation">,</span>
  ext<span class="token punctuation">:</span> <span class="token string">'.txt'</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.relative()</code></h3>
<p>Aceita 2 caminhos como argumentos. Retorna o caminho relativo do primeiro para o segundo, baseando-se no diretório atual.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token string">'/Users/joe'</span><span class="token punctuation">,</span> <span class="token string">'/Users/joe/test.txt'</span><span class="token punctuation">)</span> <span class="token comment">// 'test.txt'</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token string">'/Users/joe'</span><span class="token punctuation">,</span> <span class="token string">'/Users/joe/something/test.txt'</span><span class="token punctuation">)</span> <span class="token comment">// 'something/test.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">path.resolve()</code></h3>
<p>Você pode obter o cálculo do caminho absoluto de um caminho relativo usando <code class="language-text">path.resolve()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/Users/joe/joe.txt' se rodar da minha home</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Ao especificar um segundo parâmetro, o <code class="language-text">resolve</code> vai usar o primeiro como base para o segundo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'tmp'</span><span class="token punctuation">,</span> <span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/Users/joe/tmp/joe.txt' se rodar da minha home</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Se o primeiro parâmetro começar com uma barra, isso significa que é um caminho absoluto:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/etc'</span><span class="token punctuation">,</span> <span class="token string">'joe.txt'</span><span class="token punctuation">)</span> <span class="token comment">// '/etc/joe.txt'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>O Módulo OS</h2>
<p>Esse módulo disponibiliza diversas funções que você pode usar para obter informações do sistema operacional e do computador em que o programa está executando, e interagir com ele.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Há algumas propriedades úteis que nos dizem algumas coisas importantes relacionadas a manipulação de arquivos:</p>
<p><code class="language-text">os.EOL</code> retorna o a sequência delimitadora de linha (caracter de pular linha). <code class="language-text">\n</code> no Linux e macOS, e <code class="language-text">\r\n</code> no Windows.</p>
<p><code class="language-text">os.constants.signals</code> retorna todas contantes relacionadas a sinais de processos, como SIGHUP, SIGKILL e outros.</p>
<p><code class="language-text">os.constants.errno</code> define as constantes para reportar erros, como EADDRINUSE, EOVERFLOW e mais outras.</p>
<p>Você pode ver todas constantes em <a href="https://nodejs.org/api/os.html#os_signal_constants">https://nodejs.org/api/os.html#os_signal_constants</a>.</p>
<p>Agora vamos ver os principais métodos do <code class="language-text">os</code>:</p>
<h2><code class="language-text">os.arch()</code></h2>
<p>Retorna uma string que identifica a arquitetura, como <code class="language-text">arm</code>, <code class="language-text">x64</code>, <code class="language-text">arm64</code>.</p>
<h2><code class="language-text">os.cpus()</code></h2>
<p>Retorna informações sobre as CPUs disponívels no seu sistema.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    model<span class="token punctuation">:</span> <span class="token string">'Intel(R) Core(TM)2 Duo CPU     P8600  @ 2.40GHz'</span><span class="token punctuation">,</span>
    speed<span class="token punctuation">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    times<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">:</span> <span class="token number">281685380</span><span class="token punctuation">,</span>
      nice<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      sys<span class="token punctuation">:</span> <span class="token number">187986530</span><span class="token punctuation">,</span>
      idle<span class="token punctuation">:</span> <span class="token number">685833750</span><span class="token punctuation">,</span>
      irq<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    model<span class="token punctuation">:</span> <span class="token string">'Intel(R) Core(TM)2 Duo CPU     P8600  @ 2.40GHz'</span><span class="token punctuation">,</span>
    speed<span class="token punctuation">:</span> <span class="token number">2400</span><span class="token punctuation">,</span>
    times<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">:</span> <span class="token number">282348700</span><span class="token punctuation">,</span>
      nice<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      sys<span class="token punctuation">:</span> <span class="token number">161800480</span><span class="token punctuation">,</span>
      idle<span class="token punctuation">:</span> <span class="token number">703509470</span><span class="token punctuation">,</span>
      irq<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2><code class="language-text">os.endianness()</code></h2>
<p>Retorna <code class="language-text">BE</code> ou <code class="language-text">LE</code> dependendo se o Node.js foi compilado com <a href="https://en.wikipedia.org/wiki/Endianness">Big Endian ou Little Endian</a>.</p>
<h2><code class="language-text">os.freemem()</code></h2>
<p>Retorna o número de bytes que representam a memória livre no seu sistema.</p>
<h2><code class="language-text">os.homedir()</code></h2>
<p>Retorna o caminho do diretório home do usuário corrente.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">'/Users/joe'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">os.hostname()</code></h2>
<p>Retorna o host name.</p>
<h2><code class="language-text">os.loadavg()</code></h2>
<p>Retorna o cálculo feito pelo sistema operacional na média de carregamento.</p>
<p>Só retorna um valor significativo no Linux e no macOS.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span><span class="token number">3.68798828125</span><span class="token punctuation">,</span> <span class="token number">4.00244140625</span><span class="token punctuation">,</span> <span class="token number">11.1181640625</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">os.networkInterfaces()</code></h2>
<p>Retorna os detalhes das interfaces de rede disponíveis no seu sistema.</p>
<p>Exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span> lo0<span class="token punctuation">:</span>
   <span class="token punctuation">[</span> <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'255.0.0.0'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv4'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'fe:82:00:00:00:00'</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'::1'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv6'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'fe:82:00:00:00:00'</span><span class="token punctuation">,</span>
       scopeid<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'fe80::1'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'ffff:ffff:ffff:ffff::'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv6'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'fe:82:00:00:00:00'</span><span class="token punctuation">,</span>
       scopeid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  en1<span class="token punctuation">:</span>
   <span class="token punctuation">[</span> <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'fe82::9b:8282:d7e6:496e'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'ffff:ffff:ffff:ffff::'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv6'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'06:00:00:02:0e:00'</span><span class="token punctuation">,</span>
       scopeid<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'192.168.1.38'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'255.255.255.0'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv4'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'06:00:00:02:0e:00'</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  utun0<span class="token punctuation">:</span>
   <span class="token punctuation">[</span> <span class="token punctuation">{</span> address<span class="token punctuation">:</span> <span class="token string">'fe80::2513:72bc:f405:61d0'</span><span class="token punctuation">,</span>
       netmask<span class="token punctuation">:</span> <span class="token string">'ffff:ffff:ffff:ffff::'</span><span class="token punctuation">,</span>
       family<span class="token punctuation">:</span> <span class="token string">'IPv6'</span><span class="token punctuation">,</span>
       mac<span class="token punctuation">:</span> <span class="token string">'fe:80:00:20:00:00'</span><span class="token punctuation">,</span>
       scopeid<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
       internal<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2><code class="language-text">os.platform()</code></h2>
<p>Retorna a plataforma em que o Node.js foi compilado:</p>
<ul>
<li><code class="language-text">darwin</code></li>
<li><code class="language-text">freebsd</code></li>
<li><code class="language-text">linux</code></li>
<li><code class="language-text">openbsd</code></li>
<li><code class="language-text">win32</code></li>
<li>…outros</li>
</ul>
<h2><code class="language-text">os.release()</code></h2>
<p>Retorna uma string que identifica o número da versão do sistema operacional</p>
<h2><code class="language-text">os.tmpdir()</code></h2>
<p>Retorna o caminho da pasta temp atribuida.</p>
<h2><code class="language-text">os.totalmem()</code></h2>
<p>Retorna o número de bytes que representam o total de memória disponível no sistema.</p>
<h2><code class="language-text">os.type()</code></h2>
<p>Identifica o sistema operacional:</p>
<ul>
<li><code class="language-text">Linux</code></li>
<li><code class="language-text">Darwin</code> no macOS</li>
<li><code class="language-text">Windows_NT</code> no Windows</li>
</ul>
<h2><code class="language-text">os.uptime()</code></h2>
<p>Retorna o número de segundos em que o computador está rodando desde o último reinício.</p>
<h2><code class="language-text">os.userInfo()</code></h2>
<p>Retorna um objeto contendo o <code class="language-text">username</code> corrente, <code class="language-text">uid</code>, <code class="language-text">gid</code>, <code class="language-text">shell</code>, e <code class="language-text">homedir</code></p>
<h2>O módulo de eventos</h2>
<p>O móduo <code class="language-text">events</code> nos disponibiliza a classe EventEmitter, que é essencial para trabalhar com eventos no Node.js.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> door <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>O event listener usa esses eventos:</p>
<ul>
<li><code class="language-text">newListener</code> quando um listener é adicionado</li>
<li><code class="language-text">removeListener</code> quando um listener é removido</li>
</ul>
<p>Aqui detamos uma descrição detalhade dos métodos mais usados:</p>
<h2><code class="language-text">emitter.addListener()</code></h2>
<p>Alias para <code class="language-text">emitter.on()</code>.</p>
<h2><code class="language-text">emitter.emit()</code></h2>
<p>Emite um evento. Chama sincronamente todo event listener na ordem em que foram registrados.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"slam"</span><span class="token punctuation">)</span> <span class="token comment">// emitindo o evento "slam"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.eventNames()</code></h2>
<p>Retorna um array de string que representa os eventos regstrados no objeto <code class="language-text">EventEmitter</code> atual:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">eventNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.getMaxListeners()</code></h2>
<p>Obtêm a quantidade máxima de listeners que podem ser adicionados em um objeto <code class="language-text">EventEmitter</code>, que por padrão é 10 mas pode ser aumentado ou diminuido utilizando <code class="language-text">setMaxListeners()</code></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">getMaxListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.listenerCount()</code></h2>
<p>Obtêm a contagem total de listeners do evento passado como parâmetro:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">listenerCount</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.listeners()</code></h2>
<p>Obtêm um array de listeners do evento passado como parâmetro:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.off()</code></h2>
<p>Alias para <code class="language-text">emitter.removeListener()</code> adicionado no Node.js 10</p>
<h2><code class="language-text">emitter.on()</code></h2>
<p>Adiciona uma função callback que é chamada quando um evento é emitido.</p>
<p>Uso:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Door was opened'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2><code class="language-text">emitter.once()</code></h2>
<p>Adiciona uma função callback que será chamada quando um evento for emitido pela primeira vez depois de registrado. Essa callback só será chamada uma vez.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

ee<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'my-event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// chama a função callback uma vez</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2><code class="language-text">emitter.prependListener()</code></h2>
<p>Quando você adiciona um listener usando <code class="language-text">on</code> ou <code class="language-text">addListener</code>, ele é adicionado no fim da fila de listener, e chamado por último. Usando <code class="language-text">preprendListener</code> ele será adicionado, e chamado, antes dos outros listeners.</p>
<h2><code class="language-text">emitter.prependOnceListener()</code></h2>
<p>Quando você adiciona um listener usando <code class="language-text">once</code>, ele é adicionado na fila de listeners, e chamado por último. Usando <code class="language-text">prependOnceListener</code> ele é adicionado, e chamado, antes dos outros listeners.</p>
<h2><code class="language-text">emitter.removeAllListeners()</code></h2>
<p>Remove todos os listeners de um objeto <code class="language-text">EventEmitter</code> escutando um evento em específico:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">removeAllListeners</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2><code class="language-text">emitter.removeListener()</code></h2>
<p>Remove um listener em específico. Você pode fazer isso salvando a função callback em uma variável, quando adicionada, ela pode ser referenciada mais tarde:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">doSomething</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
door<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> doSomething<span class="token punctuation">)</span>
door<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> doSomething<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2><code class="language-text">emitter.setMaxListeners()</code></h2>
<p>Define a quantidade máxima de listeners que podem ser adicionados em um objeto <code class="language-text">EventEmitter</code>, que por padrão é 10 mas pode ser aumentado ou diminuido.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">door<span class="token punctuation">.</span><span class="token function">setMaxListeners</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Módulo HTTP</h2>
<p>O módulo HTTP é um módulo essencial para aplicações de rede em Node.js.</p>
<p>Ele pode ser importado assim:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>O módulo disponibiliza algumas propriedades e métodos, e também algumas classes.</p>
<h2>Properties</h2>
<h3><code class="language-text">http.METHODS</code></h3>
<p>Essa propriedade lista todos os métodos HTTP suportados:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">METHODS</span>
<span class="token punctuation">[</span> <span class="token string">'ACL'</span><span class="token punctuation">,</span>
  <span class="token string">'BIND'</span><span class="token punctuation">,</span>
  <span class="token string">'CHECKOUT'</span><span class="token punctuation">,</span>
  <span class="token string">'CONNECT'</span><span class="token punctuation">,</span>
  <span class="token string">'COPY'</span><span class="token punctuation">,</span>
  <span class="token string">'DELETE'</span><span class="token punctuation">,</span>
  <span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token string">'HEAD'</span><span class="token punctuation">,</span>
  <span class="token string">'LINK'</span><span class="token punctuation">,</span>
  <span class="token string">'LOCK'</span><span class="token punctuation">,</span>
  <span class="token string">'M-SEARCH'</span><span class="token punctuation">,</span>
  <span class="token string">'MERGE'</span><span class="token punctuation">,</span>
  <span class="token string">'MKACTIVITY'</span><span class="token punctuation">,</span>
  <span class="token string">'MKCALENDAR'</span><span class="token punctuation">,</span>
  <span class="token string">'MKCOL'</span><span class="token punctuation">,</span>
  <span class="token string">'MOVE'</span><span class="token punctuation">,</span>
  <span class="token string">'NOTIFY'</span><span class="token punctuation">,</span>
  <span class="token string">'OPTIONS'</span><span class="token punctuation">,</span>
  <span class="token string">'PATCH'</span><span class="token punctuation">,</span>
  <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token string">'PROPFIND'</span><span class="token punctuation">,</span>
  <span class="token string">'PROPPATCH'</span><span class="token punctuation">,</span>
  <span class="token string">'PURGE'</span><span class="token punctuation">,</span>
  <span class="token string">'PUT'</span><span class="token punctuation">,</span>
  <span class="token string">'REBIND'</span><span class="token punctuation">,</span>
  <span class="token string">'REPORT'</span><span class="token punctuation">,</span>
  <span class="token string">'SEARCH'</span><span class="token punctuation">,</span>
  <span class="token string">'SUBSCRIBE'</span><span class="token punctuation">,</span>
  <span class="token string">'TRACE'</span><span class="token punctuation">,</span>
  <span class="token string">'UNBIND'</span><span class="token punctuation">,</span>
  <span class="token string">'UNLINK'</span><span class="token punctuation">,</span>
  <span class="token string">'UNLOCK'</span><span class="token punctuation">,</span>
  <span class="token string">'UNSUBSCRIBE'</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3><code class="language-text">http.STATUS_CODES</code></h3>
<p>Essa propriedade lista todos os códigos de status HTTP e suas descrições:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">STATUS_CODES</span>
<span class="token punctuation">{</span> <span class="token string">'100'</span><span class="token punctuation">:</span> <span class="token string">'Continue'</span><span class="token punctuation">,</span>
  <span class="token string">'101'</span><span class="token punctuation">:</span> <span class="token string">'Switching Protocols'</span><span class="token punctuation">,</span>
  <span class="token string">'102'</span><span class="token punctuation">:</span> <span class="token string">'Processing'</span><span class="token punctuation">,</span>
  <span class="token string">'200'</span><span class="token punctuation">:</span> <span class="token string">'OK'</span><span class="token punctuation">,</span>
  <span class="token string">'201'</span><span class="token punctuation">:</span> <span class="token string">'Created'</span><span class="token punctuation">,</span>
  <span class="token string">'202'</span><span class="token punctuation">:</span> <span class="token string">'Accepted'</span><span class="token punctuation">,</span>
  <span class="token string">'203'</span><span class="token punctuation">:</span> <span class="token string">'Non-Authoritative Information'</span><span class="token punctuation">,</span>
  <span class="token string">'204'</span><span class="token punctuation">:</span> <span class="token string">'No Content'</span><span class="token punctuation">,</span>
  <span class="token string">'205'</span><span class="token punctuation">:</span> <span class="token string">'Reset Content'</span><span class="token punctuation">,</span>
  <span class="token string">'206'</span><span class="token punctuation">:</span> <span class="token string">'Partial Content'</span><span class="token punctuation">,</span>
  <span class="token string">'207'</span><span class="token punctuation">:</span> <span class="token string">'Multi-Status'</span><span class="token punctuation">,</span>
  <span class="token string">'208'</span><span class="token punctuation">:</span> <span class="token string">'Already Reported'</span><span class="token punctuation">,</span>
  <span class="token string">'226'</span><span class="token punctuation">:</span> <span class="token string">'IM Used'</span><span class="token punctuation">,</span>
  <span class="token string">'300'</span><span class="token punctuation">:</span> <span class="token string">'Multiple Choices'</span><span class="token punctuation">,</span>
  <span class="token string">'301'</span><span class="token punctuation">:</span> <span class="token string">'Moved Permanently'</span><span class="token punctuation">,</span>
  <span class="token string">'302'</span><span class="token punctuation">:</span> <span class="token string">'Found'</span><span class="token punctuation">,</span>
  <span class="token string">'303'</span><span class="token punctuation">:</span> <span class="token string">'See Other'</span><span class="token punctuation">,</span>
  <span class="token string">'304'</span><span class="token punctuation">:</span> <span class="token string">'Not Modified'</span><span class="token punctuation">,</span>
  <span class="token string">'305'</span><span class="token punctuation">:</span> <span class="token string">'Use Proxy'</span><span class="token punctuation">,</span>
  <span class="token string">'307'</span><span class="token punctuation">:</span> <span class="token string">'Temporary Redirect'</span><span class="token punctuation">,</span>
  <span class="token string">'308'</span><span class="token punctuation">:</span> <span class="token string">'Permanent Redirect'</span><span class="token punctuation">,</span>
  <span class="token string">'400'</span><span class="token punctuation">:</span> <span class="token string">'Bad Request'</span><span class="token punctuation">,</span>
  <span class="token string">'401'</span><span class="token punctuation">:</span> <span class="token string">'Unauthorized'</span><span class="token punctuation">,</span>
  <span class="token string">'402'</span><span class="token punctuation">:</span> <span class="token string">'Payment Required'</span><span class="token punctuation">,</span>
  <span class="token string">'403'</span><span class="token punctuation">:</span> <span class="token string">'Forbidden'</span><span class="token punctuation">,</span>
  <span class="token string">'404'</span><span class="token punctuation">:</span> <span class="token string">'Not Found'</span><span class="token punctuation">,</span>
  <span class="token string">'405'</span><span class="token punctuation">:</span> <span class="token string">'Method Not Allowed'</span><span class="token punctuation">,</span>
  <span class="token string">'406'</span><span class="token punctuation">:</span> <span class="token string">'Not Acceptable'</span><span class="token punctuation">,</span>
  <span class="token string">'407'</span><span class="token punctuation">:</span> <span class="token string">'Proxy Authentication Required'</span><span class="token punctuation">,</span>
  <span class="token string">'408'</span><span class="token punctuation">:</span> <span class="token string">'Request Timeout'</span><span class="token punctuation">,</span>
  <span class="token string">'409'</span><span class="token punctuation">:</span> <span class="token string">'Conflict'</span><span class="token punctuation">,</span>
  <span class="token string">'410'</span><span class="token punctuation">:</span> <span class="token string">'Gone'</span><span class="token punctuation">,</span>
  <span class="token string">'411'</span><span class="token punctuation">:</span> <span class="token string">'Length Required'</span><span class="token punctuation">,</span>
  <span class="token string">'412'</span><span class="token punctuation">:</span> <span class="token string">'Precondition Failed'</span><span class="token punctuation">,</span>
  <span class="token string">'413'</span><span class="token punctuation">:</span> <span class="token string">'Payload Too Large'</span><span class="token punctuation">,</span>
  <span class="token string">'414'</span><span class="token punctuation">:</span> <span class="token string">'URI Too Long'</span><span class="token punctuation">,</span>
  <span class="token string">'415'</span><span class="token punctuation">:</span> <span class="token string">'Unsupported Media Type'</span><span class="token punctuation">,</span>
  <span class="token string">'416'</span><span class="token punctuation">:</span> <span class="token string">'Range Not Satisfiable'</span><span class="token punctuation">,</span>
  <span class="token string">'417'</span><span class="token punctuation">:</span> <span class="token string">'Expectation Failed'</span><span class="token punctuation">,</span>
  <span class="token string">'418'</span><span class="token punctuation">:</span> <span class="token string">'I\'m a teapot'</span><span class="token punctuation">,</span>
  <span class="token string">'421'</span><span class="token punctuation">:</span> <span class="token string">'Misdirected Request'</span><span class="token punctuation">,</span>
  <span class="token string">'422'</span><span class="token punctuation">:</span> <span class="token string">'Unprocessable Entity'</span><span class="token punctuation">,</span>
  <span class="token string">'423'</span><span class="token punctuation">:</span> <span class="token string">'Locked'</span><span class="token punctuation">,</span>
  <span class="token string">'424'</span><span class="token punctuation">:</span> <span class="token string">'Failed Dependency'</span><span class="token punctuation">,</span>
  <span class="token string">'425'</span><span class="token punctuation">:</span> <span class="token string">'Unordered Collection'</span><span class="token punctuation">,</span>
  <span class="token string">'426'</span><span class="token punctuation">:</span> <span class="token string">'Upgrade Required'</span><span class="token punctuation">,</span>
  <span class="token string">'428'</span><span class="token punctuation">:</span> <span class="token string">'Precondition Required'</span><span class="token punctuation">,</span>
  <span class="token string">'429'</span><span class="token punctuation">:</span> <span class="token string">'Too Many Requests'</span><span class="token punctuation">,</span>
  <span class="token string">'431'</span><span class="token punctuation">:</span> <span class="token string">'Request Header Fields Too Large'</span><span class="token punctuation">,</span>
  <span class="token string">'451'</span><span class="token punctuation">:</span> <span class="token string">'Unavailable For Legal Reasons'</span><span class="token punctuation">,</span>
  <span class="token string">'500'</span><span class="token punctuation">:</span> <span class="token string">'Internal Server Error'</span><span class="token punctuation">,</span>
  <span class="token string">'501'</span><span class="token punctuation">:</span> <span class="token string">'Not Implemented'</span><span class="token punctuation">,</span>
  <span class="token string">'502'</span><span class="token punctuation">:</span> <span class="token string">'Bad Gateway'</span><span class="token punctuation">,</span>
  <span class="token string">'503'</span><span class="token punctuation">:</span> <span class="token string">'Service Unavailable'</span><span class="token punctuation">,</span>
  <span class="token string">'504'</span><span class="token punctuation">:</span> <span class="token string">'Gateway Timeout'</span><span class="token punctuation">,</span>
  <span class="token string">'505'</span><span class="token punctuation">:</span> <span class="token string">'HTTP Version Not Supported'</span><span class="token punctuation">,</span>
  <span class="token string">'506'</span><span class="token punctuation">:</span> <span class="token string">'Variant Also Negotiates'</span><span class="token punctuation">,</span>
  <span class="token string">'507'</span><span class="token punctuation">:</span> <span class="token string">'Insufficient Storage'</span><span class="token punctuation">,</span>
  <span class="token string">'508'</span><span class="token punctuation">:</span> <span class="token string">'Loop Detected'</span><span class="token punctuation">,</span>
  <span class="token string">'509'</span><span class="token punctuation">:</span> <span class="token string">'Bandwidth Limit Exceeded'</span><span class="token punctuation">,</span>
  <span class="token string">'510'</span><span class="token punctuation">:</span> <span class="token string">'Not Extended'</span><span class="token punctuation">,</span>
  <span class="token string">'511'</span><span class="token punctuation">:</span> <span class="token string">'Network Authentication Required'</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3><code class="language-text">http.globalAgent</code></h3>
<p>Aponta para a instância global do objeto Agente, que é uma instÂncia da classe <code class="language-text">http.Agent</code>.</p>
<p>É usado para gerenciar persistência de conexões e reuso para clientes HTTP.</p>
<p>Veremos mais da descrição da classe <code class="language-text">http.Agent</code>.</p>
<h2>Methods</h2>
<h3><code class="language-text">http.createServer()</code></h3>
<p>Retorna uma nova instância da classe <code class="language-text">http.Server</code>.</p>
<p>Uso:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// gerencie cada requisição com essa callback</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3><code class="language-text">http.request()</code></h3>
<p>Faz uma requisição HTTP para um servidor, criando uma instância da classe <code class="language-text">http.ClientRequest</code>.</p>
<h3><code class="language-text">http.get()</code></h3>
<p>Parecido com o <code class="language-text">http.request()</code>, mas define automaticamente o verbo HTTP para GET, e chama <code class="language-text">req.end()</code> automaticamente.</p>
<h2>Classes</h2>
<p>O módulo HTTP provê 5 classes:</p>
<ul>
<li><code class="language-text">http.Agent</code></li>
<li><code class="language-text">http.ClientRequest</code></li>
<li><code class="language-text">http.Server</code></li>
<li><code class="language-text">http.ServerResponse</code></li>
<li><code class="language-text">http.IncomingMessage</code></li>
</ul>
<h3><code class="language-text">http.Agent</code></h3>
<p>O Node.js cria uma instância global da classe <code class="language-text">http.Agent</code> para gerenciar persistência de conexões e reuso para clientes HTTP.</p>
<p>Esse objeto garante que toda requisição feita ao servidor seja enfileirada e um único socket seja reusado.</p>
<p>Também mantém um pool de sockets. Isso é necessário por razões de performance.</p>
<h3><code class="language-text">http.ClientRequest</code></h3>
<p>Um objeto <code class="language-text">http.ClientRequest</code> é criado quando <code class="language-text">http.request()</code> ou <code class="language-text">http.get()</code> são chamados.</p>
<p>Quando uma resposta é recebida, o evento <code class="language-text">response</code> é chamado com a resposta, contendo uma instância de <code class="language-text">http.IncomingMessage</code> como argumento.</p>
<p>Os dados retornados de uma resposta podem ser lidos de 2 formas:</p>
<ul>
<li>você pode chamar o método <code class="language-text">response.read()</code></li>
<li>na callback do evento <code class="language-text">response</code> você pode preparar um event listener para o evento <code class="language-text">data</code>, assim você pode ouvir os dados transmitidos.</li>
</ul>
<h3><code class="language-text">http.Server</code></h3>
<p>Essa classe é comumente instanciada e retornada quando se cria um novo servidor usando <code class="language-text">http.createServer()</code>.</p>
<p>Uma vez que você tenha um objeto server, você pode acessar os métodos dele:</p>
<ul>
<li><code class="language-text">close()</code> impede o servidor de aceitar novas conexões</li>
<li><code class="language-text">listen()</code> inicia o servidor HTTP e escuta as conexões</li>
</ul>
<h3><code class="language-text">http.ServerResponse</code></h3>
<p>Criado por um <code class="language-text">http.Server</code> e passado como segundo parâmetro para o evento <code class="language-text">request</code> acionado.</p>
<p>Normalmente é usado com o <code class="language-text">res</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// res é um objeto http.ServerResponse</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Você sempre deve chamar o método <code class="language-text">end()</code> na callback, que fecha a response, a mensagem está completa e o servidor pode enviá-la ao client. Deve ser chamado em cada response.</p>
<p>Esses métodos são usados para interagir com headers HTTP:</p>
<ul>
<li><code class="language-text">getHeaderNames()</code> obtêm a lista de nomes das headers HTTP já definidas</li>
<li><code class="language-text">getHeaders()</code> obtêm uma cópia das headers HTTP já definidas</li>
<li><code class="language-text">setHeader(&#39;headername&#39;, value)</code> define uma header HTTP e seu valor</li>
<li><code class="language-text">getHeader(&#39;headername&#39;)</code> obtêm uma header HTTP já definida</li>
<li><code class="language-text">removeHeader(&#39;headername&#39;)</code> remove uma header HTTP já definida</li>
<li><code class="language-text">hasHeader(&#39;headername&#39;)</code> retorna true se a response já contêm aquela header</li>
<li><code class="language-text">headersSent()</code> retorna true se as headers já foram enviadas ao client</li>
</ul>
<p>Depois de processar as headers você pode enviá-las ao client chamando <code class="language-text">response.writeHead()</code>, que aceita o statusCode como primeiro parâmetro, e mensagem do status de forma opcional, e o objeto de headers.</p>
<p>Para enviar os dados ao client pelo body da response, você usa <code class="language-text">write()</code>. Ele enviará os dados armazenados em buffer para a stream de resposta HTTP.</p>
<p>Se os headers ainda não foram enviados usando <code class="language-text">response.writeHead()</code>, as headers serão enviadas primeiro, com o código de status e a mensagem que foram definidos na request, que você pode editar definindo os valores das propriedades <code class="language-text">statusCode</code> e <code class="language-text">statusMessage</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">500</span>
response<span class="token punctuation">.</span>statusMessage <span class="token operator">=</span> <span class="token string">'Internal Server Error'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3><code class="language-text">http.IncomingMessage</code></h3>
<p>Um objeto <code class="language-text">http.IncomingMessage</code> é criado quando:</p>
<ul>
<li><code class="language-text">http.Server</code> está escutando o evento <code class="language-text">request</code></li>
<li><code class="language-text">http.ClientRequest</code> está escutando o evento <code class="language-text">response</code></li>
</ul>
<p>Pode ser usado para acessar da response:</p>
<ul>
<li>status usando os métodos <code class="language-text">statusCode</code> e <code class="language-text">statusMessage</code></li>
<li>headers usando o método <code class="language-text">headers</code> ou <code class="language-text">rawHeaders</code></li>
<li>método HTTP usando o método <code class="language-text">method</code></li>
<li>versão HTTP usando o método <code class="language-text">httpVersion</code></li>
<li>URL usando o método <code class="language-text">url</code></li>
<li>socket subjacente usando o método <code class="language-text">socket</code></li>
</ul>
<p>Os dados são acessados usando streams, uma vez que <code class="language-text">http.IncomingMessage</code> implementa a interface Readable Stream.</p>
<h2>Buffers no Node.js</h2>
<h2>O que é um buffer?</h2>
<p>Um buffer é uma área de memória. Desenvolvedores JavaScript não são familiarizados com esse conceito, muito menos que desenvolvedores C, C++ ou Go (ou qualquer programador que use uma linguagem de programação de sistema), que interagem com memória diariamente.</p>
<p>Ele representa um pedaço de memória de tamanho fixo (não pode ser redimensionado) alocado fora da engine JavaScript V8.</p>
<p>Você pode pensar em um buffer com um array de inteiros, em que cada um representa um byte de dados.</p>
<p>Ele é implementado pela <a href="https://nodejs.org/api/buffer.html">classe Buffer</a> no Node.js.</p>
<h2>Por que precisamos de um buffer?</h2>
<p>Buffers foram introduzidos para ajudar desenvolvedores a lidar com dados binários, em um ecossistema que tradicionalmente só lida com strings em vez de binários.</p>
<p>Buffers são profundamente linkados com streams. Quando um processador de stream recebe mais rápido do que pode aguentar, ele coloca os dados em um buffer.</p>
<p>Uma visualização simples de um buffer é quando você está assistindo um vídeo no Youtube e a linha vermelha vai além do seu ponto de visualização: você está baixando dados mais rápido do que está os vendo, e o seu browser os bufferiza.</p>
<h2>Como criar um buffer</h2>
<p>Um buffer é criado usando os métodos <a href="https://nodejs.org/api/buffer.html#buffer_buffer_from_buffer_alloc_and_buffer_allocunsafe"><code class="language-text">Buffer.from()</code></a>, <a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_alloc_size_fill_encoding"><code class="language-text">Buffer.alloc()</code></a>, e <a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_allocunsafe_size"><code class="language-text">Buffer.allocUnsafe()</code></a>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<ul>
<li><a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_array"><code class="language-text">Buffer.from(array)</code></a></li>
<li><a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_arraybuffer_byteoffset_length"><code class="language-text">Buffer.from(arrayBuffer[, byteOffset[, length]])</code></a></li>
<li><a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_buffer"><code class="language-text">Buffer.from(buffer)</code></a></li>
<li><a href="https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_string_encoding"><code class="language-text">Buffer.from(string[, encoding])</code></a></li>
</ul>
<p>Você também pode inicializar passando apenas o tamanho. Isso cria um buffer de 1KB:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token comment">//or</span>
<span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Enquanto ambos <code class="language-text">alloc</code> e <code class="language-text">allocUnsafe</code> alocam um <code class="language-text">Buffer</code> do tamanho especificado em bytes, o <code class="language-text">Buffer</code> criado via <code class="language-text">alloc</code> vai ser <em>inicializado</em> com zeros e o criado via <code class="language-text">allocUnsafe</code> vai ser <em>não inicializado</em>. Isso significa que enquanto <code class="language-text">allocUnsafe</code> pode ser bem rápido em comparação ao <code class="language-text">alloc</code>, o segmento de memória alocado pode conter dados antigos que podem ser potencialmente sensíveis.</p>
<p>Dados antigos, se presentes em memória, podem ser acessados ou vazados quando a memória do <code class="language-text">Buffer</code> é lida. Isso é o que realmente faz do <code class="language-text">allocUnsafe</code> inseguro e tenha cuidado extra ao usá-lo.</p>
<h2>Usando um buffer</h2>
<h3>Acessando o conteúdo de um buffer</h3>
<p>Um buffer, sendo um array de bytes, pode ser acessado como um array:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 72</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 101</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 121</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Esses números são o Código Unicode que identifica o caracter naquela posição do buffer (H => 72, e => 101, y => 121)</p>
<p>Você pode imprimir o conteúdo completo de um buffer usando o método <code class="language-text">toString()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<blockquote>
<p>Observe que se você inicializar um buffer com um número que defina o tamanho dele, você vai ter acesso à memória pre-inicializada, que vai conter dados aleatórios, não um buffer vazio!</p>
</blockquote>
<h3>Obtendo o comprimento de um buffer</h3>
<p>Use a propriedade <code class="language-text">length</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3>Iterando sob o conteúdo de um buffer</h3>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> buf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token comment">// 72 101 121 33</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Mudando o conteúdo de um buffer</h3>
<p>Você pode gravar uma string inteira de dados em um buffer usando o método <code class="language-text">write()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Assim como você pode acessar um buffer com uma sintaxe de array, você também pode definir os conteúdos do buffer dessa mesma forma:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span> <span class="token comment">// o</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Hoy!</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3>Copiando um buffer</h3>
<p>É possível copiar um buffer usando o método <code class="language-text">copy()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> bufcopy <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// allocate 4 bytes</span>
buf<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bufcopy<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Por padrão você copia o buffer inteiro. Mais 3 parâmetros deixam você definir a posição inicial, a posição final, e o comprimento do novo buffer:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> bufcopy <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// allocate 2 bytes</span>
buf<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bufcopy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
bufcopy<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'He'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Fatiando um buffer</h3>
<p>Se você quer criar uma visualização parccial de um buffer, você pode criar uma fatia (slice). Uma fatia não é uma cópia: o buffer original ainda é a fonte de verdade. Se ele mudar, sua fatia também muda.</p>
<p>Use o método <code class="language-text">slice()</code> para criar a fatia. O primeiro parâmetro é a posição inicial, e você pode especificar um segundo parâmetro opcional com a posição final:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Hey!'</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hey!</span>
<span class="token keyword">const</span> slice <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// He</span>
buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span> <span class="token comment">// o</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>slice<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Ho</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Node.js Streams</h2>
<h2>O que são streams</h2>
<p>Streams são um dos conceitos fundamentais que empoderam aplicações Node.js.</p>
<p>Elas são um jeito de lidar com leitura/escrita de arquivos, comunicações em rede, ou qualquer tipo de troca de informação end-to-end de uma forma eficiente.</p>
<p>Streams não são um conceito único do Node.js. Elas foram introduzidas no sistema operacional Unix décadas atrás, permitindo que programas possam interagir uns com os outros passando streams, através do operador pipe (<code class="language-text">|</code>).</p>
<p>Por exemplo, em uma abordagem tradicional, quando você diz ao programa para ler um arquivo, o arquivo é lido na memória, do começo ao fim, e então é processado.</p>
<p>Utilizando streams você lê pedaço por pedaço, processando o conteúdo sem mantê-lo completo na memória.</p>
<p>O <a href="https://nodejs.org/api/stream.html">módulo <code class="language-text">stream</code></a> provê a fundação da qual todas APIs de streaming são feitas. Todas streams são instâncias do <a href="https://nodejs.org/api/events.html#events_class_eventemitter">EventEmitter</a></p>
<h2>Porquê streams</h2>
<p>Streams basicamente nos dão duas grandes vantagens sobre outros métodos de manipulação de dados:</p>
<ul>
<li><strong>Eficiência de memória</strong>: você não precisa carregar grandes quantidades de dados em memória antes de ser capaz de processá-los</li>
<li><strong>Eficiência temporal</strong>: menos tempo é requerido para começar a processar dados, uma vez que você pode começar a processar assim que os tiver, em vez de esperar até que toda carga útil de dados esteja disponível</li>
</ul>
<h2>Um exemplo de stream</h2>
<p>Um exemplo típico é ler arquivos de um disco.</p>
<p>Usando o módulo <code class="language-text">fs</code> do Node.js, você pode ler um arquivo, e serví-lo com HTTP quando uma nova conexão é estabelecida no seu servidor HTTP:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/data.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">readFile()</code> lê todo conteúdo do arquivo, e invoca uma função callback quando terminar.</p>
<p><code class="language-text">res.end(data)</code> na callbac vai retornar o conteúdo do arquivo para o client HTTP.</p>
<p>Se o arquivo for grande, a operação vai demorar um pouco. Aqui temos a mesma funcionalidade usando streams:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/data.txt'</span><span class="token punctuation">)</span>
  stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Em vez de esperar até que o arquivo seja completamente lido, nós começamos a “streamá-lo” para o client HTTP assim que tivermos chunks de dados prontos para serem enviados.</p>
<h2>pipe()</h2>
<p>O exemplo acima usa <code class="language-text">stream.pipe(res)</code>: o método <code class="language-text">pipe()</code> é chamado na stream de arquivo.</p>
<p>O que esse código faz? Ele pega a origem, e canaliza para um destino.</p>
<p>Você chama isso na stream origem, e nesse caso, a stream de arquivo é canalizada para a resposta HTTP.</p>
<p>O valor retornado pelo método <code class="language-text">pipe()</code> é a stream de destino, que é algo muito conveniente pois nos permite encadear múltiplas chamadas <code class="language-text">pipe()</code>, desse jeito:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">src<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest2<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Isso faz o mesmo que</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">src<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest1<span class="token punctuation">)</span>
dest1<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest2<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h2>APIs Node.js baseadas em streams</h2>
<p>Dadas as suas vantagens, muitos dos módulos principais do Node.js fornecem recursos nativos para manipulação de streams, sendo os mais notáveis:</p>
<ul>
<li><code class="language-text">process.stdin</code> retorna uma stream conectada ao stdin</li>
<li><code class="language-text">process.stdout</code> retorna uma stream conectada ao stdout</li>
<li><code class="language-text">process.stderr</code> retorna uma stream conectada ao stderr</li>
<li><code class="language-text">fs.createReadStream()</code> cria uma stream de leitura para um arquivo</li>
<li><code class="language-text">fs.createWriteStream()</code> cria uma stream de escrita para um arquivo</li>
<li><code class="language-text">net.connect()</code> inicia uma stream baseada em conexão</li>
<li><code class="language-text">http.request()</code> retorna uma instância da classe http.ClientRequest, que é uma stream de escrita</li>
<li><code class="language-text">zlib.createGzip()</code> comprime dados usando gzip (um algoritmo de compressão) em uma stream</li>
<li><code class="language-text">zlib.createGunzip()</code> descomprime uma stream gzip.</li>
<li><code class="language-text">zlib.createDeflate()</code> comprime dados usando deflate (um algoritmo de compressão) em uma stream</li>
<li><code class="language-text">zlib.createInflate()</code> descomprime uma stream deflate.</li>
</ul>
<h2>Diferentes tipos de streams</h2>
<p>Existem quatro classes de streams:</p>
<ul>
<li><code class="language-text">Readable</code>: uma stream de onde você pode canalizar, mas não canalizar dados nela (você pode receber dados, mas não pode enviar dados). Quando você coloca dados em uma stream de leitura, os dados são bufferizados, até que um consumer comece a ler os dados.</li>
<li><code class="language-text">Writable</code>: uma stream em que você pode canalizar dados, mas não obter dados dela (você pode enviar dados, mas não pode receber).</li>
<li><code class="language-text">Duplex</code>: uma stream em que você pode tanto canalizar dados quando obtê-los, basicamente uma combinação de uma stream Readable e uma Writable</li>
<li><code class="language-text">Transform</code>: uma stream Transform é similar a uma Duplex, mas a saída é um transform das entradas</li>
</ul>
<h2>Como criar uma stream de leitura (readable stream)</h2>
<p>Nós obtêmos a stream de leitura pelo <a href="https://nodejs.org/api/stream.html">módulo <code class="language-text">stream</code></a>, a inicializamos e implementamos o método <code class="language-text">readable._read()</code>.</p>
<p>Primeiro crie um objeto stream:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>então implemente o <code class="language-text">_read</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">readableStream<span class="token punctuation">.</span><span class="token function-variable function">_read</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Você também pode implementar o <code class="language-text">_read</code> usando a opção <code class="language-text">read</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Agora que a stream está inicializada, nós podemos enviar dados a ela:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span>
readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ho!'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h2>Como criar uma stream de escrita (writable stream)</h2>
<p>Para criar uma stream de escrita nós extendemos o objeto base <code class="language-text">Writable</code>, e implementamos seu método _write().</p>
<p>Primeiro crie um objeto stream:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>e então implemente o <code class="language-text">_write</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">writableStream<span class="token punctuation">.</span><span class="token function-variable function">_write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Agora você pode canalizar uma stream de leitura nele:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writableStream<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Como obtêr dados de uma stream de leitura</h2>
<p>Como nós lemos dados de uma stream de leitura? Usando uma stream de escrita:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

writableStream<span class="token punctuation">.</span><span class="token function-variable function">_write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

readableStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writableStream<span class="token punctuation">)</span>

readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span>
readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ho!'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você também pode consumir uma stream de leitura diretamente, usando o evento <code class="language-text">readble</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>readableStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Como enviar dados para uma stream de escrita</h2>
<p>Usando o método <code class="language-text">write()</code> da stream:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">writableStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hey!\n'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Sinalizando a uma stream de escrita que você terminou de escrever</h2>
<p>Use o método <code class="language-text">end()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Stream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Readable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writableStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stream<span class="token punctuation">.</span>Writable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

writableStream<span class="token punctuation">.</span><span class="token function-variable function">_write</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

readableStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writableStream<span class="token punctuation">)</span>

readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'hi!'</span><span class="token punctuation">)</span>
readableStream<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ho!'</span><span class="token punctuation">)</span>

writableStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>A diferença entre development e production</h2>
<p>Você pode ter configurações diferentes para os ambientes de produção e desenvolvimento.</p>
<p>O Node.js assume que você está sempre rodando de um ambiente de desenvolvimento.</p>
<p>Você pode sinalizar ao Node.js que está rodando em produção definindo a variável de ambiente <code class="language-text">NODE_ENV=production</code>.</p>
<p>Isso normalmente é feito executando o comando</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>no shell, mas é melhor colocar no seu arquivo de configuração shell (<code class="language-text">bash_profile</code> com Bash shell), porque senão a configuração não é persistida em caso de reinício do sistema.</p>
<p>Você também pode aplicar a variável de ambiente prefixando no comando de inicialização da sua aplicação:</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production node app.js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Essa variável de ambiente é uma convenção amplamente usada por bibliotecas também.</p>
<p>Definir o ambiente para <code class="language-text">production</code> geralmente garante que</p>
<ul>
<li>é mantido o mínimo de logs, apenas o essencial</li>
<li>mais níveis de cache são usados para otimizar a performance</li>
</ul>
<p>Tomando como exemplo o Pug, a biblioteca de templates usada pelo Express, compila em modo debug se <code class="language-text">NODE_ENV</code> não estiver definida como <code class="language-text">production</code>. No ambiente de desenvolvimento as views do Express são compiladas em cada requisição, enquanto que em produção elas são cacheadas. Há muitos outros exemplos além desse.</p>
<p>Você pode usar condicionais para executar códigos em ambientes diferentes:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"development"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'production'</span><span class="token punctuation">,</span> <span class="token string">'staging'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Por exemplo, em uma aplicação Express, você pode usar isso para definir o <code class="language-text">errorHandler</code> de acordo com o ambiente:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"development"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dumpExceptions<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> showStack<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Error handling no Node.js</h2>
<p>Erros no Node.js são tratados por meio de exceções.</p>
<h2>Criando exceções</h2>
<p>Uma exceção é crianda usando a palavra reservada <code class="language-text">throw</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">throw</span> value</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Assim que o JavaScript executa essa linha, o fluxo normal do programa é parado e o controle é retomado pelo <strong>tratamento de exceção</strong> mais próximo.</p>
<p>Normalmente no código client-side o <code class="language-text">value</code> pode ser qualquer valor JavaScript, incluindo uma string, um número ou um objeto.</p>
<p>No Node.js, nós não lançamos strings, só lançamos objetos de erro.</p>
<h2>Objetos de erro</h2>
<p>Um objeto de erro é um objeto que é uma instância do objeto Error, ou que estenda a classe Error, fornecida pelo <a href="https://nodejs.org/api/errors.html">módulo nativo Error</a>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Ran out of coffee'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>ou</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NotEnoughCoffeeError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotEnoughCoffeeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Tratando exceções</h2>
<p>Um bloco <code class="language-text">try</code>/<code class="language-text">catch</code> é um tratador de exceções.</p>
<p>Qualquer exceção lançada nas linhas que incluem o bloco <code class="language-text">try</code> serão tratadas no bloco <code class="language-text">catch</code> correspondente:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// linhas de código</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">e</code> nesse excemplo é o valor da exceção.</p>
<p>Você pode adicionar múltiplos blocos, que podem tratar diferentes tipos de erros.</p>
<h2>Pegando exceções não capturadas</h2>
<p>Se uma exceção não capturada for lançada durante a execução do seu programa, ele irá crashar.</p>
<p>Para resolver isso, escute o evento <code class="language-text">uncaughtException</code> no objeto <code class="language-text">process</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'There was an uncaught error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// obrigatório (conforme as docs do Node.js)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Você não precisa importar o módulo nativo <code class="language-text">process</code>, ele é automaticamente injetado.</p>
<h2>Exceções com promises</h2>
<p>Usando promises você pode encadear diferentes operações, e tratar erros no final:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">doSomething1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>doSomething2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>doSomething3<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Como você sabe quando o erro ocorreu? Você na verdade não sabe, mas você pode tratar erros em cada uma das funções que chamar (<code class="language-text">doSomethingX</code>), e dentro do catch lançar um novo erro, que chamará o <code class="language-text">catch</code> exterior:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">doSomething1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//... trata o erro localmente</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Para ser possível tratar erros localmente sem tratá-los na função que chamamos, nós podemos quebrar a corrente, você pode criar uma função em cada <code class="language-text">then</code> e processar a exceção:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">doSomething1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">doSomething2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// trata o erro</span>
      <span class="token keyword">throw</span> err <span class="token comment">// quebre a corrente!</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">doSomething2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// trata o erro</span>
      <span class="token keyword">throw</span> err <span class="token comment">// quebra a corrente!</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Tratando erros com async/await</h2>
<p>Usando async/await, você ainda precisa tratar erros, e você pode fazer isso dessa forma:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">someOtherFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Como fazer log de um objeto no Node.js</h2>
<p>Quando você digita <code class="language-text">console.log()</code> em um programa JavaScript e o roda no browser, isso vai criar uma entrada bem legal no Console do Browser:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 561px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2a5f076a9531f84a0e8e655923a55d1c/daba0/console-log-browser.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 20.32085561497326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAqUlEQVQI11WOiQ6DIAyGff/XWzaXAR54DVAOGccU5xCTJfuSNn/SfmmzNTFrrdQspJy4sM4JEaPkXCilnLX7vm//fBKZT5Q1BqhARYXKOoo5QJc7ABWGFdbmkOPqr5/hkGMKIWitpRAjY4SQt/fbyHzbhuewDMNCaXyNUhpHxrhHbhmTp57FijPOed/3RcJau2rtum6+XR3Gjk8vYxCETYON8fBhCJnO419sSuJOsDfBRAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="log no console exibindo um objeto"
        title="log no console exibindo um objeto"
        src="/static/2a5f076a9531f84a0e8e655923a55d1c/daba0/console-log-browser.png"
        srcset="/static/2a5f076a9531f84a0e8e655923a55d1c/00d96/console-log-browser.png 148w,
/static/2a5f076a9531f84a0e8e655923a55d1c/0b23c/console-log-browser.png 295w,
/static/2a5f076a9531f84a0e8e655923a55d1c/daba0/console-log-browser.png 561w"
        sizes="(max-width: 561px) 100vw, 561px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Ao clicar na flecha, o log é expandido, e você pode ver claramente as propriedades do objeto:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/176d7e6c1b9c0c0d48626733a70dace6/914f1/console-log-browser-expanded.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.785834738617204%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABJElEQVQY03WR2W7DIBBF8/8/1R9IqypSoliRbbwAXlhiCKuDKXFS96HteRqBDjOX2dmVummrukEYNy2kjNctTEWWXShlIYRlWcJKKmJcNnZuBXV91w+M85FQxlhRANj1eQO5kKvw4scLq5yOvHOEkKoCOci7oZ+tWarcl+UMSpNlTsrrNB0Oh2liGIbPPe64qYaQxIec5nHeMcrrYzOigVKHgAo34Sj1nM/znHJhhK01WkXOtHF37eJLjutcdx+qt5bXjBB3OYu43B836V1r4z/stir4APcY7bGYhJNEvn/o89mdTnIcn3G/c/+S058JIZIvu5siWlObek6cn45HAEBRFELIPzo/F+C9l0JqphXTVlpFlOJa3RREqChLjLExZlvYxheclckbyRFmAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="log expandido"
        title="log expandido"
        src="/static/176d7e6c1b9c0c0d48626733a70dace6/799d3/console-log-browser-expanded.png"
        srcset="/static/176d7e6c1b9c0c0d48626733a70dace6/00d96/console-log-browser-expanded.png 148w,
/static/176d7e6c1b9c0c0d48626733a70dace6/0b23c/console-log-browser-expanded.png 295w,
/static/176d7e6c1b9c0c0d48626733a70dace6/799d3/console-log-browser-expanded.png 590w,
/static/176d7e6c1b9c0c0d48626733a70dace6/914f1/console-log-browser-expanded.png 593w"
        sizes="(max-width: 590px) 100vw, 590px"
        loading="lazy"
      />
  </a>
    </span></p>
<p>No Node.js, o mesmo acontece.</p>
<p>Nós não temos tanto luxo quando logamos algo no console, porque isso vai retornar o objeto para o shell se você rodar o programa Node.js manualmente, ou para um arquivo de log. Você obtêm uma representação do objeto em formato de string.</p>
<p>Agora, tudo fica bem até um certo nível de aninhamento. Depois de dois níveis de aninhamento, o Node.js desiste e imprime <code class="language-text">[Object]</code> como um placeholder:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'joe'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
  person1<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Tony'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    person2<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'Albert'</span><span class="token punctuation">,</span>
      age<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
      person3<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'Peter'</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">23</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span>


<span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'joe'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
  person1<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Tony'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    person2<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'Albert'</span><span class="token punctuation">,</span>
      age<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
      person3<span class="token punctuation">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Como você pode imprimir o objeto inteiro?</p>
<p>A melhor maneira de fazer isso, preservando a beleza da saída, é usar:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>sendo <code class="language-text">2</code> o número de espaços usados para identação.</p>
<p>Outra opção é usar</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inspect<span class="token punctuation">.</span>defaultOptions<span class="token punctuation">.</span>depth <span class="token operator">=</span> <span class="token keyword">null</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>mas o problema é que objetos aninhados com mais de 2 níveis ficam planificados, e isso pode ser um problema com objetos complexos.</p>
<h2>Referências</h2>
<p>Revisado, Editado e baseado na documentação oficial do NodeJS, da qual possue licença MIT, que permite a livre redistribuição.</p>
<p>Agradecimento especial ao meu estagiário <a href="http://bit.ly/teteus-rocha">Matheus Rocha</a> que trabalhou duro para esta apostila sair!</p>
<p>Meu objetivo é levar conhecimento e acessibilidade a todos, muito obrigado por ter lido até aqui.</p>
<p>Se tiver qualquer dúvida me pergunte qualquer coisa no <a href="http://bit.ly/pauloluan-insta">Instagram</a>, faço mentoria coletiva (gratuita) para programadores iniciantes que se sentem perdidos, você será extremamente bem vindo por lá (é só clicar na imagem).</p>
<p><a href="http://bit.ly/pauloluan-insta"><img src="https://media-exp1.licdn.com/dms/image/C4E12AQF9pxdMEVTSQg/article-inline_image-shrink_1500_2232/0/1614414726929?e=1619654400&#x26;v=beta&#x26;t=ti7w8kAyqaK7PRcB9YGnRNv8ircAgThraVR-O1D4T54" alt="Mentoria Gratuita"></a></p>
<p>Um grande abraço, Paulo Luan.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVQ4y42UWU8UQRDHefFjGL+Arz6aKIlHMOFNXiSBqFEw0ZiIbtCAIYTIIYeGQ1dwOeKycigQD1DX5QwJEoSNirLdPdPbMz3dM73LqfFNaxjDrhiBpDLpY37dVf+q6gxKyM6mx4i2af9uZeyEIWKa2FlB9jKCr2FgHe8NBtISeH6UhnxWoFB2+0R0knKBYX1HGLuucguHHxt3j6mX98yxIBuq5jAeDzLOU/x2GGIj3wiL4+iUXpWpYlEtsY6cZaTW0OcZvTpTLc5qjBHP/xQMc8DgYIMRiLC/zBqo4M4qwova3FtKNaLWUc8ta6iGS4X1WBoMJFhyA828iFcdSUTaje4b1vuAYUn3rECBbDsvl3+ikWYz5BN2AmkpGJO45k4GK83qoyroE71l1mgn67oqkt8R/kqEg1vPyoE7PFhkjTQbMPXCzvCuNQziz7P9efLTtP4xTOtPKRjUgELdDKKN6/ADrjycqDup4hr27nNhLyVTfaz1nNz4FYNoQef+Mg5SQ7T1WarrioCBWkXPynlfqQXibRWMC4MbIy1mQ7YKB9jzCt5bakFVRNrZu0eGwfDTYqvljC0TaLTT6LwshIP0FIwJo+TLB32wivfctK4dWJnqZYEC0Zxjh9sM2IVU+fPlRIhND7D2QilV2s1e9YKqkz2s8bTzutF802KCvCAVhKNtbkU6WG8Jf3Xf7LvNZeJvGCbgecclWXIwGbgoyw8lF8YpKESWiAdDYYHDTTmOt75V4X/yDKnSlsjsMJ0L09rjCtQCxost+QMBeX3/CpSHsHF6e6WKBPIBANQGpHq4yRQKw4qGSKjYurBvLVgkIAvpXbG9POHUphy7Idvx59sPc+0HuXZdlqo9ocaeMCDhIPrfloTLqcvPR+jCGI1O6NFxHdoAZIOuhrLf5TFwldCIaeAtY3G3sbe9AXt6SXa133dG1a0ljAUNAAAAAElFTkSuQmCC" alt="Reativa" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/d2742f2dddd737dec60ee2a5226edb06/000d3/icon.png 1x,
/static/d2742f2dddd737dec60ee2a5226edb06/bc2a0/icon.png 1.5x,
/static/d2742f2dddd737dec60ee2a5226edb06/89cf4/icon.png 2x" /><img loading="lazy" width="50" height="50" srcset="/static/d2742f2dddd737dec60ee2a5226edb06/000d3/icon.png 1x,
/static/d2742f2dddd737dec60ee2a5226edb06/bc2a0/icon.png 1.5x,
/static/d2742f2dddd737dec60ee2a5226edb06/89cf4/icon.png 2x" src="/static/d2742f2dddd737dec60ee2a5226edb06/000d3/icon.png" alt="Reativa" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p><strong>Se você quiser dar o proximo passo para ser um dev profissional, eu posso te mentorar!</strong> <!-- --> <a href="http://bit.ly/mentoria-pauloluan" target="_blank" rel="noopener noreferrer">é só você clicar aqui.</a> </p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/como-estudar-ciencias-da-computacao-de-graca/">← <!-- -->Como estudar Ciências da Computação (sem vestibular e de graça)</a></li><li><a rel="next" href="/como-fazer-perguntas-inteligentes/">Como fazer perguntas sobre programação na internet? (e aumentar 5x as chances de ter uma resposta)<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2021<!-- -->, Sua melhor escolha para aprender programação:<!-- --> <a href="https://reativa.dev">Reativa Tecnologia</a></footer></div></div></div><script src="https://platform.twitter.com/widgets.js"></script><script src="https://www.instagram.com/embed.js"></script><script src="https://embedr.flickr.com/assets/client-code.js"></script><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-155080700-5', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/apostila-nodejs-completa/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-320a3e4b66b1132d097e.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-d38956d7c90802b9085d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-ba8fab707f547b8d2140.js"],"component---src-pages-index-js":["/component---src-pages-index-js-511e09b2f0f1386b8494.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-d38956d7c90802b9085d.js" async=""></script><script src="/commons-687338892083191c755b.js" async=""></script><script src="/app-320a3e4b66b1132d097e.js" async=""></script><script src="/netlify-identity-widget-71f3202b04975b5e224a.js" async=""></script><script src="/styles-989bb08664f2608f37ec.js" async=""></script><script src="/webpack-runtime-b210fad69d5bdcf9f091.js" async=""></script></body></html>